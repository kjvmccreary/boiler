[2025-08-12 17:25:42.440 -05:00 INF] Starting AuthService {}
[2025-08-12 17:25:42.517 -05:00 INF] Now listening on: https://localhost:7001 {}
[2025-08-12 17:25:42.520 -05:00 INF] Now listening on: http://localhost:5001 {}
[2025-08-12 17:26:47.455 -05:00 WRN] The foreign key property 'UserRole.UserId1' was created in shadow state because a conflicting property with the simple name 'UserId' exists in the entity type, but is either not mapped, is already used for another relationship, or is incompatible with the associated primary key type. See https://aka.ms/efcore-relationships for information on mapping relationships in EF Core. {"EventId":{"Id":10625,"Name":"Microsoft.EntityFrameworkCore.Model.Validation.ShadowForeignKeyPropertyCreated"},"SourceContext":"Microsoft.EntityFrameworkCore.Model.Validation","ActionId":"a19ac64a-9aa7-4a82-b6b4-3f32c7559660","ActionName":"AuthService.Controllers.AuthController.RefreshToken (AuthService)","RequestId":"0HNEPTT9921SF:00000001","RequestPath":"/api/auth/refresh","ConnectionId":"0HNEPTT9921SF"}
[2025-08-12 17:26:48.093 -05:00 INF] üîç TOKEN DEBUG: Starting token generation for user 6 in tenant 1 {"SourceContext":"AuthService.Services.TokenService","ActionId":"a19ac64a-9aa7-4a82-b6b4-3f32c7559660","ActionName":"AuthService.Controllers.AuthController.RefreshToken (AuthService)","RequestId":"0HNEPTT9921SF:00000001","RequestPath":"/api/auth/refresh","ConnectionId":"0HNEPTT9921SF"}
[2025-08-12 17:26:48.093 -05:00 INF] üîç TOKEN DEBUG: Starting token generation for user 6 in tenant 1 {"SourceContext":"AuthService.Services.TokenService","ActionId":"a19ac64a-9aa7-4a82-b6b4-3f32c7559660","ActionName":"AuthService.Controllers.AuthController.RefreshToken (AuthService)","RequestId":"0HNEPTT9921SG:00000001","RequestPath":"/api/auth/refresh","ConnectionId":"0HNEPTT9921SG"}
[2025-08-12 17:26:48.098 -05:00 INF] üîç TOKEN DEBUG: User.TenantUsers collection status: Count=0, IsNull=false {"SourceContext":"AuthService.Services.TokenService","ActionId":"a19ac64a-9aa7-4a82-b6b4-3f32c7559660","ActionName":"AuthService.Controllers.AuthController.RefreshToken (AuthService)","RequestId":"0HNEPTT9921SF:00000001","RequestPath":"/api/auth/refresh","ConnectionId":"0HNEPTT9921SF"}
[2025-08-12 17:26:48.101 -05:00 INF] üîç TOKEN DEBUG: User.TenantUsers collection status: Count=0, IsNull=false {"SourceContext":"AuthService.Services.TokenService","ActionId":"a19ac64a-9aa7-4a82-b6b4-3f32c7559660","ActionName":"AuthService.Controllers.AuthController.RefreshToken (AuthService)","RequestId":"0HNEPTT9921SG:00000001","RequestPath":"/api/auth/refresh","ConnectionId":"0HNEPTT9921SG"}
[2025-08-12 17:26:48.105 -05:00 WRN] üîç TOKEN DEBUG: No TenantUsers found for user 6 {"SourceContext":"AuthService.Services.TokenService","ActionId":"a19ac64a-9aa7-4a82-b6b4-3f32c7559660","ActionName":"AuthService.Controllers.AuthController.RefreshToken (AuthService)","RequestId":"0HNEPTT9921SF:00000001","RequestPath":"/api/auth/refresh","ConnectionId":"0HNEPTT9921SF"}
[2025-08-12 17:26:48.108 -05:00 WRN] üîç TOKEN DEBUG: No TenantUsers found for user 6 {"SourceContext":"AuthService.Services.TokenService","ActionId":"a19ac64a-9aa7-4a82-b6b4-3f32c7559660","ActionName":"AuthService.Controllers.AuthController.RefreshToken (AuthService)","RequestId":"0HNEPTT9921SG:00000001","RequestPath":"/api/auth/refresh","ConnectionId":"0HNEPTT9921SG"}
[2025-08-12 17:26:48.112 -05:00 INF] üîç TOKEN DEBUG: Attempting to load roles from UserRoles table as fallback... {"SourceContext":"AuthService.Services.TokenService","ActionId":"a19ac64a-9aa7-4a82-b6b4-3f32c7559660","ActionName":"AuthService.Controllers.AuthController.RefreshToken (AuthService)","RequestId":"0HNEPTT9921SF:00000001","RequestPath":"/api/auth/refresh","ConnectionId":"0HNEPTT9921SF"}
[2025-08-12 17:26:48.116 -05:00 INF] üîç TOKEN DEBUG: Attempting to load roles from UserRoles table as fallback... {"SourceContext":"AuthService.Services.TokenService","ActionId":"a19ac64a-9aa7-4a82-b6b4-3f32c7559660","ActionName":"AuthService.Controllers.AuthController.RefreshToken (AuthService)","RequestId":"0HNEPTT9921SG:00000001","RequestPath":"/api/auth/refresh","ConnectionId":"0HNEPTT9921SG"}
[2025-08-12 17:26:48.182 -05:00 ERR] Failed executing DbCommand (7ms) [Parameters=[@__user_Id_0='?' (DbType = Int32), @__tenant_Id_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."CreatedAt", u."ExpiresAt", u."IsActive", u."RoleId", u."TenantId", u."UpdatedAt", u."UserId", u."UserId1", r."Id", r."CreatedAt", r."Description", r."IsActive", r."IsDefault", r."IsSystemRole", r."Name", r."TenantId", r."UpdatedAt"
FROM "UserRoles" AS u
INNER JOIN "Roles" AS r ON u."RoleId" = r."Id"
WHERE u."UserId" = @__user_Id_0 AND u."IsActive" AND u."TenantId" = @__tenant_Id_1 {"EventId":{"Id":20102,"Name":"Microsoft.EntityFrameworkCore.Database.Command.CommandError"},"SourceContext":"Microsoft.EntityFrameworkCore.Database.Command","ActionId":"a19ac64a-9aa7-4a82-b6b4-3f32c7559660","ActionName":"AuthService.Controllers.AuthController.RefreshToken (AuthService)","RequestId":"0HNEPTT9921SG:00000001","RequestPath":"/api/auth/refresh","ConnectionId":"0HNEPTT9921SG"}
[2025-08-12 17:26:48.182 -05:00 ERR] Failed executing DbCommand (7ms) [Parameters=[@__user_Id_0='?' (DbType = Int32), @__tenant_Id_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."CreatedAt", u."ExpiresAt", u."IsActive", u."RoleId", u."TenantId", u."UpdatedAt", u."UserId", u."UserId1", r."Id", r."CreatedAt", r."Description", r."IsActive", r."IsDefault", r."IsSystemRole", r."Name", r."TenantId", r."UpdatedAt"
FROM "UserRoles" AS u
INNER JOIN "Roles" AS r ON u."RoleId" = r."Id"
WHERE u."UserId" = @__user_Id_0 AND u."IsActive" AND u."TenantId" = @__tenant_Id_1 {"EventId":{"Id":20102,"Name":"Microsoft.EntityFrameworkCore.Database.Command.CommandError"},"SourceContext":"Microsoft.EntityFrameworkCore.Database.Command","ActionId":"a19ac64a-9aa7-4a82-b6b4-3f32c7559660","ActionName":"AuthService.Controllers.AuthController.RefreshToken (AuthService)","RequestId":"0HNEPTT9921SF:00000001","RequestPath":"/api/auth/refresh","ConnectionId":"0HNEPTT9921SF"}
[2025-08-12 17:26:48.196 -05:00 ERR] An exception occurred while iterating over the results of a query for context type 'Common.Data.ApplicationDbContext'.
Npgsql.PostgresException (0x80004005): 42703: column u.UserId1 does not exist

POSITION: 145
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
  Exception data:
    Severity: ERROR
    SqlState: 42703
    MessageText: column u.UserId1 does not exist
    Hint: Perhaps you meant to reference the column "u.UserId".
    Position: 145
    File: parse_relation.c
    Line: 3665
    Routine: errorMissingColumn {"EventId":{"Id":10100,"Name":"Microsoft.EntityFrameworkCore.Query.QueryIterationFailed"},"SourceContext":"Microsoft.EntityFrameworkCore.Query","ActionId":"a19ac64a-9aa7-4a82-b6b4-3f32c7559660","ActionName":"AuthService.Controllers.AuthController.RefreshToken (AuthService)","RequestId":"0HNEPTT9921SG:00000001","RequestPath":"/api/auth/refresh","ConnectionId":"0HNEPTT9921SG"}
Npgsql.PostgresException (0x80004005): 42703: column u.UserId1 does not exist

POSITION: 145
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
  Exception data:
    Severity: ERROR
    SqlState: 42703
    MessageText: column u.UserId1 does not exist
    Hint: Perhaps you meant to reference the column "u.UserId".
    Position: 145
    File: parse_relation.c
    Line: 3665
    Routine: errorMissingColumn
[2025-08-12 17:26:48.196 -05:00 ERR] An exception occurred while iterating over the results of a query for context type 'Common.Data.ApplicationDbContext'.
Npgsql.PostgresException (0x80004005): 42703: column u.UserId1 does not exist

POSITION: 145
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
  Exception data:
    Severity: ERROR
    SqlState: 42703
    MessageText: column u.UserId1 does not exist
    Hint: Perhaps you meant to reference the column "u.UserId".
    Position: 145
    File: parse_relation.c
    Line: 3665
    Routine: errorMissingColumn {"EventId":{"Id":10100,"Name":"Microsoft.EntityFrameworkCore.Query.QueryIterationFailed"},"SourceContext":"Microsoft.EntityFrameworkCore.Query","ActionId":"a19ac64a-9aa7-4a82-b6b4-3f32c7559660","ActionName":"AuthService.Controllers.AuthController.RefreshToken (AuthService)","RequestId":"0HNEPTT9921SF:00000001","RequestPath":"/api/auth/refresh","ConnectionId":"0HNEPTT9921SF"}
Npgsql.PostgresException (0x80004005): 42703: column u.UserId1 does not exist

POSITION: 145
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
  Exception data:
    Severity: ERROR
    SqlState: 42703
    MessageText: column u.UserId1 does not exist
    Hint: Perhaps you meant to reference the column "u.UserId".
    Position: 145
    File: parse_relation.c
    Line: 3665
    Routine: errorMissingColumn
[2025-08-12 17:26:48.205 -05:00 ERR] üîç TOKEN DEBUG: Failed to load roles from UserRoles table {"SourceContext":"AuthService.Services.TokenService","ActionId":"a19ac64a-9aa7-4a82-b6b4-3f32c7559660","ActionName":"AuthService.Controllers.AuthController.RefreshToken (AuthService)","RequestId":"0HNEPTT9921SG:00000001","RequestPath":"/api/auth/refresh","ConnectionId":"0HNEPTT9921SG"}
Npgsql.PostgresException (0x80004005): 42703: column u.UserId1 does not exist

POSITION: 145
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at AuthService.Services.TokenService.GenerateAccessTokenAsync(User user, Tenant tenant) in C:\Users\mccre\dev\boiler\src\services\AuthService\Services\TokenService.cs:line 101
  Exception data:
    Severity: ERROR
    SqlState: 42703
    MessageText: column u.UserId1 does not exist
    Hint: Perhaps you meant to reference the column "u.UserId".
    Position: 145
    File: parse_relation.c
    Line: 3665
    Routine: errorMissingColumn
[2025-08-12 17:26:48.209 -05:00 ERR] üîç TOKEN DEBUG: Failed to load roles from UserRoles table {"SourceContext":"AuthService.Services.TokenService","ActionId":"a19ac64a-9aa7-4a82-b6b4-3f32c7559660","ActionName":"AuthService.Controllers.AuthController.RefreshToken (AuthService)","RequestId":"0HNEPTT9921SF:00000001","RequestPath":"/api/auth/refresh","ConnectionId":"0HNEPTT9921SF"}
Npgsql.PostgresException (0x80004005): 42703: column u.UserId1 does not exist

POSITION: 145
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at AuthService.Services.TokenService.GenerateAccessTokenAsync(User user, Tenant tenant) in C:\Users\mccre\dev\boiler\src\services\AuthService\Services\TokenService.cs:line 101
  Exception data:
    Severity: ERROR
    SqlState: 42703
    MessageText: column u.UserId1 does not exist
    Hint: Perhaps you meant to reference the column "u.UserId".
    Position: 145
    File: parse_relation.c
    Line: 3665
    Routine: errorMissingColumn
[2025-08-12 17:26:48.258 -05:00 INF] üîç TOKEN DEBUG: Total roles added to token: 0 {"SourceContext":"AuthService.Services.TokenService","ActionId":"a19ac64a-9aa7-4a82-b6b4-3f32c7559660","ActionName":"AuthService.Controllers.AuthController.RefreshToken (AuthService)","RequestId":"0HNEPTT9921SG:00000001","RequestPath":"/api/auth/refresh","ConnectionId":"0HNEPTT9921SG"}
[2025-08-12 17:26:48.276 -05:00 INF] üîç TOKEN DEBUG: Total roles added to token: 0 {"SourceContext":"AuthService.Services.TokenService","ActionId":"a19ac64a-9aa7-4a82-b6b4-3f32c7559660","ActionName":"AuthService.Controllers.AuthController.RefreshToken (AuthService)","RequestId":"0HNEPTT9921SF:00000001","RequestPath":"/api/auth/refresh","ConnectionId":"0HNEPTT9921SF"}
[2025-08-12 17:26:48.277 -05:00 INF] üîç TOKEN DEBUG: Attempting to resolve IPermissionService for user 6 {"SourceContext":"AuthService.Services.TokenService","ActionId":"a19ac64a-9aa7-4a82-b6b4-3f32c7559660","ActionName":"AuthService.Controllers.AuthController.RefreshToken (AuthService)","RequestId":"0HNEPTT9921SG:00000001","RequestPath":"/api/auth/refresh","ConnectionId":"0HNEPTT9921SG"}
[2025-08-12 17:26:48.278 -05:00 INF] üîç TOKEN DEBUG: Attempting to resolve IPermissionService for user 6 {"SourceContext":"AuthService.Services.TokenService","ActionId":"a19ac64a-9aa7-4a82-b6b4-3f32c7559660","ActionName":"AuthService.Controllers.AuthController.RefreshToken (AuthService)","RequestId":"0HNEPTT9921SF:00000001","RequestPath":"/api/auth/refresh","ConnectionId":"0HNEPTT9921SF"}
[2025-08-12 17:26:48.282 -05:00 INF] üîç TOKEN DEBUG: IPermissionService resolved successfully, getting permissions for user 6 in tenant 1 {"SourceContext":"AuthService.Services.TokenService","ActionId":"a19ac64a-9aa7-4a82-b6b4-3f32c7559660","ActionName":"AuthService.Controllers.AuthController.RefreshToken (AuthService)","RequestId":"0HNEPTT9921SG:00000001","RequestPath":"/api/auth/refresh","ConnectionId":"0HNEPTT9921SG"}
[2025-08-12 17:26:48.283 -05:00 INF] üîç TOKEN DEBUG: IPermissionService resolved successfully, getting permissions for user 6 in tenant 1 {"SourceContext":"AuthService.Services.TokenService","ActionId":"a19ac64a-9aa7-4a82-b6b4-3f32c7559660","ActionName":"AuthService.Controllers.AuthController.RefreshToken (AuthService)","RequestId":"0HNEPTT9921SF:00000001","RequestPath":"/api/auth/refresh","ConnectionId":"0HNEPTT9921SF"}
[2025-08-12 17:26:48.288 -05:00 INF] üîç PERMISSION DEBUG: Getting permissions for user 6 in tenant 1 {"SourceContext":"Common.Services.PermissionService","ActionId":"a19ac64a-9aa7-4a82-b6b4-3f32c7559660","ActionName":"AuthService.Controllers.AuthController.RefreshToken (AuthService)","RequestId":"0HNEPTT9921SG:00000001","RequestPath":"/api/auth/refresh","ConnectionId":"0HNEPTT9921SG"}
[2025-08-12 17:26:48.288 -05:00 INF] üîç PERMISSION DEBUG: Getting permissions for user 6 in tenant 1 {"SourceContext":"Common.Services.PermissionService","ActionId":"a19ac64a-9aa7-4a82-b6b4-3f32c7559660","ActionName":"AuthService.Controllers.AuthController.RefreshToken (AuthService)","RequestId":"0HNEPTT9921SF:00000001","RequestPath":"/api/auth/refresh","ConnectionId":"0HNEPTT9921SF"}
[2025-08-12 17:26:48.296 -05:00 ERR] Failed executing DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32), @__tenantId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."CreatedAt", u."ExpiresAt", u."IsActive", u."RoleId", u."TenantId", u."UpdatedAt", u."UserId", u."UserId1"
FROM "UserRoles" AS u
WHERE u."UserId" = @__userId_0 AND u."TenantId" = @__tenantId_1 AND u."IsActive" {"EventId":{"Id":20102,"Name":"Microsoft.EntityFrameworkCore.Database.Command.CommandError"},"SourceContext":"Microsoft.EntityFrameworkCore.Database.Command","ActionId":"a19ac64a-9aa7-4a82-b6b4-3f32c7559660","ActionName":"AuthService.Controllers.AuthController.RefreshToken (AuthService)","RequestId":"0HNEPTT9921SF:00000001","RequestPath":"/api/auth/refresh","ConnectionId":"0HNEPTT9921SF"}
[2025-08-12 17:26:48.296 -05:00 ERR] Failed executing DbCommand (2ms) [Parameters=[@__userId_0='?' (DbType = Int32), @__tenantId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."CreatedAt", u."ExpiresAt", u."IsActive", u."RoleId", u."TenantId", u."UpdatedAt", u."UserId", u."UserId1"
FROM "UserRoles" AS u
WHERE u."UserId" = @__userId_0 AND u."TenantId" = @__tenantId_1 AND u."IsActive" {"EventId":{"Id":20102,"Name":"Microsoft.EntityFrameworkCore.Database.Command.CommandError"},"SourceContext":"Microsoft.EntityFrameworkCore.Database.Command","ActionId":"a19ac64a-9aa7-4a82-b6b4-3f32c7559660","ActionName":"AuthService.Controllers.AuthController.RefreshToken (AuthService)","RequestId":"0HNEPTT9921SG:00000001","RequestPath":"/api/auth/refresh","ConnectionId":"0HNEPTT9921SG"}
[2025-08-12 17:26:48.307 -05:00 ERR] An exception occurred while iterating over the results of a query for context type 'Common.Data.ApplicationDbContext'.
Npgsql.PostgresException (0x80004005): 42703: column u.UserId1 does not exist

POSITION: 145
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
  Exception data:
    Severity: ERROR
    SqlState: 42703
    MessageText: column u.UserId1 does not exist
    Hint: Perhaps you meant to reference the column "u.UserId".
    Position: 145
    File: parse_relation.c
    Line: 3665
    Routine: errorMissingColumn {"EventId":{"Id":10100,"Name":"Microsoft.EntityFrameworkCore.Query.QueryIterationFailed"},"SourceContext":"Microsoft.EntityFrameworkCore.Query","ActionId":"a19ac64a-9aa7-4a82-b6b4-3f32c7559660","ActionName":"AuthService.Controllers.AuthController.RefreshToken (AuthService)","RequestId":"0HNEPTT9921SF:00000001","RequestPath":"/api/auth/refresh","ConnectionId":"0HNEPTT9921SF"}
Npgsql.PostgresException (0x80004005): 42703: column u.UserId1 does not exist

POSITION: 145
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
  Exception data:
    Severity: ERROR
    SqlState: 42703
    MessageText: column u.UserId1 does not exist
    Hint: Perhaps you meant to reference the column "u.UserId".
    Position: 145
    File: parse_relation.c
    Line: 3665
    Routine: errorMissingColumn
[2025-08-12 17:26:48.309 -05:00 ERR] An exception occurred while iterating over the results of a query for context type 'Common.Data.ApplicationDbContext'.
Npgsql.PostgresException (0x80004005): 42703: column u.UserId1 does not exist

POSITION: 145
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
  Exception data:
    Severity: ERROR
    SqlState: 42703
    MessageText: column u.UserId1 does not exist
    Hint: Perhaps you meant to reference the column "u.UserId".
    Position: 145
    File: parse_relation.c
    Line: 3665
    Routine: errorMissingColumn {"EventId":{"Id":10100,"Name":"Microsoft.EntityFrameworkCore.Query.QueryIterationFailed"},"SourceContext":"Microsoft.EntityFrameworkCore.Query","ActionId":"a19ac64a-9aa7-4a82-b6b4-3f32c7559660","ActionName":"AuthService.Controllers.AuthController.RefreshToken (AuthService)","RequestId":"0HNEPTT9921SG:00000001","RequestPath":"/api/auth/refresh","ConnectionId":"0HNEPTT9921SG"}
Npgsql.PostgresException (0x80004005): 42703: column u.UserId1 does not exist

POSITION: 145
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
  Exception data:
    Severity: ERROR
    SqlState: 42703
    MessageText: column u.UserId1 does not exist
    Hint: Perhaps you meant to reference the column "u.UserId".
    Position: 145
    File: parse_relation.c
    Line: 3665
    Routine: errorMissingColumn
[2025-08-12 17:26:48.322 -05:00 ERR] üîç PERMISSION DEBUG: Error getting permissions for user 6 in tenant 1 {"SourceContext":"Common.Services.PermissionService","ActionId":"a19ac64a-9aa7-4a82-b6b4-3f32c7559660","ActionName":"AuthService.Controllers.AuthController.RefreshToken (AuthService)","RequestId":"0HNEPTT9921SF:00000001","RequestPath":"/api/auth/refresh","ConnectionId":"0HNEPTT9921SF"}
Npgsql.PostgresException (0x80004005): 42703: column u.UserId1 does not exist

POSITION: 145
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Common.Services.PermissionService.GetUserPermissionsForTenantAsync(Int32 userId, Int32 tenantId, CancellationToken cancellationToken) in C:\Users\mccre\dev\boiler\src\shared\Common\Services\PermissionService.cs:line 100
  Exception data:
    Severity: ERROR
    SqlState: 42703
    MessageText: column u.UserId1 does not exist
    Hint: Perhaps you meant to reference the column "u.UserId".
    Position: 145
    File: parse_relation.c
    Line: 3665
    Routine: errorMissingColumn
[2025-08-12 17:26:48.327 -05:00 ERR] üîç PERMISSION DEBUG: Error getting permissions for user 6 in tenant 1 {"SourceContext":"Common.Services.PermissionService","ActionId":"a19ac64a-9aa7-4a82-b6b4-3f32c7559660","ActionName":"AuthService.Controllers.AuthController.RefreshToken (AuthService)","RequestId":"0HNEPTT9921SG:00000001","RequestPath":"/api/auth/refresh","ConnectionId":"0HNEPTT9921SG"}
Npgsql.PostgresException (0x80004005): 42703: column u.UserId1 does not exist

POSITION: 145
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Common.Services.PermissionService.GetUserPermissionsForTenantAsync(Int32 userId, Int32 tenantId, CancellationToken cancellationToken) in C:\Users\mccre\dev\boiler\src\shared\Common\Services\PermissionService.cs:line 100
  Exception data:
    Severity: ERROR
    SqlState: 42703
    MessageText: column u.UserId1 does not exist
    Hint: Perhaps you meant to reference the column "u.UserId".
    Position: 145
    File: parse_relation.c
    Line: 3665
    Routine: errorMissingColumn
[2025-08-12 17:26:48.374 -05:00 INF] üîç TOKEN DEBUG: Retrieved 0 permissions for user 6:  {"SourceContext":"AuthService.Services.TokenService","ActionId":"a19ac64a-9aa7-4a82-b6b4-3f32c7559660","ActionName":"AuthService.Controllers.AuthController.RefreshToken (AuthService)","RequestId":"0HNEPTT9921SF:00000001","RequestPath":"/api/auth/refresh","ConnectionId":"0HNEPTT9921SF"}
[2025-08-12 17:26:48.379 -05:00 INF] üîç TOKEN DEBUG: Retrieved 0 permissions for user 6:  {"SourceContext":"AuthService.Services.TokenService","ActionId":"a19ac64a-9aa7-4a82-b6b4-3f32c7559660","ActionName":"AuthService.Controllers.AuthController.RefreshToken (AuthService)","RequestId":"0HNEPTT9921SG:00000001","RequestPath":"/api/auth/refresh","ConnectionId":"0HNEPTT9921SG"}
[2025-08-12 17:26:48.382 -05:00 INF] üîç TOKEN DEBUG: Successfully added 0 permission claims to JWT for user 6 {"SourceContext":"AuthService.Services.TokenService","ActionId":"a19ac64a-9aa7-4a82-b6b4-3f32c7559660","ActionName":"AuthService.Controllers.AuthController.RefreshToken (AuthService)","RequestId":"0HNEPTT9921SF:00000001","RequestPath":"/api/auth/refresh","ConnectionId":"0HNEPTT9921SF"}
[2025-08-12 17:26:48.387 -05:00 INF] üîç TOKEN DEBUG: Successfully added 0 permission claims to JWT for user 6 {"SourceContext":"AuthService.Services.TokenService","ActionId":"a19ac64a-9aa7-4a82-b6b4-3f32c7559660","ActionName":"AuthService.Controllers.AuthController.RefreshToken (AuthService)","RequestId":"0HNEPTT9921SG:00000001","RequestPath":"/api/auth/refresh","ConnectionId":"0HNEPTT9921SG"}
[2025-08-12 17:26:48.390 -05:00 INF] üîç TOKEN DEBUG: Total claims count before token generation: 11 {"SourceContext":"AuthService.Services.TokenService","ActionId":"a19ac64a-9aa7-4a82-b6b4-3f32c7559660","ActionName":"AuthService.Controllers.AuthController.RefreshToken (AuthService)","RequestId":"0HNEPTT9921SF:00000001","RequestPath":"/api/auth/refresh","ConnectionId":"0HNEPTT9921SF"}
[2025-08-12 17:26:48.392 -05:00 INF] üîç TOKEN DEBUG: Total claims count before token generation: 11 {"SourceContext":"AuthService.Services.TokenService","ActionId":"a19ac64a-9aa7-4a82-b6b4-3f32c7559660","ActionName":"AuthService.Controllers.AuthController.RefreshToken (AuthService)","RequestId":"0HNEPTT9921SG:00000001","RequestPath":"/api/auth/refresh","ConnectionId":"0HNEPTT9921SG"}
[2025-08-12 17:26:48.400 -05:00 INF] üîç TOKEN DEBUG: Token generation completed for user 6 {"SourceContext":"AuthService.Services.TokenService","ActionId":"a19ac64a-9aa7-4a82-b6b4-3f32c7559660","ActionName":"AuthService.Controllers.AuthController.RefreshToken (AuthService)","RequestId":"0HNEPTT9921SF:00000001","RequestPath":"/api/auth/refresh","ConnectionId":"0HNEPTT9921SF"}
[2025-08-12 17:26:48.400 -05:00 INF] üîç TOKEN DEBUG: Token generation completed for user 6 {"SourceContext":"AuthService.Services.TokenService","ActionId":"a19ac64a-9aa7-4a82-b6b4-3f32c7559660","ActionName":"AuthService.Controllers.AuthController.RefreshToken (AuthService)","RequestId":"0HNEPTT9921SG:00000001","RequestPath":"/api/auth/refresh","ConnectionId":"0HNEPTT9921SG"}
[2025-08-12 17:26:48.515 -05:00 INF] Token refreshed for user 6 {"SourceContext":"AuthService.Services.AuthServiceImplementation","ActionId":"a19ac64a-9aa7-4a82-b6b4-3f32c7559660","ActionName":"AuthService.Controllers.AuthController.RefreshToken (AuthService)","RequestId":"0HNEPTT9921SG:00000001","RequestPath":"/api/auth/refresh","ConnectionId":"0HNEPTT9921SG"}
[2025-08-12 17:26:48.516 -05:00 INF] Token refreshed for user 6 {"SourceContext":"AuthService.Services.AuthServiceImplementation","ActionId":"a19ac64a-9aa7-4a82-b6b4-3f32c7559660","ActionName":"AuthService.Controllers.AuthController.RefreshToken (AuthService)","RequestId":"0HNEPTT9921SF:00000001","RequestPath":"/api/auth/refresh","ConnectionId":"0HNEPTT9921SF"}
[2025-08-12 17:26:48.537 -05:00 INF] HTTP POST /api/auth/refresh responded 200 in 2259.5257 ms {"SourceContext":"Serilog.AspNetCore.RequestLoggingMiddleware"}
[2025-08-12 17:26:48.537 -05:00 INF] HTTP POST /api/auth/refresh responded 200 in 2259.5242 ms {"SourceContext":"Serilog.AspNetCore.RequestLoggingMiddleware"}
[2025-08-12 17:26:52.511 -05:00 WRN] üîç LOGIN DEBUG: Starting login for mccrearyforward@gmail.com {"SourceContext":"AuthService.Services.AuthServiceImplementation","ActionId":"641d00cf-34c9-4c61-b632-2433f51a66f3","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPTT9921SH:00000001","RequestPath":"/api/auth/login","ConnectionId":"0HNEPTT9921SH"}
[2025-08-12 17:26:52.573 -05:00 WRN] üîç LOGIN DEBUG: User found: true, IsActive: true, TenantId: 1 {"SourceContext":"AuthService.Services.AuthServiceImplementation","ActionId":"641d00cf-34c9-4c61-b632-2433f51a66f3","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPTT9921SH:00000001","RequestPath":"/api/auth/login","ConnectionId":"0HNEPTT9921SH"}
[2025-08-12 17:26:52.580 -05:00 WRN] üîç LOGIN DEBUG: Attempting password verification for mccrearyforward@gmail.com {"SourceContext":"AuthService.Services.AuthServiceImplementation","ActionId":"641d00cf-34c9-4c61-b632-2433f51a66f3","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPTT9921SH:00000001","RequestPath":"/api/auth/login","ConnectionId":"0HNEPTT9921SH"}
[2025-08-12 17:26:52.582 -05:00 WRN] üîç LOGIN DEBUG: Password length: 11, Hash starts with: $2a$12$FoF {"SourceContext":"AuthService.Services.AuthServiceImplementation","ActionId":"641d00cf-34c9-4c61-b632-2433f51a66f3","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPTT9921SH:00000001","RequestPath":"/api/auth/login","ConnectionId":"0HNEPTT9921SH"}
[2025-08-12 17:26:53.428 -05:00 WRN] üîç LOGIN DEBUG: Password verification result: true {"SourceContext":"AuthService.Services.AuthServiceImplementation","ActionId":"641d00cf-34c9-4c61-b632-2433f51a66f3","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPTT9921SH:00000001","RequestPath":"/api/auth/login","ConnectionId":"0HNEPTT9921SH"}
[2025-08-12 17:26:53.431 -05:00 WRN] üîç LOGIN DEBUG: Checking tenant relationship. PrimaryTenant: true, TenantId: 1 {"SourceContext":"AuthService.Services.AuthServiceImplementation","ActionId":"641d00cf-34c9-4c61-b632-2433f51a66f3","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPTT9921SH:00000001","RequestPath":"/api/auth/login","ConnectionId":"0HNEPTT9921SH"}
[2025-08-12 17:26:53.434 -05:00 INF] üîç TOKEN DEBUG: Starting token generation for user 6 in tenant 1 {"SourceContext":"AuthService.Services.TokenService","ActionId":"641d00cf-34c9-4c61-b632-2433f51a66f3","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPTT9921SH:00000001","RequestPath":"/api/auth/login","ConnectionId":"0HNEPTT9921SH"}
[2025-08-12 17:26:53.436 -05:00 INF] üîç TOKEN DEBUG: User.TenantUsers collection status: Count=1, IsNull=false {"SourceContext":"AuthService.Services.TokenService","ActionId":"641d00cf-34c9-4c61-b632-2433f51a66f3","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPTT9921SH:00000001","RequestPath":"/api/auth/login","ConnectionId":"0HNEPTT9921SH"}
[2025-08-12 17:26:53.439 -05:00 INF] üîç TOKEN DEBUG: TenantUser found: TenantId=1, Role=User, IsActive=true {"SourceContext":"AuthService.Services.TokenService","ActionId":"641d00cf-34c9-4c61-b632-2433f51a66f3","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPTT9921SH:00000001","RequestPath":"/api/auth/login","ConnectionId":"0HNEPTT9921SH"}
[2025-08-12 17:26:53.441 -05:00 INF] üîç TOKEN DEBUG: Added role claim 'User' for user 6 {"SourceContext":"AuthService.Services.TokenService","ActionId":"641d00cf-34c9-4c61-b632-2433f51a66f3","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPTT9921SH:00000001","RequestPath":"/api/auth/login","ConnectionId":"0HNEPTT9921SH"}
[2025-08-12 17:26:53.446 -05:00 INF] üîç TOKEN DEBUG: Total roles added to token: 1 {"SourceContext":"AuthService.Services.TokenService","ActionId":"641d00cf-34c9-4c61-b632-2433f51a66f3","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPTT9921SH:00000001","RequestPath":"/api/auth/login","ConnectionId":"0HNEPTT9921SH"}
[2025-08-12 17:26:53.448 -05:00 INF] üîç TOKEN DEBUG: Attempting to resolve IPermissionService for user 6 {"SourceContext":"AuthService.Services.TokenService","ActionId":"641d00cf-34c9-4c61-b632-2433f51a66f3","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPTT9921SH:00000001","RequestPath":"/api/auth/login","ConnectionId":"0HNEPTT9921SH"}
[2025-08-12 17:26:53.450 -05:00 INF] üîç TOKEN DEBUG: IPermissionService resolved successfully, getting permissions for user 6 in tenant 1 {"SourceContext":"AuthService.Services.TokenService","ActionId":"641d00cf-34c9-4c61-b632-2433f51a66f3","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPTT9921SH:00000001","RequestPath":"/api/auth/login","ConnectionId":"0HNEPTT9921SH"}
[2025-08-12 17:26:53.453 -05:00 INF] üîç PERMISSION DEBUG: Getting permissions for user 6 in tenant 1 {"SourceContext":"Common.Services.PermissionService","ActionId":"641d00cf-34c9-4c61-b632-2433f51a66f3","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPTT9921SH:00000001","RequestPath":"/api/auth/login","ConnectionId":"0HNEPTT9921SH"}
[2025-08-12 17:26:53.459 -05:00 ERR] Failed executing DbCommand (3ms) [Parameters=[@__userId_0='?' (DbType = Int32), @__tenantId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."CreatedAt", u."ExpiresAt", u."IsActive", u."RoleId", u."TenantId", u."UpdatedAt", u."UserId", u."UserId1"
FROM "UserRoles" AS u
WHERE u."UserId" = @__userId_0 AND u."TenantId" = @__tenantId_1 AND u."IsActive" {"EventId":{"Id":20102,"Name":"Microsoft.EntityFrameworkCore.Database.Command.CommandError"},"SourceContext":"Microsoft.EntityFrameworkCore.Database.Command","ActionId":"641d00cf-34c9-4c61-b632-2433f51a66f3","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPTT9921SH:00000001","RequestPath":"/api/auth/login","ConnectionId":"0HNEPTT9921SH"}
[2025-08-12 17:26:53.464 -05:00 ERR] An exception occurred while iterating over the results of a query for context type 'Common.Data.ApplicationDbContext'.
Npgsql.PostgresException (0x80004005): 42703: column u.UserId1 does not exist

POSITION: 145
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
  Exception data:
    Severity: ERROR
    SqlState: 42703
    MessageText: column u.UserId1 does not exist
    Hint: Perhaps you meant to reference the column "u.UserId".
    Position: 145
    File: parse_relation.c
    Line: 3665
    Routine: errorMissingColumn {"EventId":{"Id":10100,"Name":"Microsoft.EntityFrameworkCore.Query.QueryIterationFailed"},"SourceContext":"Microsoft.EntityFrameworkCore.Query","ActionId":"641d00cf-34c9-4c61-b632-2433f51a66f3","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPTT9921SH:00000001","RequestPath":"/api/auth/login","ConnectionId":"0HNEPTT9921SH"}
Npgsql.PostgresException (0x80004005): 42703: column u.UserId1 does not exist

POSITION: 145
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
  Exception data:
    Severity: ERROR
    SqlState: 42703
    MessageText: column u.UserId1 does not exist
    Hint: Perhaps you meant to reference the column "u.UserId".
    Position: 145
    File: parse_relation.c
    Line: 3665
    Routine: errorMissingColumn
[2025-08-12 17:26:53.471 -05:00 ERR] üîç PERMISSION DEBUG: Error getting permissions for user 6 in tenant 1 {"SourceContext":"Common.Services.PermissionService","ActionId":"641d00cf-34c9-4c61-b632-2433f51a66f3","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPTT9921SH:00000001","RequestPath":"/api/auth/login","ConnectionId":"0HNEPTT9921SH"}
Npgsql.PostgresException (0x80004005): 42703: column u.UserId1 does not exist

POSITION: 145
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Common.Services.PermissionService.GetUserPermissionsForTenantAsync(Int32 userId, Int32 tenantId, CancellationToken cancellationToken) in C:\Users\mccre\dev\boiler\src\shared\Common\Services\PermissionService.cs:line 100
  Exception data:
    Severity: ERROR
    SqlState: 42703
    MessageText: column u.UserId1 does not exist
    Hint: Perhaps you meant to reference the column "u.UserId".
    Position: 145
    File: parse_relation.c
    Line: 3665
    Routine: errorMissingColumn
[2025-08-12 17:26:53.479 -05:00 INF] üîç TOKEN DEBUG: Retrieved 0 permissions for user 6:  {"SourceContext":"AuthService.Services.TokenService","ActionId":"641d00cf-34c9-4c61-b632-2433f51a66f3","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPTT9921SH:00000001","RequestPath":"/api/auth/login","ConnectionId":"0HNEPTT9921SH"}
[2025-08-12 17:26:53.481 -05:00 INF] üîç TOKEN DEBUG: Successfully added 0 permission claims to JWT for user 6 {"SourceContext":"AuthService.Services.TokenService","ActionId":"641d00cf-34c9-4c61-b632-2433f51a66f3","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPTT9921SH:00000001","RequestPath":"/api/auth/login","ConnectionId":"0HNEPTT9921SH"}
[2025-08-12 17:26:53.483 -05:00 INF] üîç TOKEN DEBUG: Total claims count before token generation: 12 {"SourceContext":"AuthService.Services.TokenService","ActionId":"641d00cf-34c9-4c61-b632-2433f51a66f3","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPTT9921SH:00000001","RequestPath":"/api/auth/login","ConnectionId":"0HNEPTT9921SH"}
[2025-08-12 17:26:53.485 -05:00 INF] üîç TOKEN DEBUG: Token generation completed for user 6 {"SourceContext":"AuthService.Services.TokenService","ActionId":"641d00cf-34c9-4c61-b632-2433f51a66f3","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPTT9921SH:00000001","RequestPath":"/api/auth/login","ConnectionId":"0HNEPTT9921SH"}
[2025-08-12 17:26:53.501 -05:00 INF] User mccrearyforward@gmail.com logged in successfully {"SourceContext":"AuthService.Services.AuthServiceImplementation","ActionId":"641d00cf-34c9-4c61-b632-2433f51a66f3","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPTT9921SH:00000001","RequestPath":"/api/auth/login","ConnectionId":"0HNEPTT9921SH"}
[2025-08-12 17:26:53.504 -05:00 INF] HTTP POST /api/auth/login responded 200 in 1007.8418 ms {"SourceContext":"Serilog.AspNetCore.RequestLoggingMiddleware"}
[2025-08-12 17:28:11.446 -05:00 WRN] üîç LOGIN DEBUG: Starting login for admin@localhost {"SourceContext":"AuthService.Services.AuthServiceImplementation","ActionId":"641d00cf-34c9-4c61-b632-2433f51a66f3","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPTT9921SI:0000000F","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPTT9921SI"}
[2025-08-12 17:28:11.455 -05:00 WRN] üîç LOGIN DEBUG: User found: true, IsActive: true, TenantId: 1 {"SourceContext":"AuthService.Services.AuthServiceImplementation","ActionId":"641d00cf-34c9-4c61-b632-2433f51a66f3","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPTT9921SI:0000000F","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPTT9921SI"}
[2025-08-12 17:28:11.459 -05:00 WRN] üîç LOGIN DEBUG: Attempting password verification for admin@localhost {"SourceContext":"AuthService.Services.AuthServiceImplementation","ActionId":"641d00cf-34c9-4c61-b632-2433f51a66f3","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPTT9921SI:0000000F","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPTT9921SI"}
[2025-08-12 17:28:11.463 -05:00 WRN] üîç LOGIN DEBUG: Password length: 8, Hash starts with: $2a$12$29x {"SourceContext":"AuthService.Services.AuthServiceImplementation","ActionId":"641d00cf-34c9-4c61-b632-2433f51a66f3","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPTT9921SI:0000000F","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPTT9921SI"}
[2025-08-12 17:28:11.917 -05:00 WRN] üîç LOGIN DEBUG: Password verification result: true {"SourceContext":"AuthService.Services.AuthServiceImplementation","ActionId":"641d00cf-34c9-4c61-b632-2433f51a66f3","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPTT9921SI:0000000F","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPTT9921SI"}
[2025-08-12 17:28:11.920 -05:00 WRN] üîç LOGIN DEBUG: Checking tenant relationship. PrimaryTenant: true, TenantId: 1 {"SourceContext":"AuthService.Services.AuthServiceImplementation","ActionId":"641d00cf-34c9-4c61-b632-2433f51a66f3","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPTT9921SI:0000000F","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPTT9921SI"}
[2025-08-12 17:28:11.927 -05:00 INF] üîç TOKEN DEBUG: Starting token generation for user 2 in tenant 1 {"SourceContext":"AuthService.Services.TokenService","ActionId":"641d00cf-34c9-4c61-b632-2433f51a66f3","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPTT9921SI:0000000F","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPTT9921SI"}
[2025-08-12 17:28:11.930 -05:00 INF] üîç TOKEN DEBUG: User.TenantUsers collection status: Count=1, IsNull=false {"SourceContext":"AuthService.Services.TokenService","ActionId":"641d00cf-34c9-4c61-b632-2433f51a66f3","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPTT9921SI:0000000F","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPTT9921SI"}
[2025-08-12 17:28:11.932 -05:00 INF] üîç TOKEN DEBUG: TenantUser found: TenantId=1, Role=SuperAdmin, IsActive=true {"SourceContext":"AuthService.Services.TokenService","ActionId":"641d00cf-34c9-4c61-b632-2433f51a66f3","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPTT9921SI:0000000F","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPTT9921SI"}
[2025-08-12 17:28:11.933 -05:00 INF] üîç TOKEN DEBUG: Added role claim 'SuperAdmin' for user 2 {"SourceContext":"AuthService.Services.TokenService","ActionId":"641d00cf-34c9-4c61-b632-2433f51a66f3","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPTT9921SI:0000000F","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPTT9921SI"}
[2025-08-12 17:28:11.935 -05:00 INF] üîç TOKEN DEBUG: Total roles added to token: 1 {"SourceContext":"AuthService.Services.TokenService","ActionId":"641d00cf-34c9-4c61-b632-2433f51a66f3","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPTT9921SI:0000000F","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPTT9921SI"}
[2025-08-12 17:28:11.936 -05:00 INF] üîç TOKEN DEBUG: Attempting to resolve IPermissionService for user 2 {"SourceContext":"AuthService.Services.TokenService","ActionId":"641d00cf-34c9-4c61-b632-2433f51a66f3","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPTT9921SI:0000000F","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPTT9921SI"}
[2025-08-12 17:28:11.938 -05:00 INF] üîç TOKEN DEBUG: IPermissionService resolved successfully, getting permissions for user 2 in tenant 1 {"SourceContext":"AuthService.Services.TokenService","ActionId":"641d00cf-34c9-4c61-b632-2433f51a66f3","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPTT9921SI:0000000F","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPTT9921SI"}
[2025-08-12 17:28:11.942 -05:00 INF] üîç PERMISSION DEBUG: Getting permissions for user 2 in tenant 1 {"SourceContext":"Common.Services.PermissionService","ActionId":"641d00cf-34c9-4c61-b632-2433f51a66f3","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPTT9921SI:0000000F","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPTT9921SI"}
[2025-08-12 17:28:11.946 -05:00 ERR] Failed executing DbCommand (2ms) [Parameters=[@__userId_0='?' (DbType = Int32), @__tenantId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."CreatedAt", u."ExpiresAt", u."IsActive", u."RoleId", u."TenantId", u."UpdatedAt", u."UserId", u."UserId1"
FROM "UserRoles" AS u
WHERE u."UserId" = @__userId_0 AND u."TenantId" = @__tenantId_1 AND u."IsActive" {"EventId":{"Id":20102,"Name":"Microsoft.EntityFrameworkCore.Database.Command.CommandError"},"SourceContext":"Microsoft.EntityFrameworkCore.Database.Command","ActionId":"641d00cf-34c9-4c61-b632-2433f51a66f3","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPTT9921SI:0000000F","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPTT9921SI"}
[2025-08-12 17:28:11.950 -05:00 ERR] An exception occurred while iterating over the results of a query for context type 'Common.Data.ApplicationDbContext'.
Npgsql.PostgresException (0x80004005): 42703: column u.UserId1 does not exist

POSITION: 145
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
  Exception data:
    Severity: ERROR
    SqlState: 42703
    MessageText: column u.UserId1 does not exist
    Hint: Perhaps you meant to reference the column "u.UserId".
    Position: 145
    File: parse_relation.c
    Line: 3665
    Routine: errorMissingColumn {"EventId":{"Id":10100,"Name":"Microsoft.EntityFrameworkCore.Query.QueryIterationFailed"},"SourceContext":"Microsoft.EntityFrameworkCore.Query","ActionId":"641d00cf-34c9-4c61-b632-2433f51a66f3","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPTT9921SI:0000000F","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPTT9921SI"}
Npgsql.PostgresException (0x80004005): 42703: column u.UserId1 does not exist

POSITION: 145
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
  Exception data:
    Severity: ERROR
    SqlState: 42703
    MessageText: column u.UserId1 does not exist
    Hint: Perhaps you meant to reference the column "u.UserId".
    Position: 145
    File: parse_relation.c
    Line: 3665
    Routine: errorMissingColumn
[2025-08-12 17:28:11.959 -05:00 ERR] üîç PERMISSION DEBUG: Error getting permissions for user 2 in tenant 1 {"SourceContext":"Common.Services.PermissionService","ActionId":"641d00cf-34c9-4c61-b632-2433f51a66f3","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPTT9921SI:0000000F","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPTT9921SI"}
Npgsql.PostgresException (0x80004005): 42703: column u.UserId1 does not exist

POSITION: 145
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Common.Services.PermissionService.GetUserPermissionsForTenantAsync(Int32 userId, Int32 tenantId, CancellationToken cancellationToken) in C:\Users\mccre\dev\boiler\src\shared\Common\Services\PermissionService.cs:line 100
  Exception data:
    Severity: ERROR
    SqlState: 42703
    MessageText: column u.UserId1 does not exist
    Hint: Perhaps you meant to reference the column "u.UserId".
    Position: 145
    File: parse_relation.c
    Line: 3665
    Routine: errorMissingColumn
[2025-08-12 17:28:11.965 -05:00 INF] üîç TOKEN DEBUG: Retrieved 0 permissions for user 2:  {"SourceContext":"AuthService.Services.TokenService","ActionId":"641d00cf-34c9-4c61-b632-2433f51a66f3","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPTT9921SI:0000000F","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPTT9921SI"}
[2025-08-12 17:28:11.967 -05:00 INF] üîç TOKEN DEBUG: Successfully added 0 permission claims to JWT for user 2 {"SourceContext":"AuthService.Services.TokenService","ActionId":"641d00cf-34c9-4c61-b632-2433f51a66f3","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPTT9921SI:0000000F","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPTT9921SI"}
[2025-08-12 17:28:11.969 -05:00 INF] üîç TOKEN DEBUG: Total claims count before token generation: 12 {"SourceContext":"AuthService.Services.TokenService","ActionId":"641d00cf-34c9-4c61-b632-2433f51a66f3","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPTT9921SI:0000000F","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPTT9921SI"}
[2025-08-12 17:28:11.972 -05:00 INF] üîç TOKEN DEBUG: Token generation completed for user 2 {"SourceContext":"AuthService.Services.TokenService","ActionId":"641d00cf-34c9-4c61-b632-2433f51a66f3","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPTT9921SI:0000000F","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPTT9921SI"}
[2025-08-12 17:28:11.980 -05:00 INF] User admin@localhost logged in successfully {"SourceContext":"AuthService.Services.AuthServiceImplementation","ActionId":"641d00cf-34c9-4c61-b632-2433f51a66f3","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPTT9921SI:0000000F","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPTT9921SI"}
[2025-08-12 17:28:11.984 -05:00 INF] HTTP POST /api/Auth/login responded 200 in 541.5251 ms {"SourceContext":"Serilog.AspNetCore.RequestLoggingMiddleware"}
[2025-08-12 17:33:02.571 -05:00 WRN] üîç LOGIN DEBUG: Starting login for mccrearyforward@gmail.com {"SourceContext":"AuthService.Services.AuthServiceImplementation","ActionId":"641d00cf-34c9-4c61-b632-2433f51a66f3","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPTT9921SJ:00000003","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPTT9921SJ"}
[2025-08-12 17:33:02.602 -05:00 WRN] üîç LOGIN DEBUG: User found: true, IsActive: true, TenantId: 1 {"SourceContext":"AuthService.Services.AuthServiceImplementation","ActionId":"641d00cf-34c9-4c61-b632-2433f51a66f3","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPTT9921SJ:00000003","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPTT9921SJ"}
[2025-08-12 17:33:02.605 -05:00 WRN] üîç LOGIN DEBUG: Attempting password verification for mccrearyforward@gmail.com {"SourceContext":"AuthService.Services.AuthServiceImplementation","ActionId":"641d00cf-34c9-4c61-b632-2433f51a66f3","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPTT9921SJ:00000003","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPTT9921SJ"}
[2025-08-12 17:33:02.607 -05:00 WRN] üîç LOGIN DEBUG: Password length: 11, Hash starts with: $2a$12$FoF {"SourceContext":"AuthService.Services.AuthServiceImplementation","ActionId":"641d00cf-34c9-4c61-b632-2433f51a66f3","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPTT9921SJ:00000003","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPTT9921SJ"}
[2025-08-12 17:33:03.105 -05:00 WRN] üîç LOGIN DEBUG: Password verification result: true {"SourceContext":"AuthService.Services.AuthServiceImplementation","ActionId":"641d00cf-34c9-4c61-b632-2433f51a66f3","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPTT9921SJ:00000003","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPTT9921SJ"}
[2025-08-12 17:33:03.107 -05:00 WRN] üîç LOGIN DEBUG: Checking tenant relationship. PrimaryTenant: true, TenantId: 1 {"SourceContext":"AuthService.Services.AuthServiceImplementation","ActionId":"641d00cf-34c9-4c61-b632-2433f51a66f3","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPTT9921SJ:00000003","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPTT9921SJ"}
[2025-08-12 17:33:03.109 -05:00 INF] üîç TOKEN DEBUG: Starting token generation for user 6 in tenant 1 {"SourceContext":"AuthService.Services.TokenService","ActionId":"641d00cf-34c9-4c61-b632-2433f51a66f3","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPTT9921SJ:00000003","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPTT9921SJ"}
[2025-08-12 17:33:03.113 -05:00 INF] üîç TOKEN DEBUG: User.TenantUsers collection status: Count=1, IsNull=false {"SourceContext":"AuthService.Services.TokenService","ActionId":"641d00cf-34c9-4c61-b632-2433f51a66f3","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPTT9921SJ:00000003","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPTT9921SJ"}
[2025-08-12 17:33:03.116 -05:00 INF] üîç TOKEN DEBUG: TenantUser found: TenantId=1, Role=User, IsActive=true {"SourceContext":"AuthService.Services.TokenService","ActionId":"641d00cf-34c9-4c61-b632-2433f51a66f3","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPTT9921SJ:00000003","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPTT9921SJ"}
[2025-08-12 17:33:03.120 -05:00 INF] üîç TOKEN DEBUG: Added role claim 'User' for user 6 {"SourceContext":"AuthService.Services.TokenService","ActionId":"641d00cf-34c9-4c61-b632-2433f51a66f3","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPTT9921SJ:00000003","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPTT9921SJ"}
[2025-08-12 17:33:03.125 -05:00 INF] üîç TOKEN DEBUG: Total roles added to token: 1 {"SourceContext":"AuthService.Services.TokenService","ActionId":"641d00cf-34c9-4c61-b632-2433f51a66f3","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPTT9921SJ:00000003","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPTT9921SJ"}
[2025-08-12 17:33:03.127 -05:00 INF] üîç TOKEN DEBUG: Attempting to resolve IPermissionService for user 6 {"SourceContext":"AuthService.Services.TokenService","ActionId":"641d00cf-34c9-4c61-b632-2433f51a66f3","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPTT9921SJ:00000003","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPTT9921SJ"}
[2025-08-12 17:33:03.129 -05:00 INF] üîç TOKEN DEBUG: IPermissionService resolved successfully, getting permissions for user 6 in tenant 1 {"SourceContext":"AuthService.Services.TokenService","ActionId":"641d00cf-34c9-4c61-b632-2433f51a66f3","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPTT9921SJ:00000003","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPTT9921SJ"}
[2025-08-12 17:33:03.132 -05:00 INF] üîç PERMISSION DEBUG: Getting permissions for user 6 in tenant 1 {"SourceContext":"Common.Services.PermissionService","ActionId":"641d00cf-34c9-4c61-b632-2433f51a66f3","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPTT9921SJ:00000003","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPTT9921SJ"}
[2025-08-12 17:33:03.137 -05:00 ERR] Failed executing DbCommand (2ms) [Parameters=[@__userId_0='?' (DbType = Int32), @__tenantId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."CreatedAt", u."ExpiresAt", u."IsActive", u."RoleId", u."TenantId", u."UpdatedAt", u."UserId", u."UserId1"
FROM "UserRoles" AS u
WHERE u."UserId" = @__userId_0 AND u."TenantId" = @__tenantId_1 AND u."IsActive" {"EventId":{"Id":20102,"Name":"Microsoft.EntityFrameworkCore.Database.Command.CommandError"},"SourceContext":"Microsoft.EntityFrameworkCore.Database.Command","ActionId":"641d00cf-34c9-4c61-b632-2433f51a66f3","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPTT9921SJ:00000003","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPTT9921SJ"}
[2025-08-12 17:33:03.148 -05:00 ERR] An exception occurred while iterating over the results of a query for context type 'Common.Data.ApplicationDbContext'.
Npgsql.PostgresException (0x80004005): 42703: column u.UserId1 does not exist

POSITION: 145
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
  Exception data:
    Severity: ERROR
    SqlState: 42703
    MessageText: column u.UserId1 does not exist
    Hint: Perhaps you meant to reference the column "u.UserId".
    Position: 145
    File: parse_relation.c
    Line: 3665
    Routine: errorMissingColumn {"EventId":{"Id":10100,"Name":"Microsoft.EntityFrameworkCore.Query.QueryIterationFailed"},"SourceContext":"Microsoft.EntityFrameworkCore.Query","ActionId":"641d00cf-34c9-4c61-b632-2433f51a66f3","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPTT9921SJ:00000003","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPTT9921SJ"}
Npgsql.PostgresException (0x80004005): 42703: column u.UserId1 does not exist

POSITION: 145
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
  Exception data:
    Severity: ERROR
    SqlState: 42703
    MessageText: column u.UserId1 does not exist
    Hint: Perhaps you meant to reference the column "u.UserId".
    Position: 145
    File: parse_relation.c
    Line: 3665
    Routine: errorMissingColumn
[2025-08-12 17:33:03.158 -05:00 ERR] üîç PERMISSION DEBUG: Error getting permissions for user 6 in tenant 1 {"SourceContext":"Common.Services.PermissionService","ActionId":"641d00cf-34c9-4c61-b632-2433f51a66f3","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPTT9921SJ:00000003","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPTT9921SJ"}
Npgsql.PostgresException (0x80004005): 42703: column u.UserId1 does not exist

POSITION: 145
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Common.Services.PermissionService.GetUserPermissionsForTenantAsync(Int32 userId, Int32 tenantId, CancellationToken cancellationToken) in C:\Users\mccre\dev\boiler\src\shared\Common\Services\PermissionService.cs:line 100
  Exception data:
    Severity: ERROR
    SqlState: 42703
    MessageText: column u.UserId1 does not exist
    Hint: Perhaps you meant to reference the column "u.UserId".
    Position: 145
    File: parse_relation.c
    Line: 3665
    Routine: errorMissingColumn
[2025-08-12 17:33:03.164 -05:00 INF] üîç TOKEN DEBUG: Retrieved 0 permissions for user 6:  {"SourceContext":"AuthService.Services.TokenService","ActionId":"641d00cf-34c9-4c61-b632-2433f51a66f3","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPTT9921SJ:00000003","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPTT9921SJ"}
[2025-08-12 17:33:03.166 -05:00 INF] üîç TOKEN DEBUG: Successfully added 0 permission claims to JWT for user 6 {"SourceContext":"AuthService.Services.TokenService","ActionId":"641d00cf-34c9-4c61-b632-2433f51a66f3","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPTT9921SJ:00000003","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPTT9921SJ"}
[2025-08-12 17:33:03.168 -05:00 INF] üîç TOKEN DEBUG: Total claims count before token generation: 12 {"SourceContext":"AuthService.Services.TokenService","ActionId":"641d00cf-34c9-4c61-b632-2433f51a66f3","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPTT9921SJ:00000003","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPTT9921SJ"}
[2025-08-12 17:33:03.171 -05:00 INF] üîç TOKEN DEBUG: Token generation completed for user 6 {"SourceContext":"AuthService.Services.TokenService","ActionId":"641d00cf-34c9-4c61-b632-2433f51a66f3","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPTT9921SJ:00000003","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPTT9921SJ"}
[2025-08-12 17:33:03.189 -05:00 INF] User mccrearyforward@gmail.com logged in successfully {"SourceContext":"AuthService.Services.AuthServiceImplementation","ActionId":"641d00cf-34c9-4c61-b632-2433f51a66f3","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPTT9921SJ:00000003","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPTT9921SJ"}
[2025-08-12 17:33:03.192 -05:00 INF] HTTP POST /api/Auth/login responded 200 in 622.5617 ms {"SourceContext":"Serilog.AspNetCore.RequestLoggingMiddleware"}
[2025-08-12 17:35:33.492 -05:00 INF] Starting AuthService {}
[2025-08-12 17:35:33.573 -05:00 INF] Now listening on: https://localhost:7001 {}
[2025-08-12 17:35:33.578 -05:00 INF] Now listening on: http://localhost:5001 {}
[2025-08-12 17:36:10.990 -05:00 WRN] Sensitive data logging is enabled. Log entries and exception messages may include sensitive application data; this mode should only be enabled during development. {"EventId":{"Id":10400,"Name":"Microsoft.EntityFrameworkCore.Infrastructure.SensitiveDataLoggingEnabledWarning"},"SourceContext":"Microsoft.EntityFrameworkCore.Model.Validation","ActionId":"725a5f42-ef05-4876-aa1c-288a9ff4239f","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPU29CJ417:00000007","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPU29CJ417"}
[2025-08-12 17:36:11.016 -05:00 WRN] The foreign key property 'UserRole.UserId1' was created in shadow state because a conflicting property with the simple name 'UserId' exists in the entity type, but is either not mapped, is already used for another relationship, or is incompatible with the associated primary key type. See https://aka.ms/efcore-relationships for information on mapping relationships in EF Core. {"EventId":{"Id":10625,"Name":"Microsoft.EntityFrameworkCore.Model.Validation.ShadowForeignKeyPropertyCreated"},"SourceContext":"Microsoft.EntityFrameworkCore.Model.Validation","ActionId":"725a5f42-ef05-4876-aa1c-288a9ff4239f","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPU29CJ417:00000007","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPU29CJ417"}
[2025-08-12 17:36:11.107 -05:00 WRN] üîç LOGIN DEBUG: Starting login for admin@localhost {"SourceContext":"AuthService.Services.AuthServiceImplementation","ActionId":"725a5f42-ef05-4876-aa1c-288a9ff4239f","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPU29CJ417:00000007","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPU29CJ417"}
[2025-08-12 17:36:11.724 -05:00 WRN] üîç LOGIN DEBUG: User found: true, IsActive: true, TenantId: 1 {"SourceContext":"AuthService.Services.AuthServiceImplementation","ActionId":"725a5f42-ef05-4876-aa1c-288a9ff4239f","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPU29CJ417:00000007","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPU29CJ417"}
[2025-08-12 17:36:11.731 -05:00 WRN] üîç LOGIN DEBUG: Attempting password verification for admin@localhost {"SourceContext":"AuthService.Services.AuthServiceImplementation","ActionId":"725a5f42-ef05-4876-aa1c-288a9ff4239f","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPU29CJ417:00000007","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPU29CJ417"}
[2025-08-12 17:36:11.736 -05:00 WRN] üîç LOGIN DEBUG: Password length: 8, Hash starts with: $2a$12$29x {"SourceContext":"AuthService.Services.AuthServiceImplementation","ActionId":"725a5f42-ef05-4876-aa1c-288a9ff4239f","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPU29CJ417:00000007","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPU29CJ417"}
[2025-08-12 17:36:12.742 -05:00 WRN] üîç LOGIN DEBUG: Password verification result: true {"SourceContext":"AuthService.Services.AuthServiceImplementation","ActionId":"725a5f42-ef05-4876-aa1c-288a9ff4239f","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPU29CJ417:00000007","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPU29CJ417"}
[2025-08-12 17:36:12.745 -05:00 WRN] üîç LOGIN DEBUG: Checking tenant relationship. PrimaryTenant: true, TenantId: 1 {"SourceContext":"AuthService.Services.AuthServiceImplementation","ActionId":"725a5f42-ef05-4876-aa1c-288a9ff4239f","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPU29CJ417:00000007","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPU29CJ417"}
[2025-08-12 17:36:12.791 -05:00 ERR] Failed executing DbCommand (5ms) [Parameters=[@__user_Id_0='2', @__tenant_Id_1='1'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."CreatedAt", u."ExpiresAt", u."IsActive", u."RoleId", u."TenantId", u."UpdatedAt", u."UserId", u."UserId1", r."Id", r."CreatedAt", r."Description", r."IsActive", r."IsDefault", r."IsSystemRole", r."Name", r."TenantId", r."UpdatedAt"
FROM "UserRoles" AS u
INNER JOIN "Roles" AS r ON u."RoleId" = r."Id"
WHERE u."UserId" = @__user_Id_0 AND u."TenantId" = @__tenant_Id_1 AND u."IsActive" {"EventId":{"Id":20102,"Name":"Microsoft.EntityFrameworkCore.Database.Command.CommandError"},"SourceContext":"Microsoft.EntityFrameworkCore.Database.Command","ActionId":"725a5f42-ef05-4876-aa1c-288a9ff4239f","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPU29CJ417:00000007","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPU29CJ417"}
[2025-08-12 17:36:12.804 -05:00 ERR] An exception occurred while iterating over the results of a query for context type 'Common.Data.ApplicationDbContext'.
Npgsql.PostgresException (0x80004005): 42703: column u.UserId1 does not exist

POSITION: 145
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
  Exception data:
    Severity: ERROR
    SqlState: 42703
    MessageText: column u.UserId1 does not exist
    Hint: Perhaps you meant to reference the column "u.UserId".
    Position: 145
    File: parse_relation.c
    Line: 3665
    Routine: errorMissingColumn {"EventId":{"Id":10100,"Name":"Microsoft.EntityFrameworkCore.Query.QueryIterationFailed"},"SourceContext":"Microsoft.EntityFrameworkCore.Query","ActionId":"725a5f42-ef05-4876-aa1c-288a9ff4239f","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPU29CJ417:00000007","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPU29CJ417"}
Npgsql.PostgresException (0x80004005): 42703: column u.UserId1 does not exist

POSITION: 145
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
  Exception data:
    Severity: ERROR
    SqlState: 42703
    MessageText: column u.UserId1 does not exist
    Hint: Perhaps you meant to reference the column "u.UserId".
    Position: 145
    File: parse_relation.c
    Line: 3665
    Routine: errorMissingColumn
[2025-08-12 17:36:12.813 -05:00 ERR] üîç JWT: Failed to load roles for user 2, using TenantUsers fallback {"SourceContext":"AuthService.Services.EnhancedTokenService","ActionId":"725a5f42-ef05-4876-aa1c-288a9ff4239f","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPU29CJ417:00000007","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPU29CJ417"}
Npgsql.PostgresException (0x80004005): 42703: column u.UserId1 does not exist

POSITION: 145
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at AuthService.Services.EnhancedTokenService.GenerateAccessTokenAsync(User user, Tenant tenant) in C:\Users\mccre\dev\boiler\src\services\AuthService\Services\EnhancedTokenService.cs:line 55
  Exception data:
    Severity: ERROR
    SqlState: 42703
    MessageText: column u.UserId1 does not exist
    Hint: Perhaps you meant to reference the column "u.UserId".
    Position: 145
    File: parse_relation.c
    Line: 3665
    Routine: errorMissingColumn
[2025-08-12 17:36:12.840 -05:00 WRN] Could not resolve tenant from any source. Strategy: "Header", IsAuthenticated: false {"SourceContext":"Common.Services.TenantProvider","ActionId":"725a5f42-ef05-4876-aa1c-288a9ff4239f","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPU29CJ417:00000007","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPU29CJ417"}
[2025-08-12 17:36:12.844 -05:00 WRN] Failed to resolve tenant ID from any source {"SourceContext":"Common.Services.TenantProvider","ActionId":"725a5f42-ef05-4876-aa1c-288a9ff4239f","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPU29CJ417:00000007","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPU29CJ417"}
[2025-08-12 17:36:12.848 -05:00 WRN] No tenant context available for getting user permissions: 2 {"SourceContext":"Common.Services.PermissionService","ActionId":"725a5f42-ef05-4876-aa1c-288a9ff4239f","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPU29CJ417:00000007","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPU29CJ417"}
[2025-08-12 17:36:12.869 -05:00 INF] üîç JWT: Generated token for user 2 with 1 roles and 0 permissions {"SourceContext":"AuthService.Services.EnhancedTokenService","ActionId":"725a5f42-ef05-4876-aa1c-288a9ff4239f","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPU29CJ417:00000007","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPU29CJ417"}
[2025-08-12 17:36:13.044 -05:00 INF] User admin@localhost logged in successfully {"SourceContext":"AuthService.Services.AuthServiceImplementation","ActionId":"725a5f42-ef05-4876-aa1c-288a9ff4239f","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPU29CJ417:00000007","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPU29CJ417"}
[2025-08-12 17:36:13.070 -05:00 INF] HTTP POST /api/Auth/login responded 200 in 2649.8561 ms {"SourceContext":"Serilog.AspNetCore.RequestLoggingMiddleware"}
[2025-08-12 17:41:51.464 -05:00 INF] Starting AuthService {}
[2025-08-12 17:41:51.542 -05:00 INF] Now listening on: https://localhost:7001 {}
[2025-08-12 17:41:51.544 -05:00 INF] Now listening on: http://localhost:5001 {}
[2025-08-12 17:42:20.362 -05:00 WRN] Sensitive data logging is enabled. Log entries and exception messages may include sensitive application data; this mode should only be enabled during development. {"EventId":{"Id":10400,"Name":"Microsoft.EntityFrameworkCore.Infrastructure.SensitiveDataLoggingEnabledWarning"},"SourceContext":"Microsoft.EntityFrameworkCore.Model.Validation","ActionId":"49c75f12-24c8-43d9-9210-71281eb57615","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPU5OMTDGB:00000007","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPU5OMTDGB"}
[2025-08-12 17:42:20.387 -05:00 WRN] The foreign key property 'UserRole.UserId1' was created in shadow state because a conflicting property with the simple name 'UserId' exists in the entity type, but is either not mapped, is already used for another relationship, or is incompatible with the associated primary key type. See https://aka.ms/efcore-relationships for information on mapping relationships in EF Core. {"EventId":{"Id":10625,"Name":"Microsoft.EntityFrameworkCore.Model.Validation.ShadowForeignKeyPropertyCreated"},"SourceContext":"Microsoft.EntityFrameworkCore.Model.Validation","ActionId":"49c75f12-24c8-43d9-9210-71281eb57615","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPU5OMTDGB:00000007","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPU5OMTDGB"}
[2025-08-12 17:42:20.467 -05:00 WRN] üîç LOGIN DEBUG: Starting login for admin@localhost {"SourceContext":"AuthService.Services.AuthServiceImplementation","ActionId":"49c75f12-24c8-43d9-9210-71281eb57615","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPU5OMTDGB:00000007","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPU5OMTDGB"}
[2025-08-12 17:42:21.107 -05:00 WRN] üîç LOGIN DEBUG: User found: true, IsActive: true, TenantId: 1 {"SourceContext":"AuthService.Services.AuthServiceImplementation","ActionId":"49c75f12-24c8-43d9-9210-71281eb57615","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPU5OMTDGB:00000007","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPU5OMTDGB"}
[2025-08-12 17:42:21.112 -05:00 WRN] üîç LOGIN DEBUG: Attempting password verification for admin@localhost {"SourceContext":"AuthService.Services.AuthServiceImplementation","ActionId":"49c75f12-24c8-43d9-9210-71281eb57615","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPU5OMTDGB:00000007","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPU5OMTDGB"}
[2025-08-12 17:42:21.114 -05:00 WRN] üîç LOGIN DEBUG: Password length: 8, Hash starts with: $2a$12$29x {"SourceContext":"AuthService.Services.AuthServiceImplementation","ActionId":"49c75f12-24c8-43d9-9210-71281eb57615","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPU5OMTDGB:00000007","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPU5OMTDGB"}
[2025-08-12 17:42:22.121 -05:00 WRN] üîç LOGIN DEBUG: Password verification result: true {"SourceContext":"AuthService.Services.AuthServiceImplementation","ActionId":"49c75f12-24c8-43d9-9210-71281eb57615","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPU5OMTDGB:00000007","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPU5OMTDGB"}
[2025-08-12 17:42:22.124 -05:00 WRN] üîç LOGIN DEBUG: Checking tenant relationship. PrimaryTenant: true, TenantId: 1 {"SourceContext":"AuthService.Services.AuthServiceImplementation","ActionId":"49c75f12-24c8-43d9-9210-71281eb57615","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPU5OMTDGB:00000007","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPU5OMTDGB"}
[2025-08-12 17:42:22.169 -05:00 ERR] Failed executing DbCommand (4ms) [Parameters=[@__user_Id_0='2', @__tenant_Id_1='1'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."CreatedAt", u."ExpiresAt", u."IsActive", u."RoleId", u."TenantId", u."UpdatedAt", u."UserId", u."UserId1", r."Id", r."CreatedAt", r."Description", r."IsActive", r."IsDefault", r."IsSystemRole", r."Name", r."TenantId", r."UpdatedAt"
FROM "UserRoles" AS u
INNER JOIN "Roles" AS r ON u."RoleId" = r."Id"
WHERE u."UserId" = @__user_Id_0 AND u."TenantId" = @__tenant_Id_1 AND u."IsActive" {"EventId":{"Id":20102,"Name":"Microsoft.EntityFrameworkCore.Database.Command.CommandError"},"SourceContext":"Microsoft.EntityFrameworkCore.Database.Command","ActionId":"49c75f12-24c8-43d9-9210-71281eb57615","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPU5OMTDGB:00000007","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPU5OMTDGB"}
[2025-08-12 17:42:22.184 -05:00 ERR] An exception occurred while iterating over the results of a query for context type 'Common.Data.ApplicationDbContext'.
Npgsql.PostgresException (0x80004005): 42703: column u.UserId1 does not exist

POSITION: 145
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
  Exception data:
    Severity: ERROR
    SqlState: 42703
    MessageText: column u.UserId1 does not exist
    Hint: Perhaps you meant to reference the column "u.UserId".
    Position: 145
    File: parse_relation.c
    Line: 3665
    Routine: errorMissingColumn {"EventId":{"Id":10100,"Name":"Microsoft.EntityFrameworkCore.Query.QueryIterationFailed"},"SourceContext":"Microsoft.EntityFrameworkCore.Query","ActionId":"49c75f12-24c8-43d9-9210-71281eb57615","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPU5OMTDGB:00000007","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPU5OMTDGB"}
Npgsql.PostgresException (0x80004005): 42703: column u.UserId1 does not exist

POSITION: 145
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
  Exception data:
    Severity: ERROR
    SqlState: 42703
    MessageText: column u.UserId1 does not exist
    Hint: Perhaps you meant to reference the column "u.UserId".
    Position: 145
    File: parse_relation.c
    Line: 3665
    Routine: errorMissingColumn
[2025-08-12 17:42:22.192 -05:00 ERR] üîç JWT: Failed to load roles for user 2, using TenantUsers fallback {"SourceContext":"AuthService.Services.EnhancedTokenService","ActionId":"49c75f12-24c8-43d9-9210-71281eb57615","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPU5OMTDGB:00000007","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPU5OMTDGB"}
Npgsql.PostgresException (0x80004005): 42703: column u.UserId1 does not exist

POSITION: 145
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at AuthService.Services.EnhancedTokenService.GenerateAccessTokenAsync(User user, Tenant tenant) in C:\Users\mccre\dev\boiler\src\services\AuthService\Services\EnhancedTokenService.cs:line 55
  Exception data:
    Severity: ERROR
    SqlState: 42703
    MessageText: column u.UserId1 does not exist
    Hint: Perhaps you meant to reference the column "u.UserId".
    Position: 145
    File: parse_relation.c
    Line: 3665
    Routine: errorMissingColumn
[2025-08-12 17:42:22.206 -05:00 WRN] Could not resolve tenant from any source. Strategy: "Header", IsAuthenticated: false {"SourceContext":"Common.Services.TenantProvider","ActionId":"49c75f12-24c8-43d9-9210-71281eb57615","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPU5OMTDGB:00000007","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPU5OMTDGB"}
[2025-08-12 17:42:22.209 -05:00 WRN] Failed to resolve tenant ID from any source {"SourceContext":"Common.Services.TenantProvider","ActionId":"49c75f12-24c8-43d9-9210-71281eb57615","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPU5OMTDGB:00000007","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPU5OMTDGB"}
[2025-08-12 17:42:22.212 -05:00 WRN] No tenant context available for getting user permissions: 2 {"SourceContext":"Common.Services.PermissionService","ActionId":"49c75f12-24c8-43d9-9210-71281eb57615","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPU5OMTDGB:00000007","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPU5OMTDGB"}
[2025-08-12 17:42:22.229 -05:00 INF] üîç JWT: Generated token for user 2 with 1 roles and 0 permissions {"SourceContext":"AuthService.Services.EnhancedTokenService","ActionId":"49c75f12-24c8-43d9-9210-71281eb57615","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPU5OMTDGB:00000007","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPU5OMTDGB"}
[2025-08-12 17:42:22.393 -05:00 INF] User admin@localhost logged in successfully {"SourceContext":"AuthService.Services.AuthServiceImplementation","ActionId":"49c75f12-24c8-43d9-9210-71281eb57615","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPU5OMTDGB:00000007","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPU5OMTDGB"}
[2025-08-12 17:42:22.412 -05:00 INF] HTTP POST /api/Auth/login responded 200 in 2598.8362 ms {"SourceContext":"Serilog.AspNetCore.RequestLoggingMiddleware"}
[2025-08-12 18:37:09.748 -05:00 INF] Starting AuthService {}
[2025-08-12 18:37:09.828 -05:00 INF] Now listening on: https://localhost:7001 {}
[2025-08-12 18:37:09.831 -05:00 INF] Now listening on: http://localhost:5001 {}
[2025-08-12 18:37:53.120 -05:00 INF] HTTP GET / responded 404 in 21.8691 ms {"SourceContext":"Serilog.AspNetCore.RequestLoggingMiddleware"}
[2025-08-12 18:38:54.979 -05:00 WRN] The foreign key property 'UserRole.UserId1' was created in shadow state because a conflicting property with the simple name 'UserId' exists in the entity type, but is either not mapped, is already used for another relationship, or is incompatible with the associated primary key type. See https://aka.ms/efcore-relationships for information on mapping relationships in EF Core. {"EventId":{"Id":10625,"Name":"Microsoft.EntityFrameworkCore.Model.Validation.ShadowForeignKeyPropertyCreated"},"SourceContext":"Microsoft.EntityFrameworkCore.Model.Validation","ActionId":"eb7db6e9-8bd1-4d1f-94ee-095e06cfedfb","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPV50SJPLD:00000011","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPV50SJPLD"}
[2025-08-12 18:38:55.059 -05:00 WRN] üîç LOGIN DEBUG: Starting login for admin@localhost {"SourceContext":"AuthService.Services.AuthServiceImplementation","ActionId":"eb7db6e9-8bd1-4d1f-94ee-095e06cfedfb","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPV50SJPLD:00000011","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPV50SJPLD"}
[2025-08-12 18:38:55.627 -05:00 WRN] üîç LOGIN DEBUG: User found: true, IsActive: true, TenantId: 1 {"SourceContext":"AuthService.Services.AuthServiceImplementation","ActionId":"eb7db6e9-8bd1-4d1f-94ee-095e06cfedfb","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPV50SJPLD:00000011","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPV50SJPLD"}
[2025-08-12 18:38:55.632 -05:00 WRN] üîç LOGIN DEBUG: Attempting password verification for admin@localhost {"SourceContext":"AuthService.Services.AuthServiceImplementation","ActionId":"eb7db6e9-8bd1-4d1f-94ee-095e06cfedfb","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPV50SJPLD:00000011","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPV50SJPLD"}
[2025-08-12 18:38:55.635 -05:00 WRN] üîç LOGIN DEBUG: Password length: 8, Hash starts with: $2a$12$29x {"SourceContext":"AuthService.Services.AuthServiceImplementation","ActionId":"eb7db6e9-8bd1-4d1f-94ee-095e06cfedfb","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPV50SJPLD:00000011","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPV50SJPLD"}
[2025-08-12 18:38:56.679 -05:00 WRN] üîç LOGIN DEBUG: Password verification result: true {"SourceContext":"AuthService.Services.AuthServiceImplementation","ActionId":"eb7db6e9-8bd1-4d1f-94ee-095e06cfedfb","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPV50SJPLD:00000011","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPV50SJPLD"}
[2025-08-12 18:38:56.682 -05:00 WRN] üîç LOGIN DEBUG: Checking tenant relationship. PrimaryTenant: true, TenantId: 1 {"SourceContext":"AuthService.Services.AuthServiceImplementation","ActionId":"eb7db6e9-8bd1-4d1f-94ee-095e06cfedfb","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPV50SJPLD:00000011","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPV50SJPLD"}
[2025-08-12 18:38:56.688 -05:00 INF] üîç TOKEN DEBUG: Starting token generation for user 2 in tenant 1 {"SourceContext":"AuthService.Services.TokenService","ActionId":"eb7db6e9-8bd1-4d1f-94ee-095e06cfedfb","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPV50SJPLD:00000011","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPV50SJPLD"}
[2025-08-12 18:38:56.692 -05:00 INF] üîç TOKEN DEBUG: User.TenantUsers collection status: Count=1, IsNull=false {"SourceContext":"AuthService.Services.TokenService","ActionId":"eb7db6e9-8bd1-4d1f-94ee-095e06cfedfb","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPV50SJPLD:00000011","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPV50SJPLD"}
[2025-08-12 18:38:56.695 -05:00 INF] üîç TOKEN DEBUG: TenantUser found: TenantId=1, Role=SuperAdmin, IsActive=true {"SourceContext":"AuthService.Services.TokenService","ActionId":"eb7db6e9-8bd1-4d1f-94ee-095e06cfedfb","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPV50SJPLD:00000011","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPV50SJPLD"}
[2025-08-12 18:38:56.697 -05:00 INF] üîç TOKEN DEBUG: Added role claim 'SuperAdmin' for user 2 {"SourceContext":"AuthService.Services.TokenService","ActionId":"eb7db6e9-8bd1-4d1f-94ee-095e06cfedfb","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPV50SJPLD:00000011","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPV50SJPLD"}
[2025-08-12 18:38:56.700 -05:00 INF] üîç TOKEN DEBUG: Total roles added to token: 1 {"SourceContext":"AuthService.Services.TokenService","ActionId":"eb7db6e9-8bd1-4d1f-94ee-095e06cfedfb","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPV50SJPLD:00000011","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPV50SJPLD"}
[2025-08-12 18:38:56.702 -05:00 INF] üîç TOKEN DEBUG: Attempting to resolve IPermissionService for user 2 {"SourceContext":"AuthService.Services.TokenService","ActionId":"eb7db6e9-8bd1-4d1f-94ee-095e06cfedfb","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPV50SJPLD:00000011","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPV50SJPLD"}
[2025-08-12 18:38:56.706 -05:00 INF] üîç TOKEN DEBUG: IPermissionService resolved successfully, getting permissions for user 2 in tenant 1 {"SourceContext":"AuthService.Services.TokenService","ActionId":"eb7db6e9-8bd1-4d1f-94ee-095e06cfedfb","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPV50SJPLD:00000011","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPV50SJPLD"}
[2025-08-12 18:38:56.711 -05:00 INF] üîç PERMISSION DEBUG: Getting permissions for user 2 in tenant 1 {"SourceContext":"Common.Services.PermissionService","ActionId":"eb7db6e9-8bd1-4d1f-94ee-095e06cfedfb","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPV50SJPLD:00000011","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPV50SJPLD"}
[2025-08-12 18:38:56.792 -05:00 ERR] Failed executing DbCommand (7ms) [Parameters=[@__userId_0='?' (DbType = Int32), @__tenantId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."CreatedAt", u."ExpiresAt", u."IsActive", u."RoleId", u."TenantId", u."UpdatedAt", u."UserId", u."UserId1"
FROM "UserRoles" AS u
WHERE u."UserId" = @__userId_0 AND u."TenantId" = @__tenantId_1 AND u."IsActive" {"EventId":{"Id":20102,"Name":"Microsoft.EntityFrameworkCore.Database.Command.CommandError"},"SourceContext":"Microsoft.EntityFrameworkCore.Database.Command","ActionId":"eb7db6e9-8bd1-4d1f-94ee-095e06cfedfb","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPV50SJPLD:00000011","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPV50SJPLD"}
[2025-08-12 18:38:56.808 -05:00 ERR] An exception occurred while iterating over the results of a query for context type 'Common.Data.ApplicationDbContext'.
Npgsql.PostgresException (0x80004005): 42703: column u.UserId1 does not exist

POSITION: 145
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
  Exception data:
    Severity: ERROR
    SqlState: 42703
    MessageText: column u.UserId1 does not exist
    Hint: Perhaps you meant to reference the column "u.UserId".
    Position: 145
    File: parse_relation.c
    Line: 3665
    Routine: errorMissingColumn {"EventId":{"Id":10100,"Name":"Microsoft.EntityFrameworkCore.Query.QueryIterationFailed"},"SourceContext":"Microsoft.EntityFrameworkCore.Query","ActionId":"eb7db6e9-8bd1-4d1f-94ee-095e06cfedfb","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPV50SJPLD:00000011","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPV50SJPLD"}
Npgsql.PostgresException (0x80004005): 42703: column u.UserId1 does not exist

POSITION: 145
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
  Exception data:
    Severity: ERROR
    SqlState: 42703
    MessageText: column u.UserId1 does not exist
    Hint: Perhaps you meant to reference the column "u.UserId".
    Position: 145
    File: parse_relation.c
    Line: 3665
    Routine: errorMissingColumn
[2025-08-12 18:38:56.817 -05:00 ERR] üîç PERMISSION DEBUG: Error getting permissions for user 2 in tenant 1 {"SourceContext":"Common.Services.PermissionService","ActionId":"eb7db6e9-8bd1-4d1f-94ee-095e06cfedfb","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPV50SJPLD:00000011","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPV50SJPLD"}
Npgsql.PostgresException (0x80004005): 42703: column u.UserId1 does not exist

POSITION: 145
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Common.Services.PermissionService.GetUserPermissionsForTenantAsync(Int32 userId, Int32 tenantId, CancellationToken cancellationToken) in C:\Users\mccre\dev\boiler\src\shared\Common\Services\PermissionService.cs:line 100
  Exception data:
    Severity: ERROR
    SqlState: 42703
    MessageText: column u.UserId1 does not exist
    Hint: Perhaps you meant to reference the column "u.UserId".
    Position: 145
    File: parse_relation.c
    Line: 3665
    Routine: errorMissingColumn
[2025-08-12 18:38:56.838 -05:00 INF] üîç TOKEN DEBUG: Retrieved 0 permissions for user 2:  {"SourceContext":"AuthService.Services.TokenService","ActionId":"eb7db6e9-8bd1-4d1f-94ee-095e06cfedfb","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPV50SJPLD:00000011","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPV50SJPLD"}
[2025-08-12 18:38:56.841 -05:00 INF] üîç TOKEN DEBUG: Successfully added 0 permission claims to JWT for user 2 {"SourceContext":"AuthService.Services.TokenService","ActionId":"eb7db6e9-8bd1-4d1f-94ee-095e06cfedfb","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPV50SJPLD:00000011","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPV50SJPLD"}
[2025-08-12 18:38:56.847 -05:00 INF] üîç TOKEN DEBUG: Total claims count before token generation: 12 {"SourceContext":"AuthService.Services.TokenService","ActionId":"eb7db6e9-8bd1-4d1f-94ee-095e06cfedfb","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPV50SJPLD:00000011","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPV50SJPLD"}
[2025-08-12 18:38:56.871 -05:00 INF] üîç TOKEN DEBUG: Token generation completed for user 2 {"SourceContext":"AuthService.Services.TokenService","ActionId":"eb7db6e9-8bd1-4d1f-94ee-095e06cfedfb","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPV50SJPLD:00000011","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPV50SJPLD"}
[2025-08-12 18:38:57.035 -05:00 INF] User admin@localhost logged in successfully {"SourceContext":"AuthService.Services.AuthServiceImplementation","ActionId":"eb7db6e9-8bd1-4d1f-94ee-095e06cfedfb","ActionName":"AuthService.Controllers.AuthController.Login (AuthService)","RequestId":"0HNEPV50SJPLD:00000011","RequestPath":"/api/Auth/login","ConnectionId":"0HNEPV50SJPLD"}
[2025-08-12 18:38:57.058 -05:00 INF] HTTP POST /api/Auth/login responded 200 in 3191.8062 ms {"SourceContext":"Serilog.AspNetCore.RequestLoggingMiddleware"}
