Building Test Projects
Starting test discovery for requested test run
========== Starting test discovery ==========
[xUnit.net 00:00:00.00] xUnit.net VSTest Adapter v2.5.3.1+6b60a9e56a (64-bit .NET 9.0.7)
[xUnit.net 00:00:00.07]   Discovering: UserService.PerformanceTests
[xUnit.net 00:00:00.09]   Discovered:  UserService.PerformanceTests
========== Test discovery finished: 6 Tests found in 492 ms ==========
========== Starting test run ==========
[xUnit.net 00:00:00.00] xUnit.net VSTest Adapter v2.5.3.1+6b60a9e56a (64-bit .NET 9.0.7)
[xUnit.net 00:00:00.05]   Starting:    UserService.IntegrationTests
=== UserService Startup Diagnostics ===
=== UserService Startup Diagnostics ===
Environment: Testing
=== UserService Startup Diagnostics ===
Application Name: UserService
Environment: Testing
Content Root: C:\Users\mccre\dev\boiler\src\services\UserService
Running in Container: 
=== UserService Startup Diagnostics ===
Application Name: UserService
Content Root: C:\Users\mccre\dev\boiler\src\services\UserService
Environment: Testing
Running in Container: 
Application Name: UserService
Content Root: C:\Users\mccre\dev\boiler\src\services\UserService
Running in Container: 
=== UserService Startup Diagnostics ===
Environment: Testing
Application Name: UserService
Content Root: C:\Users\mccre\dev\boiler\src\services\UserService
Environment: Testing
Running in Container: 
Application Name: UserService
Content Root: C:\Users\mccre\dev\boiler\src\services\UserService
Running in Container: 
[Startup] Monitoring:Enabled raw config value = 'False'
[Startup] Monitoring:Enabled raw config value = 'False'
[Startup] Monitoring:Enabled raw config value = 'False'
[Startup] Monitoring:Enabled raw config value = 'False'
[Startup] Monitoring:Enabled raw config value = 'False'
?? Registering base services...
?? Registering base services...
?? Registering base services...
?? Registering base services...
?? Registering base services...
? Base services registered
?? Configuring Swagger...
? Base services registered
?? Configuring Swagger...
? Base services registered
?? Configuring Swagger...
? Base services registered
?? Configuring Swagger...
? Base services registered
?? Configuring Swagger...
? Swagger configured
?? Registering common services...
? Swagger configured
?? Registering common services...
? Swagger configured
?? Registering common services...
? Swagger configured
?? Registering common services...
? Swagger configured
?? Registering common services...
? Common services registered
?? Configuring Redis...
? Common services registered
? Common services registered
?? Configuring Redis...
? Common services registered
?? Configuring Redis...
?? Redis connection string resolved to: localhost:6379
?? Redis connection string resolved to: localhost:6379
?? Running in container: 
?? Running in container: 
?? Redis connection string resolved to: localhost:6379
?? Running in container: 
? Common services registered
?? Configuring Redis...
?? Redis connection string resolved to: localhost:6379
?? Configuring Redis...
?? Running in container: 
?? Redis connection string resolved to: localhost:6379
?? Running in container: 
? Redis configured
?? Registering database services...
? Redis configured
?? Registering database services...
? Redis configured
?? Registering database services...
? Redis configured
?? Registering database services...
? Redis configured
?? Registering database services...
? Database services registered
?? Registering user services...
? Database services registered
?? Registering user services...
? Database services registered
?? Registering user services...
? Database services registered
?? Registering user services...
? Database services registered
?? Registering user services...
? User services registered
?? Registering Enhanced Security and Monitoring services...
? User services registered
?? Registering Enhanced Security and Monitoring services...
? User services registered
?? Registering Enhanced Security and Monitoring services...
? User services registered
?? Registering Enhanced Security and Monitoring services...
? User services registered
?? Registering Enhanced Security and Monitoring services...
? Enhanced Security and Monitoring services registered successfully
?? Registering Compliance and Alert services...
? Enhanced Security and Monitoring services registered successfully
?? Registering Compliance and Alert services...
? Enhanced Security and Monitoring services registered successfully
?? Registering Compliance and Alert services...
? Enhanced Security and Monitoring services registered successfully
? Enhanced Security and Monitoring services registered successfully
?? Registering Compliance and Alert services...
?? Registering Compliance and Alert services...
? Compliance and Alert services registered successfully
?? Registering Enhanced Health Checks...
? Compliance and Alert services registered successfully
?? Registering Enhanced Health Checks...
? Compliance and Alert services registered successfully
?? Registering Enhanced Health Checks...
? Compliance and Alert services registered successfully
?? Registering Enhanced Health Checks...
? Compliance and Alert services registered successfully
?? Registering Enhanced Health Checks...
? Enhanced Health Checks registered
?? Configuring authorization policies...
? Enhanced Health Checks registered
?? Configuring authorization policies...
? Enhanced Health Checks registered
?? Configuring authorization policies...
? Authorization policies configured
?? Configuring CORS...
? Authorization policies configured
?? Configuring CORS...
? Authorization policies configured
?? Configuring CORS...
? Enhanced Health Checks registered
?? Configuring authorization policies...
? Enhanced Health Checks registered
?? Configuring authorization policies...
? CORS configured
?? Registering additional services...
? CORS configured
?? Registering additional services...
? CORS configured
?? Registering additional services...
? Additional services registered
??? Building application...
? Authorization policies configured
?? Configuring CORS...
? Additional services registered
??? Building application...
? Additional services registered
??? Building application...
? CORS configured
?? Registering additional services...
? Authorization policies configured
?? Configuring CORS...
? Additional services registered
??? Building application...
? CORS configured
?? Registering additional services...
? Additional services registered
??? Building application...
? Application built successfully
?? Configuring middleware pipeline...
? Application built successfully
?? Configuring middleware pipeline...
? Application built successfully
?? Configuring middleware pipeline...
? Application built successfully
?? Configuring middleware pipeline...
? Application built successfully
?? Configuring middleware pipeline...
?? Configuring Enhanced Security middleware...
?? Configuring Enhanced Security middleware...
?? Configuring Enhanced Security middleware...
?? Configuring Enhanced Security middleware...
?? Configuring Enhanced Security middleware...
[13:48:43 INF] Configuring Enhanced Security middleware {}
[13:48:43 INF] Configuring Enhanced Security middleware {}
[13:48:43 INF] Configuring Enhanced Security middleware {}
[13:48:43 INF] Configuring Enhanced Security middleware {}
[13:48:43 INF] Configuring Enhanced Security middleware {}
[13:48:43 INF] ?? Enhanced security middleware DISABLED in testing environment {"SourceContext": "SecurityExtensions"}
[13:48:43 INF] ?? Enhanced security middleware DISABLED in testing environment {"SourceContext": "SecurityExtensions"}
[13:48:43 INF] ?? Enhanced security middleware DISABLED in testing environment {"SourceContext": "SecurityExtensions"}
[13:48:43 INF] ?? Enhanced security middleware DISABLED in testing environment {"SourceContext": "SecurityExtensions"}
[13:48:43 INF] ?? Enhanced security middleware DISABLED in testing environment {"SourceContext": "SecurityExtensions"}
? Enhanced Security middleware configured successfully
[13:48:43 INF] Enhanced Security middleware configured successfully {}
? Enhanced Security middleware configured successfully
[13:48:43 INF] Enhanced Security middleware configured successfully {}
? Enhanced Security middleware configured successfully
[13:48:43 INF] Enhanced Security middleware configured successfully {}
? Enhanced Security middleware configured successfully
[13:48:43 INF] Enhanced Security middleware configured successfully {}
? Enhanced Security middleware configured successfully
[13:48:43 INF] Enhanced Security middleware configured successfully {}
? Middleware pipeline configured
? Middleware pipeline configured
?? Mapping Enhanced Health Check endpoints...
? Middleware pipeline configured
?? Mapping Enhanced Health Check endpoints...
?? Mapping Enhanced Health Check endpoints...
? Middleware pipeline configured
?? Mapping Enhanced Health Check endpoints...
? Middleware pipeline configured
?? Mapping Enhanced Health Check endpoints...
? Enhanced Health Check endpoints mapped
? Enhanced Health Check endpoints mapped
? Enhanced Health Check endpoints mapped
? Enhanced Health Check endpoints mapped
? Enhanced Health Check endpoints mapped
[13:48:43 INF] Starting UserService with Phase 11 Enhanced Security & Monitoring {}
[13:48:43 INF] Starting UserService with Phase 11 Enhanced Security & Monitoring {}
[13:48:43 INF] Starting UserService with Phase 11 Enhanced Security & Monitoring {}
[13:48:43 INF] Starting UserService with Phase 11 Enhanced Security & Monitoring {}
[13:48:43 INF] Starting UserService with Phase 11 Enhanced Security & Monitoring {}
=== UserService Starting with Phase 11 Enhanced Security & Monitoring ===
?? Testing Redis connection...
=== UserService Starting with Phase 11 Enhanced Security & Monitoring ===
?? Testing Redis connection...
=== UserService Starting with Phase 11 Enhanced Security & Monitoring ===
?? Testing Redis connection...
=== UserService Starting with Phase 11 Enhanced Security & Monitoring ===
?? Testing Redis connection...
=== UserService Starting with Phase 11 Enhanced Security & Monitoring ===
?? Testing Redis connection...
[13:48:43 INF] Redis connection status: Connected {}
[13:48:43 INF] Redis connection status: Connected {}
[13:48:43 INF] Redis connection status: Connected {}
[13:48:43 INF] Redis connection status: Connected {}
[13:48:43 INF] Redis connection status: Connected {}
? Redis connection successful: 8/23/2025 6:48:43 PM
? Redis connection successful: 8/23/2025 6:48:43 PM
? Redis connection successful: 8/23/2025 6:48:43 PM
? Redis connection successful: 8/23/2025 6:48:43 PM
? Redis connection successful: 8/23/2025 6:48:43 PM
[13:48:43 INF] Redis connection test successful: 8/23/2025 6:48:43 PM {}
[13:48:43 INF] Redis connection test successful: 8/23/2025 6:48:43 PM {}
[13:48:43 INF] Redis connection test successful: 8/23/2025 6:48:43 PM {}
?? Seeding database...
[13:48:43 INF] Redis connection test successful: 8/23/2025 6:48:43 PM {}
?? Seeding database...
?? Seeding database...
[13:48:43 INF] Redis connection test successful: 8/23/2025 6:48:43 PM {}
?? Seeding database...
?? Seeding database...
[13:48:43 WRN] Sensitive data logging is enabled. Log entries and exception messages may include sensitive application data; this mode should only be enabled during development. {"EventId": {"Id": 10400, "Name": "Microsoft.EntityFrameworkCore.Infrastructure.SensitiveDataLoggingEnabledWarning"}, "SourceContext": "Microsoft.EntityFrameworkCore.Model.Validation"}
? Database seeded
?? Seeding monitoring user...
? Database seeded
?? Seeding monitoring user...
? Database seeded
?? Seeding monitoring user...
? Database seeded
?? Seeding monitoring user...
? Database seeded
?? Seeding monitoring user...
[13:48:43 INF] Monitoring.Enabled = 'false' (evaluated false); skipping seeding. {"SourceContext": "MonitoringUserSeeder"}
[13:48:43 INF] Monitoring.Enabled = 'false' (evaluated false); skipping seeding. {"SourceContext": "MonitoringUserSeeder"}
[13:48:43 INF] Monitoring.Enabled = 'false' (evaluated false); skipping seeding. {"SourceContext": "MonitoringUserSeeder"}
? Monitoring user seeded (monitor@local / ChangeMe123!)
?? Starting application...
[13:48:43 INF] Monitoring.Enabled = 'false' (evaluated false); skipping seeding. {"SourceContext": "MonitoringUserSeeder"}
? Monitoring user seeded (monitor@local / ChangeMe123!)
?? Starting application...
? Monitoring user seeded (monitor@local / ChangeMe123!)
?? Starting application...
? Monitoring user seeded (monitor@local / ChangeMe123!)
?? Starting application...
[13:48:43 INF] Monitoring.Enabled = 'false' (evaluated false); skipping seeding. {"SourceContext": "MonitoringUserSeeder"}
? Monitoring user seeded (monitor@local / ChangeMe123!)
?? Starting application...
?? Enhanced Health Check endpoints available:
  - GET /health (comprehensive overview)
  - GET /health/critical (database + Redis status)
  - GET /health/enhanced (Phase 11 enhanced monitoring)
  - GET /health/performance (cache and performance metrics)
  - GET /health/system (overall system health score)
  - GET /health/ready (Kubernetes readiness)
  - GET /health/live (Kubernetes liveness)
?? Enhanced Security & Monitoring features:
  - Rate limiting with tenant awareness
  - Security event detection and logging
  - Performance metrics collection with Redis storage
  - Enhanced audit trail for all actions
  - Comprehensive health monitoring with performance scoring
  - Real-time system metrics and alerts
?? Enhanced Health Check endpoints available:
  - GET /health (comprehensive overview)
  - GET /health/critical (database + Redis status)
  - GET /health/enhanced (Phase 11 enhanced monitoring)
  - GET /health/performance (cache and performance metrics)
  - GET /health/system (overall system health score)
  - GET /health/ready (Kubernetes readiness)
  - GET /health/live (Kubernetes liveness)
?? Enhanced Security & Monitoring features:
  - Rate limiting with tenant awareness
  - Security event detection and logging
  - Performance metrics collection with Redis storage
  - Enhanced audit trail for all actions
  - Comprehensive health monitoring with performance scoring
  - Real-time system metrics and alerts
?? Enhanced Health Check endpoints available:
  - GET /health (comprehensive overview)
  - GET /health/critical (database + Redis status)
  - GET /health/enhanced (Phase 11 enhanced monitoring)
  - GET /health/performance (cache and performance metrics)
  - GET /health/system (overall system health score)
  - GET /health/ready (Kubernetes readiness)
  - GET /health/live (Kubernetes liveness)
?? Enhanced Security & Monitoring features:
  - Rate limiting with tenant awareness
  - Security event detection and logging
  - Performance metrics collection with Redis storage
  - Enhanced audit trail for all actions
  - Comprehensive health monitoring with performance scoring
  - Real-time system metrics and alerts
?? Enhanced Health Check endpoints available:
  - GET /health (comprehensive overview)
  - GET /health/critical (database + Redis status)
  - GET /health/enhanced (Phase 11 enhanced monitoring)
  - GET /health/performance (cache and performance metrics)
  - GET /health/system (overall system health score)
  - GET /health/ready (Kubernetes readiness)
  - GET /health/live (Kubernetes liveness)
?? Enhanced Security & Monitoring features:
  - Rate limiting with tenant awareness
  - Security event detection and logging
  - Performance metrics collection with Redis storage
  - Enhanced audit trail for all actions
  - Comprehensive health monitoring with performance scoring
  - Real-time system metrics and alerts
[13:48:44 INF] Enhanced Security & Monitoring (Phase 11) configured and operational {}
?? Enhanced Health Check endpoints available:
  - GET /health (comprehensive overview)
  - GET /health/critical (database + Redis status)
  - GET /health/enhanced (Phase 11 enhanced monitoring)
  - GET /health/performance (cache and performance metrics)
  - GET /health/system (overall system health score)
  - GET /health/ready (Kubernetes readiness)
  - GET /health/live (Kubernetes liveness)
?? Enhanced Security & Monitoring features:
  - Rate limiting with tenant awareness
  - Security event detection and logging
  - Performance metrics collection with Redis storage
  - Enhanced audit trail for all actions
  - Comprehensive health monitoring with performance scoring
  - Real-time system metrics and alerts
[13:48:44 INF] Enhanced Security & Monitoring (Phase 11) configured and operational {}
[13:48:44 INF] Enhanced Security & Monitoring (Phase 11) configured and operational {}
[13:48:44 INF] Enhanced Security & Monitoring (Phase 11) configured and operational {}
[13:48:44 INF] Enhanced Security & Monitoring (Phase 11) configured and operational {}
?? Ensuring clean database state...
?? Ensuring clean database state...
?? Ensuring clean database state...
?? Ensuring clean database state...
?? Ensuring clean database state...
? Database recreated with clean state
? Database recreated with clean state
?? TestDataSeeder: Starting test data seeding
?? TestDataSeeder: Starting test data seeding
? Database recreated with clean state
?? TestDataSeeder: Starting test data seeding
? Database recreated with clean state
?? TestDataSeeder: Starting test data seeding
? Database recreated with clean state
?? TestDataSeeder: Starting test data seeding
?? Creating tenants...
?? Creating tenants...
?? Creating tenants...
?? Creating tenants...
?? Creating tenants...
? Created 2 tenants
? Created 2 tenants
? Created 2 tenants
? Created 2 tenants
? Created 2 tenants
?? Creating permissions...
?? Creating permissions...
?? Creating permissions...
?? Creating permissions...
?? Creating permissions...
?? Creating 38 permissions from actual business requirements
?? Creating 38 permissions from actual business requirements
   - billing.manage (Billing)
?? Creating 38 permissions from actual business requirements
   - billing.manage (Billing)
   - billing.process_payments (Billing)
   - billing.process_payments (Billing)
   - billing.manage (Billing)
   - billing.view (Billing)
   - billing.view (Billing)
   - billing.view_invoices (Billing)
   - billing.view_invoices (Billing)
   - permissions.create (Permissions)
   - billing.process_payments (Billing)
   - permissions.delete (Permissions)
   - permissions.edit (Permissions)
?? Creating 38 permissions from actual business requirements
   - permissions.manage (Permissions)
   - permissions.view (Permissions)
   - billing.manage (Billing)
   - billing.process_payments (Billing)
   - reports.create (Reports)
   - reports.export (Reports)
   - reports.schedule (Reports)
   - reports.view (Reports)
   - billing.view (Billing)
   - roles.assign_users (Roles)
   - roles.create (Roles)
   - roles.delete (Roles)
   - roles.edit (Roles)
   - roles.manage_permissions (Roles)
   - roles.view (Roles)
   - billing.view_invoices (Billing)
   - system.manage (System)
   - system.manage_backups (System)
   - system.manage_settings (System)
   - system.monitor (System)
   - system.view_logs (System)
?? Creating 38 permissions from actual business requirements
   - system.view_metrics (System)
   - tenants.create (Tenants)
   - tenants.delete (Tenants)
   - tenants.edit (Tenants)
   - tenants.initialize (Tenants)
   - tenants.manage_settings (Tenants)
   - tenants.view (Tenants)
   - tenants.view_all (Tenants)
   - users.create (Users)
   - permissions.create (Permissions)
   - users.delete (Users)
   - users.edit (Users)
   - users.manage_roles (Users)
   - users.view (Users)
   - users.view_all (Users)
   - permissions.delete (Permissions)
   - permissions.edit (Permissions)
   - billing.view (Billing)
   - permissions.manage (Permissions)
   - billing.view_invoices (Billing)
   - permissions.create (Permissions)
   - permissions.delete (Permissions)
   - permissions.edit (Permissions)
   - permissions.view (Permissions)
   - permissions.manage (Permissions)
   - permissions.view (Permissions)
   - reports.create (Reports)
   - reports.export (Reports)
   - reports.create (Reports)
   - reports.schedule (Reports)
   - reports.view (Reports)
   - roles.assign_users (Roles)
   - reports.export (Reports)
   - roles.create (Roles)
   - roles.delete (Roles)
   - reports.schedule (Reports)
   - roles.edit (Roles)
   - reports.view (Reports)
   - roles.manage_permissions (Roles)
   - roles.assign_users (Roles)
   - roles.view (Roles)
   - roles.create (Roles)
   - roles.delete (Roles)
   - system.manage (System)
   - system.manage_backups (System)
   - roles.edit (Roles)
   - system.manage_settings (System)
   - system.monitor (System)
   - system.view_logs (System)
   - roles.manage_permissions (Roles)
   - system.view_metrics (System)
   - roles.view (Roles)
   - tenants.create (Tenants)
   - system.manage (System)
   - tenants.delete (Tenants)
   - system.manage_backups (System)
   - system.manage_settings (System)
   - system.monitor (System)
   - system.view_logs (System)
   - system.view_metrics (System)
   - tenants.create (Tenants)
   - tenants.edit (Tenants)
   - tenants.delete (Tenants)
   - tenants.edit (Tenants)
   - tenants.initialize (Tenants)
   - tenants.initialize (Tenants)
   - tenants.manage_settings (Tenants)
   - tenants.manage_settings (Tenants)
   - tenants.view (Tenants)
   - tenants.view (Tenants)
   - tenants.view_all (Tenants)
   - tenants.view_all (Tenants)
   - users.create (Users)
   - users.delete (Users)
   - users.edit (Users)
   - users.create (Users)
   - users.manage_roles (Users)
   - users.view (Users)
   - users.view_all (Users)
   - users.delete (Users)
   - users.edit (Users)
   - users.manage_roles (Users)
   - users.view (Users)
   - users.view_all (Users)
   - permissions.create (Permissions)
   - permissions.delete (Permissions)
   - permissions.edit (Permissions)
   - permissions.manage (Permissions)
   - billing.manage (Billing)
   - permissions.view (Permissions)
   - reports.create (Reports)
   - billing.process_payments (Billing)
   - reports.export (Reports)
   - reports.schedule (Reports)
   - reports.view (Reports)
   - billing.view (Billing)
   - billing.view_invoices (Billing)
   - permissions.create (Permissions)
   - permissions.delete (Permissions)
   - permissions.edit (Permissions)
   - permissions.manage (Permissions)
   - roles.assign_users (Roles)
   - roles.create (Roles)
   - roles.delete (Roles)
   - roles.edit (Roles)
   - roles.manage_permissions (Roles)
   - roles.view (Roles)
   - system.manage (System)
   - system.manage_backups (System)
   - system.manage_settings (System)
   - system.monitor (System)
   - system.view_logs (System)
   - system.view_metrics (System)
   - tenants.create (Tenants)
   - tenants.delete (Tenants)
   - tenants.edit (Tenants)
   - tenants.initialize (Tenants)
   - tenants.manage_settings (Tenants)
   - tenants.view (Tenants)
   - tenants.view_all (Tenants)
   - users.create (Users)
   - users.delete (Users)
   - users.edit (Users)
   - users.manage_roles (Users)
   - users.view (Users)
   - users.view_all (Users)
   - permissions.view (Permissions)
   - reports.create (Reports)
   - reports.export (Reports)
   - reports.schedule (Reports)
   - reports.view (Reports)
   - roles.assign_users (Roles)
   - roles.create (Roles)
   - roles.delete (Roles)
   - roles.edit (Roles)
   - roles.manage_permissions (Roles)
   - roles.view (Roles)
   - system.manage (System)
   - system.manage_backups (System)
   - system.manage_settings (System)
   - system.monitor (System)
   - system.view_logs (System)
   - system.view_metrics (System)
   - tenants.create (Tenants)
   - tenants.delete (Tenants)
   - tenants.edit (Tenants)
   - tenants.initialize (Tenants)
   - tenants.manage_settings (Tenants)
   - tenants.view (Tenants)
   - tenants.view_all (Tenants)
   - users.create (Users)
   - users.delete (Users)
   - users.edit (Users)
   - users.manage_roles (Users)
   - users.view (Users)
   - users.view_all (Users)
? Created 38 permissions
? Created 38 permissions
? Created 38 permissions
? Created 38 permissions
? Created 38 permissions
?? Creating roles...
?? Creating roles...
?? Creating roles...
?? Creating roles...
?? Creating roles...
?? CreateRoles DEBUG:
?? CreateRoles DEBUG:
?? CreateRoles DEBUG:
   - tenant1.Id = 1
?? CreateRoles DEBUG:
   - tenant1.Id = 1
   - tenant2.Id = 2
   - tenant2.Id = 2
   - tenant1.Id = 1
?? Roles to be created (8):
   - tenant2.Id = 2
?? Roles to be created (8):
?? Roles to be created (8):
   1. SuperAdmin (TenantId: )
   1. SuperAdmin (TenantId: )
   1. SuperAdmin (TenantId: )
   - tenant1.Id = 1
   - tenant2.Id = 2
?? CreateRoles DEBUG:
?? Roles to be created (8):
   - tenant1.Id = 1
   - tenant2.Id = 2
   1. SuperAdmin (TenantId: )
?? Roles to be created (8):
   2. Admin (TenantId: 1)
   1. SuperAdmin (TenantId: )
   3. User (TenantId: 1)
   4. Manager (TenantId: 1)
   5. Viewer (TenantId: 1)
   6. Editor (TenantId: 1)
   7. Admin (TenantId: 2)
   8. User (TenantId: 2)
   2. Admin (TenantId: 1)
   2. Admin (TenantId: 1)
   3. User (TenantId: 1)
   2. Admin (TenantId: 1)
   3. User (TenantId: 1)
   2. Admin (TenantId: 1)
   3. User (TenantId: 1)
   4. Manager (TenantId: 1)
   4. Manager (TenantId: 1)
   5. Viewer (TenantId: 1)
   6. Editor (TenantId: 1)
   7. Admin (TenantId: 2)
   8. User (TenantId: 2)
   3. User (TenantId: 1)
   4. Manager (TenantId: 1)
   5. Viewer (TenantId: 1)
   6. Editor (TenantId: 1)
   7. Admin (TenantId: 2)
   4. Manager (TenantId: 1)
   8. User (TenantId: 2)
   5. Viewer (TenantId: 1)
   6. Editor (TenantId: 1)
   7. Admin (TenantId: 2)
   8. User (TenantId: 2)
   5. Viewer (TenantId: 1)
   6. Editor (TenantId: 1)
   7. Admin (TenantId: 2)
   8. User (TenantId: 2)
? Created 8 roles
? Created 8 roles
? Created 8 roles
? Created 8 roles
? Created 8 roles
?? Verification - Created roles:
?? Verification - Created roles:
?? Verification - Created roles:
   - ID=8, Name='User', TenantId=2
   - ID=8, Name='User', TenantId=2
?? Verification - Created roles:
?? Verification - Created roles:
   - ID=7, Name='Admin', TenantId=2
   - ID=8, Name='User', TenantId=2
   - ID=8, Name='User', TenantId=2
   - ID=7, Name='Admin', TenantId=2
   - ID=7, Name='Admin', TenantId=2
   - ID=6, Name='Editor', TenantId=1
   - ID=5, Name='Viewer', TenantId=1
   - ID=8, Name='User', TenantId=2
   - ID=6, Name='Editor', TenantId=1
   - ID=7, Name='Admin', TenantId=2
   - ID=4, Name='Manager', TenantId=1
   - ID=6, Name='Editor', TenantId=1
   - ID=5, Name='Viewer', TenantId=1
   - ID=3, Name='User', TenantId=1
   - ID=4, Name='Manager', TenantId=1
   - ID=2, Name='Admin', TenantId=1
   - ID=5, Name='Viewer', TenantId=1
   - ID=3, Name='User', TenantId=1
   - ID=1, Name='SuperAdmin', TenantId=
   - ID=2, Name='Admin', TenantId=1
   - ID=4, Name='Manager', TenantId=1
   - ID=1, Name='SuperAdmin', TenantId=
   - ID=3, Name='User', TenantId=1
   - ID=2, Name='Admin', TenantId=1
   - ID=1, Name='SuperAdmin', TenantId=
   - ID=6, Name='Editor', TenantId=1
   - ID=7, Name='Admin', TenantId=2
   - ID=5, Name='Viewer', TenantId=1
   - ID=6, Name='Editor', TenantId=1
   - ID=4, Name='Manager', TenantId=1
   - ID=5, Name='Viewer', TenantId=1
   - ID=3, Name='User', TenantId=1
   - ID=4, Name='Manager', TenantId=1
   - ID=2, Name='Admin', TenantId=1
   - ID=3, Name='User', TenantId=1
   - ID=1, Name='SuperAdmin', TenantId=
   - ID=2, Name='Admin', TenantId=1
   - ID=1, Name='SuperAdmin', TenantId=
? Successfully created all 8 roles including 2 Tenant 2 roles
? Successfully created all 8 roles including 2 Tenant 2 roles
? Successfully created all 8 roles including 2 Tenant 2 roles
? Successfully created all 8 roles including 2 Tenant 2 roles
? Successfully created all 8 roles including 2 Tenant 2 roles
?? Creating role permissions...
?? Creating role permissions...
?? Creating role permissions...
?? Creating role permissions...
?? Creating role permissions...
?? Found 38 permissions and 8 roles
?? Found 38 permissions and 8 roles
?? ALL LOADED ROLES:
?? ALL LOADED ROLES:
   - ID=8, Name='User', TenantId=2
   - ID=8, Name='User', TenantId=2
   - ID=7, Name='Admin', TenantId=2
?? Found 38 permissions and 8 roles
   - ID=6, Name='Editor', TenantId=1
?? ALL LOADED ROLES:
   - ID=7, Name='Admin', TenantId=2
   - ID=5, Name='Viewer', TenantId=1
   - ID=8, Name='User', TenantId=2
   - ID=6, Name='Editor', TenantId=1
?? Found 38 permissions and 8 roles
?? ALL LOADED ROLES:
   - ID=7, Name='Admin', TenantId=2
   - ID=8, Name='User', TenantId=2
   - ID=6, Name='Editor', TenantId=1
   - ID=7, Name='Admin', TenantId=2
   - ID=5, Name='Viewer', TenantId=1
   - ID=6, Name='Editor', TenantId=1
   - ID=5, Name='Viewer', TenantId=1
   - ID=4, Name='Manager', TenantId=1
   - ID=3, Name='User', TenantId=1
   - ID=4, Name='Manager', TenantId=1
   - ID=2, Name='Admin', TenantId=1
   - ID=3, Name='User', TenantId=1
   - ID=1, Name='SuperAdmin', TenantId=
   - ID=2, Name='Admin', TenantId=1
   - ID=1, Name='SuperAdmin', TenantId=
?? Found 38 permissions and 8 roles
?? ALL LOADED ROLES:
   - ID=8, Name='User', TenantId=2
   - ID=7, Name='Admin', TenantId=2
   - ID=4, Name='Manager', TenantId=1
   - ID=6, Name='Editor', TenantId=1
   - ID=3, Name='User', TenantId=1
   - ID=2, Name='Admin', TenantId=1
   - ID=1, Name='SuperAdmin', TenantId=
   - ID=5, Name='Viewer', TenantId=1
   - ID=4, Name='Manager', TenantId=1
   - ID=3, Name='User', TenantId=1
   - ID=5, Name='Viewer', TenantId=1
   - ID=2, Name='Admin', TenantId=1
   - ID=4, Name='Manager', TenantId=1
   - ID=1, Name='SuperAdmin', TenantId=
   - ID=3, Name='User', TenantId=1
   - ID=2, Name='Admin', TenantId=1
   - ID=1, Name='SuperAdmin', TenantId=
? Assigned 38 permissions to SuperAdmin
? Assigned 38 permissions to SuperAdmin
? Assigned 38 permissions to SuperAdmin
? Assigned 38 permissions to SuperAdmin
? Assigned 38 permissions to SuperAdmin
? Assigned 28 permissions to Tenant1 Admin
? Assigned 28 permissions to Tenant1 Admin
? Assigned 28 permissions to Tenant1 Admin
? Assigned 28 permissions to Tenant1 Admin
? Assigned 28 permissions to Tenant1 Admin
? Assigned 3 permissions to Tenant1 User
? Assigned 3 permissions to Tenant1 User
? Assigned 3 permissions to Tenant1 User
? Assigned 3 permissions to Tenant1 User
? Assigned 3 permissions to Tenant1 User
? Assigned 6 permissions to Tenant1 Manager
? Assigned 6 permissions to Tenant1 Manager
? Assigned 6 permissions to Tenant1 Manager
? Assigned 6 permissions to Tenant1 Manager
? Assigned 6 permissions to Tenant1 Manager
? Assigned 3 permissions to Viewer
?? TENANT 2 ADMIN DEBUG:
? Assigned 3 permissions to Viewer
?? TENANT 2 ADMIN DEBUG:
? Assigned 3 permissions to Viewer
?? TENANT 2 ADMIN DEBUG:
? Assigned 3 permissions to Viewer
   - tenant2.Id = 2
   - All roles count: 8
   - tenant2.Id = 2
   - All roles count: 8
?? TENANT 2 ADMIN DEBUG:
   - tenant2.Id = 2
   - All roles count: 8
? Assigned 3 permissions to Viewer
?? TENANT 2 ADMIN DEBUG:
   - tenant2.Id = 2
   - All roles count: 8
   - tenant2.Id = 2
   - All roles count: 8
   - Roles with TenantId = 2: 2
   - Roles with TenantId = 2: 2
   - Roles with TenantId = 2: 2
   - Roles with TenantId = 2: 2
   - Roles with TenantId = 2: 2
   - Admin roles: ID=7, TenantId=2, ID=2, TenantId=1
   - Admin roles: ID=7, TenantId=2, ID=2, TenantId=1
   - Admin roles: ID=7, TenantId=2, ID=2, TenantId=1
   - Admin roles: ID=7, TenantId=2, ID=2, TenantId=1
   - Admin roles: ID=7, TenantId=2, ID=2, TenantId=1
   - tenant2AdminRole found: True
   - tenant2AdminRole.Id = 7
   - tenant2AdminRole found: True
   - tenant2AdminRole.Id = 7
   - tenant2AdminRole found: True
   - tenant2AdminRole.Id = 7
?? DEBUG: Found 28 permissions for Tenant2 Admin
   - tenant2AdminRole found: True
   - tenant2AdminRole found: True
   - tenant2AdminRole.Id = 7
   - tenant2AdminRole.Id = 7
? Assigned 28 permissions to Tenant2 Admin (Expected: 23+)
?? DEBUG: Found 28 permissions for Tenant2 Admin
?? DEBUG: Found 28 permissions for Tenant2 Admin
?? DEBUG: Found 28 permissions for Tenant2 Admin
? Assigned 28 permissions to Tenant2 Admin (Expected: 23+)
? Assigned 28 permissions to Tenant2 Admin (Expected: 23+)
?? DEBUG: Found 28 permissions for Tenant2 Admin
? Assigned 28 permissions to Tenant2 Admin (Expected: 23+)
? Assigned 28 permissions to Tenant2 Admin (Expected: 23+)
? Assigned 3 permissions to Tenant2 User
? Assigned 3 permissions to Tenant2 User
? Assigned 3 permissions to Tenant2 User
? Assigned 3 permissions to Tenant2 User
? Assigned 3 permissions to Tenant2 User
? Created 109 role permissions using only actual business-defined permissions
? Created 109 role permissions using only actual business-defined permissions
? Created 109 role permissions using only actual business-defined permissions
? Created 109 role permissions using only actual business-defined permissions
? Created 109 role permissions using only actual business-defined permissions
?? Creating users...
?? Creating users...
?? Creating users...
?? Creating users...
?? Creating users...
?? Adding 7 users to main context
?? Adding 7 users to main context
?? Adding 7 users to main context
?? Adding 7 users to main context
?? Adding 7 users to main context
? All users created successfully
? All users created successfully
? All users created successfully
? Final user count: 7
? Final user count: 7
? Verified required user exists: admin@tenant1.com (ID:  1)
? Verified required user exists: admin@tenant1.com (ID:  1)
? Verified required user exists: user@tenant1.com (ID:  2)
? Verified required user exists: user@tenant1.com (ID:  2)
? Verified required user exists: admin@tenant2.com (ID:  6)
? Verified required user exists: user@tenant2.com (ID:  7)
?? All users created and verified successfully!
? Verified required user exists: admin@tenant2.com (ID:  6)
? Verified required user exists: user@tenant2.com (ID:  7)
?? All users created and verified successfully!
?? Creating user role assignments...
?? Creating user role assignments...
? Final user count: 7
? Verified required user exists: admin@tenant1.com (ID:  1)
? Verified required user exists: user@tenant1.com (ID:  2)
? Verified required user exists: admin@tenant2.com (ID:  6)
? Verified required user exists: user@tenant2.com (ID:  7)
?? All users created and verified successfully!
?? Creating user role assignments...
? All users created successfully
? Final user count: 7
? Verified required user exists: admin@tenant1.com (ID:  1)
? Verified required user exists: user@tenant1.com (ID:  2)
? Verified required user exists: admin@tenant2.com (ID:  6)
? Verified required user exists: user@tenant2.com (ID:  7)
?? All users created and verified successfully!
?? Creating user role assignments...
? All users created successfully
? Final user count: 7
? Verified required user exists: admin@tenant1.com (ID:  1)
? Verified required user exists: user@tenant1.com (ID:  2)
? Verified required user exists: admin@tenant2.com (ID:  6)
? Verified required user exists: user@tenant2.com (ID:  7)
?? All users created and verified successfully!
?? Creating user role assignments...
?? Found 7 users and 8 roles for assignment
?? Found 7 users and 8 roles for assignment
?? Found 7 users and 8 roles for assignment
?? Found 7 users and 8 roles for assignment
?? Found 7 users and 8 roles for assignment
?? Adding 8 user role assignments...
?? Adding 8 user role assignments...
?? Adding 8 user role assignments...
?? Adding 8 user role assignments...
?? Adding 8 user role assignments...
? Created 8 user role assignments
? Created 8 user role assignments
? Created 8 user role assignments
? Created 8 user role assignments
? Created 8 user role assignments
?? Creating legacy tenant users...
?? Creating legacy tenant users...
?? Creating legacy tenant users...
?? Creating legacy tenant users...
?? Creating legacy tenant users...
? Created 7 legacy tenant users
? Created 7 legacy tenant users
? Created 7 legacy tenant users
? Created 7 legacy tenant users
? Created 7 legacy tenant users
?? Verifying test data...
?? Temporarily disabling query filters for verification...
?? Verifying test data...
?? Verifying test data...
?? Temporarily disabling query filters for verification...
?? Temporarily disabling query filters for verification...
?? Verifying test data...
?? Temporarily disabling query filters for verification...
?? Verifying test data...
?? Temporarily disabling query filters for verification...
?? Final counts: Tenants=2, Users=7, Roles=8, Permissions=38, UserRoles=8, RolePermissions=109
?? Final counts: Tenants=2, Users=7, Roles=8, Permissions=38, UserRoles=8, RolePermissions=109
?? Final counts: Tenants=2, Users=7, Roles=8, Permissions=38, UserRoles=8, RolePermissions=109
?? Final counts: Tenants=2, Users=7, Roles=8, Permissions=38, UserRoles=8, RolePermissions=109
?? Final counts: Tenants=2, Users=7, Roles=8, Permissions=38, UserRoles=8, RolePermissions=109
? Verified user: admin@tenant1.com (ID: 1)
? Verified user: admin@tenant1.com (ID: 1)
? Verified user: admin@tenant1.com (ID: 1)
? Verified user: admin@tenant1.com (ID: 1)
? Verified user: admin@tenant1.com (ID: 1)
? Verified user: user@tenant1.com (ID: 2)
? Verified user: user@tenant1.com (ID: 2)
? Verified user: user@tenant1.com (ID: 2)
? Verified user: user@tenant1.com (ID: 2)
? Verified user: admin@tenant2.com (ID: 6)
? Verified user: admin@tenant2.com (ID: 6)
? Verified user: admin@tenant2.com (ID: 6)
? Verified user: admin@tenant2.com (ID: 6)
? Verified user: user@tenant1.com (ID: 2)
? Verified user: admin@tenant2.com (ID: 6)
? admin@tenant1.com has 1 role assignments
? admin@tenant1.com has 1 role assignments
? TestDataSeeder: Test data seeding completed successfully
? TestDataSeeder: Test data seeding completed successfully
? admin@tenant1.com has 1 role assignments
? TestDataSeeder: Test data seeding completed successfully
? admin@tenant1.com has 1 role assignments
? TestDataSeeder: Test data seeding completed successfully
? admin@tenant1.com has 1 role assignments
? TestDataSeeder: Test data seeding completed successfully
[13:48:44 INF] ?? Test Data Status: Tenants=2, Users=7, Roles=8, Permissions=38, UserRoles=8, RolePermissions=109 {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF] ?? Test Data Status: Tenants=2, Users=7, Roles=8, Permissions=38, UserRoles=8, RolePermissions=109 {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF] ?? Test Data Status: Tenants=2, Users=7, Roles=8, Permissions=38, UserRoles=8, RolePermissions=109 {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF] ?? Test Data Status: Tenants=2, Users=7, Roles=8, Permissions=38, UserRoles=8, RolePermissions=109 {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF] ?? Test Data Status: Tenants=2, Users=7, Roles=8, Permissions=38, UserRoles=8, RolePermissions=109 {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF] ?? Tenant IDs: Tenant1=1, Tenant2=2 {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF] ?? Tenant IDs: Tenant1=1, Tenant2=2 {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF] ?? Tenant IDs: Tenant1=1, Tenant2=2 {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF] ?? Tenant IDs: Tenant1=1, Tenant2=2 {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF] ?? Tenant IDs: Tenant1=1, Tenant2=2 {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF] ?? User IDs: Admin=1, User=2 {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF] ?? User IDs: Admin=1, User=2 {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF] ?? User IDs: Admin=1, User=2 {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF] ?? User IDs: Admin=1, User=2 {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF] ?? User IDs: Admin=1, User=2 {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF] ?? Admin user analysis: {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF] ?? Admin user analysis: {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF] ?? Admin user analysis: {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF]    - Email: admin@tenant1.com {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF]    - Email: admin@tenant1.com {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF]    - UserRoles count: 1 {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF]    - UserRoles count: 1 {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF]    - Active UserRoles: 1 {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF]    - Active UserRoles: 1 {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF]    - Permissions: 28 [users.view, users.edit, users.create, users.delete, users.view_all, users.manage_roles, roles.view, roles.create, roles.edit, roles.delete, roles.assign_users, roles.manage_permissions, tenants.view, tenants.create, tenants.edit, tenants.delete, tenants.initialize, tenants.view_all, tenants.manage_settings, reports.view, reports.create, reports.export, reports.schedule, permissions.view, permissions.create, permissions.edit, permissions.delete, permissions.manage] {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF] ?? Admin user analysis: {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF]    - Email: admin@tenant1.com {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF]    - UserRoles count: 1 {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF]    - Active UserRoles: 1 {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF]    - Permissions: 28 [users.view, users.edit, users.create, users.delete, users.view_all, users.manage_roles, roles.view, roles.create, roles.edit, roles.delete, roles.assign_users, roles.manage_permissions, tenants.view, tenants.create, tenants.edit, tenants.delete, tenants.initialize, tenants.view_all, tenants.manage_settings, reports.view, reports.create, reports.export, reports.schedule, permissions.view, permissions.create, permissions.edit, permissions.delete, permissions.manage] {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF]    - Email: admin@tenant1.com {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF]    - UserRoles count: 1 {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF]    - Active UserRoles: 1 {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF]    - Permissions: 28 [users.view, users.edit, users.create, users.delete, users.view_all, users.manage_roles, roles.view, roles.create, roles.edit, roles.delete, roles.assign_users, roles.manage_permissions, tenants.view, tenants.create, tenants.edit, tenants.delete, tenants.initialize, tenants.view_all, tenants.manage_settings, reports.view, reports.create, reports.export, reports.schedule, permissions.view, permissions.create, permissions.edit, permissions.delete, permissions.manage] {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF] ?? Admin user analysis: {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF]    - Email: admin@tenant1.com {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF]    - Permissions: 28 [users.view, users.edit, users.create, users.delete, users.view_all, users.manage_roles, roles.view, roles.create, roles.edit, roles.delete, roles.assign_users, roles.manage_permissions, tenants.view, tenants.create, tenants.edit, tenants.delete, tenants.initialize, tenants.view_all, tenants.manage_settings, reports.view, reports.create, reports.export, reports.schedule, permissions.view, permissions.create, permissions.edit, permissions.delete, permissions.manage] {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF]    - UserRoles count: 1 {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF]    - Active UserRoles: 1 {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF]    - Permissions: 28 [users.view, users.edit, users.create, users.delete, users.view_all, users.manage_roles, roles.view, roles.create, roles.edit, roles.delete, roles.assign_users, roles.manage_permissions, tenants.view, tenants.create, tenants.edit, tenants.delete, tenants.initialize, tenants.view_all, tenants.manage_settings, reports.view, reports.create, reports.export, reports.schedule, permissions.view, permissions.create, permissions.edit, permissions.delete, permissions.manage] {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF]    - Tenant: Test Tenant 1 {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF]    - Tenant: Test Tenant 1 {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF]    - Tenant: Test Tenant 1 {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF]    - Tenant: Test Tenant 1 {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF]    - Tenant: Test Tenant 1 {"SourceContext": "UserService.IntegrationTests.TestBase"}
?? MOCKING two-phase flow for admin@tenant1.com  Tenant 1
?? MOCKING two-phase flow for admin@tenant1.com  Tenant 1
? Phase 1 simulated: User admin@tenant1.com authenticated (mocked)
? Phase 1 simulated: User admin@tenant1.com authenticated (mocked)
?? MOCKING two-phase flow for admin@tenant1.com  Tenant 1
?? MOCKING two-phase flow for admin@tenant1.com  Tenant 1
? Phase 1 simulated: User admin@tenant1.com authenticated (mocked)
? Phase 1 simulated: User admin@tenant1.com authenticated (mocked)
?? MOCKING two-phase flow for admin@tenant1.com  Tenant 1
? Phase 1 simulated: User admin@tenant1.com authenticated (mocked)
? Phase 2 simulated: Tenant access verified for tenant 1
? Phase 2 simulated: Tenant access verified for tenant 1
? Phase 2 simulated: Tenant access verified for tenant 1
? Phase 2 simulated: Tenant access verified for tenant 1
? Phase 2 simulated: Tenant access verified for tenant 1
?? MOCKING two-phase flow for admin@tenant2.com  Tenant 1
?? MOCKING two-phase flow for admin@tenant2.com  Tenant 1
? Phase 1 simulated: User admin@tenant2.com authenticated (mocked)
? Phase 1 simulated: User admin@tenant2.com authenticated (mocked)
?? MOCKING two-phase flow for admin@tenant2.com  Tenant 1
?? MOCKING two-phase flow for admin@tenant2.com  Tenant 1
? Phase 1 simulated: User admin@tenant2.com authenticated (mocked)
? Phase 1 simulated: User admin@tenant2.com authenticated (mocked)
?? Ensuring clean database state...
?? Ensuring clean database state...
? Database recreated with clean state
?? TestDataSeeder: Starting test data seeding
?? Creating tenants...
? Database recreated with clean state
?? TestDataSeeder: Starting test data seeding
?? Creating tenants...
? Created 2 tenants
?? Creating permissions...
? Created 2 tenants
?? Creating permissions...
[xUnit.net 00:00:01.32]     UserService.IntegrationTests.Security.CrossTenantSecurityTests.RemoveRoleFromUser_CrossTenantRole_ShouldFail [FAIL]
?? Creating 38 permissions from actual business requirements
   - billing.manage (Billing)
   - billing.process_payments (Billing)
   - billing.view (Billing)
   - billing.view_invoices (Billing)
   - permissions.create (Permissions)
   - permissions.delete (Permissions)
   - permissions.edit (Permissions)
   - permissions.manage (Permissions)
   - permissions.view (Permissions)
   - reports.create (Reports)
   - reports.export (Reports)
   - reports.schedule (Reports)
   - reports.view (Reports)
   - roles.assign_users (Roles)
   - roles.create (Roles)
   - roles.delete (Roles)
   - roles.edit (Roles)
   - roles.manage_permissions (Roles)
   - roles.view (Roles)
   - system.manage (System)
   - system.manage_backups (System)
   - system.manage_settings (System)
   - system.monitor (System)
   - system.view_logs (System)
   - system.view_metrics (System)
   - tenants.create (Tenants)
   - tenants.delete (Tenants)
   - tenants.edit (Tenants)
   - tenants.initialize (Tenants)
   - tenants.manage_settings (Tenants)
   - tenants.view (Tenants)
   - tenants.view_all (Tenants)
   - users.create (Users)
   - users.delete (Users)
   - users.edit (Users)
   - users.manage_roles (Users)
   - users.view (Users)
   - users.view_all (Users)
?? Creating 38 permissions from actual business requirements
   - billing.manage (Billing)
   - billing.process_payments (Billing)
   - billing.view (Billing)
   - billing.view_invoices (Billing)
   - permissions.create (Permissions)
   - permissions.delete (Permissions)
   - permissions.edit (Permissions)
   - permissions.manage (Permissions)
   - permissions.view (Permissions)
   - reports.create (Reports)
   - reports.export (Reports)
   - reports.schedule (Reports)
   - reports.view (Reports)
   - roles.assign_users (Roles)
   - roles.create (Roles)
   - roles.delete (Roles)
   - roles.edit (Roles)
   - roles.manage_permissions (Roles)
   - roles.view (Roles)
   - system.manage (System)
   - system.manage_backups (System)
[xUnit.net 00:00:01.32]       System.UnauthorizedAccessException : User admin@tenant2.com does not have access to tenant 1
   - system.manage_settings (System)
   - system.monitor (System)
   - system.view_logs (System)
   - system.view_metrics (System)
   - tenants.create (Tenants)
   - tenants.delete (Tenants)
   - tenants.edit (Tenants)
   - tenants.initialize (Tenants)
   - tenants.manage_settings (Tenants)
   - tenants.view (Tenants)
   - tenants.view_all (Tenants)
   - users.create (Users)
   - users.delete (Users)
   - users.edit (Users)
   - users.manage_roles (Users)
   - users.view (Users)
   - users.view_all (Users)
[xUnit.net 00:00:01.32]       Stack Trace:
[xUnit.net 00:00:01.32]         C:\Users\mccre\dev\boiler\tests\integration\UserService.IntegrationTests\TestUtilities\AuthenticationHelper.cs(92,0): at UserService.IntegrationTests.TestUtilities.AuthenticationHelper.GetTenantTokenViaTwoPhaseFlow(HttpClient client, ApplicationDbContext dbContext, String email, Int32 preferredTenantId)
[xUnit.net 00:00:01.32]         C:\Users\mccre\dev\boiler\tests\integration\UserService.IntegrationTests\TestUtilities\AuthenticationHelper.cs(337,0): at UserService.IntegrationTests.TestUtilities.AuthenticationHelper.GetTenantAwareJwtAsync(HttpClient client, ApplicationDbContext dbContext, String email, Nullable`1 preferredTenantId)
[xUnit.net 00:00:01.32]         C:\Users\mccre\dev\boiler\tests\integration\UserService.IntegrationTests\TestBase.cs(137,0): at UserService.IntegrationTests.TestBase.GetAuthTokenAsync(String email, Nullable`1 tenantId)
[xUnit.net 00:00:01.32]         C:\Users\mccre\dev\boiler\tests\integration\UserService.IntegrationTests\Security\CrossTenantSecurityTests.cs(188,0): at UserService.IntegrationTests.Security.CrossTenantSecurityTests.RemoveRoleFromUser_CrossTenantRole_ShouldFail()
[xUnit.net 00:00:01.32]         --- End of stack trace from previous location ---
? Created 38 permissions
?? Creating roles...
?? CreateRoles DEBUG:
   - tenant1.Id = 1
   - tenant2.Id = 2
?? Roles to be created (8):
? Created 38 permissions
?? Creating roles...
   1. SuperAdmin (TenantId: )
   2. Admin (TenantId: 1)
   3. User (TenantId: 1)
   4. Manager (TenantId: 1)
   5. Viewer (TenantId: 1)
   6. Editor (TenantId: 1)
   7. Admin (TenantId: 2)
   8. User (TenantId: 2)
?? CreateRoles DEBUG:
   - tenant1.Id = 1
   - tenant2.Id = 2
?? Roles to be created (8):
   1. SuperAdmin (TenantId: )
   2. Admin (TenantId: 1)
   3. User (TenantId: 1)
   4. Manager (TenantId: 1)
   5. Viewer (TenantId: 1)
   6. Editor (TenantId: 1)
   7. Admin (TenantId: 2)
   8. User (TenantId: 2)
? Created 8 roles
?? Verification - Created roles:
   - ID=8, Name='User', TenantId=2
   - ID=7, Name='Admin', TenantId=2
   - ID=6, Name='Editor', TenantId=1
   - ID=5, Name='Viewer', TenantId=1
   - ID=4, Name='Manager', TenantId=1
   - ID=3, Name='User', TenantId=1
   - ID=2, Name='Admin', TenantId=1
   - ID=1, Name='SuperAdmin', TenantId=
? Successfully created all 8 roles including 2 Tenant 2 roles
?? Creating role permissions...
?? Found 38 permissions and 8 roles
?? ALL LOADED ROLES:
   - ID=8, Name='User', TenantId=2
   - ID=7, Name='Admin', TenantId=2
   - ID=6, Name='Editor', TenantId=1
   - ID=5, Name='Viewer', TenantId=1
   - ID=4, Name='Manager', TenantId=1
   - ID=3, Name='User', TenantId=1
   - ID=2, Name='Admin', TenantId=1
   - ID=1, Name='SuperAdmin', TenantId=
? Assigned 38 permissions to SuperAdmin
? Assigned 28 permissions to Tenant1 Admin
? Assigned 3 permissions to Tenant1 User
? Created 8 roles
? Assigned 6 permissions to Tenant1 Manager
? Assigned 3 permissions to Viewer
?? TENANT 2 ADMIN DEBUG:
   - tenant2.Id = 2
   - All roles count: 8
   - Roles with TenantId = 2: 2
   - Admin roles: ID=7, TenantId=2, ID=2, TenantId=1
   - tenant2AdminRole found: True
   - tenant2AdminRole.Id = 7
?? Verification - Created roles:
?? DEBUG: Found 28 permissions for Tenant2 Admin
   - ID=8, Name='User', TenantId=2
   - ID=7, Name='Admin', TenantId=2
   - ID=6, Name='Editor', TenantId=1
   - ID=5, Name='Viewer', TenantId=1
   - ID=4, Name='Manager', TenantId=1
   - ID=3, Name='User', TenantId=1
   - ID=2, Name='Admin', TenantId=1
? Assigned 28 permissions to Tenant2 Admin (Expected: 23+)
   - ID=1, Name='SuperAdmin', TenantId=
? Assigned 3 permissions to Tenant2 User
? Successfully created all 8 roles including 2 Tenant 2 roles
?? Creating role permissions...
?? Found 38 permissions and 8 roles
?? ALL LOADED ROLES:
   - ID=8, Name='User', TenantId=2
   - ID=7, Name='Admin', TenantId=2
   - ID=6, Name='Editor', TenantId=1
   - ID=5, Name='Viewer', TenantId=1
   - ID=4, Name='Manager', TenantId=1
   - ID=3, Name='User', TenantId=1
   - ID=2, Name='Admin', TenantId=1
   - ID=1, Name='SuperAdmin', TenantId=
? Assigned 38 permissions to SuperAdmin
? Assigned 28 permissions to Tenant1 Admin
? Assigned 3 permissions to Tenant1 User
? Assigned 6 permissions to Tenant1 Manager
? Assigned 3 permissions to Viewer
?? TENANT 2 ADMIN DEBUG:
   - tenant2.Id = 2
   - All roles count: 8
   - Roles with TenantId = 2: 2
   - Admin roles: ID=7, TenantId=2, ID=2, TenantId=1
   - tenant2AdminRole found: True
   - tenant2AdminRole.Id = 7
?? DEBUG: Found 28 permissions for Tenant2 Admin
? Assigned 28 permissions to Tenant2 Admin (Expected: 23+)
? Assigned 3 permissions to Tenant2 User
[xUnit.net 00:00:01.33]     UserService.IntegrationTests.Controllers.RolesControllerTests.GetRolePermissions_CrossTenantAttempt_ReturnsNotFound [FAIL]
[xUnit.net 00:00:01.33]       System.UnauthorizedAccessException : User admin@tenant2.com does not have access to tenant 1
[xUnit.net 00:00:01.33]       Stack Trace:
[xUnit.net 00:00:01.33]         C:\Users\mccre\dev\boiler\tests\integration\UserService.IntegrationTests\TestUtilities\AuthenticationHelper.cs(92,0): at UserService.IntegrationTests.TestUtilities.AuthenticationHelper.GetTenantTokenViaTwoPhaseFlow(HttpClient client, ApplicationDbContext dbContext, String email, Int32 preferredTenantId)
[xUnit.net 00:00:01.33]         C:\Users\mccre\dev\boiler\tests\integration\UserService.IntegrationTests\TestUtilities\AuthenticationHelper.cs(337,0): at UserService.IntegrationTests.TestUtilities.AuthenticationHelper.GetTenantAwareJwtAsync(HttpClient client, ApplicationDbContext dbContext, String email, Nullable`1 preferredTenantId)
[xUnit.net 00:00:01.33]         C:\Users\mccre\dev\boiler\tests\integration\UserService.IntegrationTests\TestBase.cs(137,0): at UserService.IntegrationTests.TestBase.GetAuthTokenAsync(String email, Nullable`1 tenantId)
[xUnit.net 00:00:01.33]         C:\Users\mccre\dev\boiler\tests\integration\UserService.IntegrationTests\Controllers\RolesControllerTests.cs(448,0): at UserService.IntegrationTests.Controllers.RolesControllerTests.GetRolePermissions_CrossTenantAttempt_ReturnsNotFound()
[xUnit.net 00:00:01.33]         --- End of stack trace from previous location ---
[xUnit.net 00:00:01.33]     UserService.IntegrationTests.Controllers.UsersControllerTests.DeleteUser_CrossTenantAttempt_ReturnsNotFound [FAIL]
[xUnit.net 00:00:01.33]       System.UnauthorizedAccessException : User admin@tenant2.com does not have access to tenant 1
[xUnit.net 00:00:01.33]       Stack Trace:
[xUnit.net 00:00:01.33]         C:\Users\mccre\dev\boiler\tests\integration\UserService.IntegrationTests\TestUtilities\AuthenticationHelper.cs(92,0): at UserService.IntegrationTests.TestUtilities.AuthenticationHelper.GetTenantTokenViaTwoPhaseFlow(HttpClient client, ApplicationDbContext dbContext, String email, Int32 preferredTenantId)
[xUnit.net 00:00:01.33]         C:\Users\mccre\dev\boiler\tests\integration\UserService.IntegrationTests\TestUtilities\AuthenticationHelper.cs(337,0): at UserService.IntegrationTests.TestUtilities.AuthenticationHelper.GetTenantAwareJwtAsync(HttpClient client, ApplicationDbContext dbContext, String email, Nullable`1 preferredTenantId)
[xUnit.net 00:00:01.33]         C:\Users\mccre\dev\boiler\tests\integration\UserService.IntegrationTests\TestBase.cs(137,0): at UserService.IntegrationTests.TestBase.GetAuthTokenAsync(String email, Nullable`1 tenantId)
[xUnit.net 00:00:01.33]         C:\Users\mccre\dev\boiler\tests\integration\UserService.IntegrationTests\Controllers\UsersControllerTests.cs(349,0): at UserService.IntegrationTests.Controllers.UsersControllerTests.DeleteUser_CrossTenantAttempt_ReturnsNotFound()
[xUnit.net 00:00:01.33]         --- End of stack trace from previous location ---
[xUnit.net 00:00:01.33]     UserService.IntegrationTests.Auditing.AuditLoggingVerificationTests.CrossTenantAccess_ShouldLogSecurityViolations [FAIL]
[xUnit.net 00:00:01.33]       System.UnauthorizedAccessException : User admin@tenant2.com does not have access to tenant 1
[xUnit.net 00:00:01.33]       Stack Trace:
[xUnit.net 00:00:01.33]         C:\Users\mccre\dev\boiler\tests\integration\UserService.IntegrationTests\TestUtilities\AuthenticationHelper.cs(92,0): at UserService.IntegrationTests.TestUtilities.AuthenticationHelper.GetTenantTokenViaTwoPhaseFlow(HttpClient client, ApplicationDbContext dbContext, String email, Int32 preferredTenantId)
[xUnit.net 00:00:01.33]         C:\Users\mccre\dev\boiler\tests\integration\UserService.IntegrationTests\TestUtilities\AuthenticationHelper.cs(337,0): at UserService.IntegrationTests.TestUtilities.AuthenticationHelper.GetTenantAwareJwtAsync(HttpClient client, ApplicationDbContext dbContext, String email, Nullable`1 preferredTenantId)
[xUnit.net 00:00:01.33]         C:\Users\mccre\dev\boiler\tests\integration\UserService.IntegrationTests\TestBase.cs(137,0): at UserService.IntegrationTests.TestBase.GetAuthTokenAsync(String email, Nullable`1 tenantId)
[xUnit.net 00:00:01.33]         C:\Users\mccre\dev\boiler\tests\integration\UserService.IntegrationTests\Auditing\AuditLoggingVerificationTests.cs(320,0): at UserService.IntegrationTests.Auditing.AuditLoggingVerificationTests.CrossTenantAccess_ShouldLogSecurityViolations()
[xUnit.net 00:00:01.33]         --- End of stack trace from previous location ---
? Created 109 role permissions using only actual business-defined permissions
?? Creating users...
?? Adding 7 users to main context
? Created 109 role permissions using only actual business-defined permissions
?? Creating users...
?? Adding 7 users to main context
? All users created successfully
? Final user count: 7
? Verified required user exists: admin@tenant1.com (ID:  1)
? Verified required user exists: user@tenant1.com (ID:  2)
? Verified required user exists: admin@tenant2.com (ID:  6)
? Verified required user exists: user@tenant2.com (ID:  7)
?? All users created and verified successfully!
?? Creating user role assignments...
?? Found 7 users and 8 roles for assignment
?? Adding 8 user role assignments...
? All users created successfully
? Final user count: 7
? Verified required user exists: admin@tenant1.com (ID:  1)
? Verified required user exists: user@tenant1.com (ID:  2)
? Verified required user exists: admin@tenant2.com (ID:  6)
? Verified required user exists: user@tenant2.com (ID:  7)
?? All users created and verified successfully!
?? Creating user role assignments...
?? Found 7 users and 8 roles for assignment
?? Adding 8 user role assignments...
? Created 8 user role assignments
?? Creating legacy tenant users...
? Created 8 user role assignments
?? Creating legacy tenant users...
? Created 7 legacy tenant users
?? Verifying test data...
?? Temporarily disabling query filters for verification...
?? Final counts: Tenants=2, Users=7, Roles=8, Permissions=38, UserRoles=8, RolePermissions=109
? Verified user: admin@tenant1.com (ID: 1)
? Created 7 legacy tenant users
?? Verifying test data...
?? Temporarily disabling query filters for verification...
? Verified user: user@tenant1.com (ID: 2)
?? Final counts: Tenants=2, Users=7, Roles=8, Permissions=38, UserRoles=8, RolePermissions=109
? Verified user: admin@tenant2.com (ID: 6)
? Verified user: admin@tenant1.com (ID: 1)
? Verified user: user@tenant1.com (ID: 2)
? admin@tenant1.com has 1 role assignments
? TestDataSeeder: Test data seeding completed successfully
? Verified user: admin@tenant2.com (ID: 6)
? admin@tenant1.com has 1 role assignments
? TestDataSeeder: Test data seeding completed successfully
[13:48:44 INF] ?? Test Data Status: Tenants=2, Users=7, Roles=8, Permissions=38, UserRoles=8, RolePermissions=109 {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF] ?? Test Data Status: Tenants=2, Users=7, Roles=8, Permissions=38, UserRoles=8, RolePermissions=109 {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF] ?? Tenant IDs: Tenant1=1, Tenant2=2 {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF] ?? Tenant IDs: Tenant1=1, Tenant2=2 {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF] ?? User IDs: Admin=1, User=2 {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF] ?? User IDs: Admin=1, User=2 {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF] ?? Admin user analysis: {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF]    - Email: admin@tenant1.com {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF] ?? Admin user analysis: {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF]    - UserRoles count: 1 {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF]    - Email: admin@tenant1.com {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF]    - Active UserRoles: 1 {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF]    - UserRoles count: 1 {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF]    - Permissions: 28 [users.view, users.edit, users.create, users.delete, users.view_all, users.manage_roles, roles.view, roles.create, roles.edit, roles.delete, roles.assign_users, roles.manage_permissions, tenants.view, tenants.create, tenants.edit, tenants.delete, tenants.initialize, tenants.view_all, tenants.manage_settings, reports.view, reports.create, reports.export, reports.schedule, permissions.view, permissions.create, permissions.edit, permissions.delete, permissions.manage] {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF]    - Active UserRoles: 1 {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF]    - Permissions: 28 [users.view, users.edit, users.create, users.delete, users.view_all, users.manage_roles, roles.view, roles.create, roles.edit, roles.delete, roles.assign_users, roles.manage_permissions, tenants.view, tenants.create, tenants.edit, tenants.delete, tenants.initialize, tenants.view_all, tenants.manage_settings, reports.view, reports.create, reports.export, reports.schedule, permissions.view, permissions.create, permissions.edit, permissions.delete, permissions.manage] {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF]    - Tenant: Test Tenant 1 {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF]    - Tenant: Test Tenant 1 {"SourceContext": "UserService.IntegrationTests.TestBase"}
?? MOCKING two-phase flow for admin@tenant1.com  Tenant 1
? Phase 1 simulated: User admin@tenant1.com authenticated (mocked)
? Phase 2 simulated: Tenant access verified for tenant 1
?? MOCKING two-phase flow for admin@tenant1.com  Tenant 1
? Phase 1 simulated: User admin@tenant1.com authenticated (mocked)
? Phase 2 simulated: Tenant access verified for tenant 1
?? MOCKING two-phase flow for admin@tenant2.com  Tenant 1
? Phase 1 simulated: User admin@tenant2.com authenticated (mocked)
?? MOCKING two-phase flow for admin@tenant2.com  Tenant 1
? Phase 1 simulated: User admin@tenant2.com authenticated (mocked)
[xUnit.net 00:00:01.35]     UserService.IntegrationTests.Controllers.UsersControllerTests.GetUser_CrossTenantAccess_ReturnsNotFound [FAIL]
[xUnit.net 00:00:01.35]       System.UnauthorizedAccessException : User admin@tenant2.com does not have access to tenant 1
[xUnit.net 00:00:01.35]       Stack Trace:
[xUnit.net 00:00:01.35]         C:\Users\mccre\dev\boiler\tests\integration\UserService.IntegrationTests\TestUtilities\AuthenticationHelper.cs(92,0): at UserService.IntegrationTests.TestUtilities.AuthenticationHelper.GetTenantTokenViaTwoPhaseFlow(HttpClient client, ApplicationDbContext dbContext, String email, Int32 preferredTenantId)
[xUnit.net 00:00:01.35]         C:\Users\mccre\dev\boiler\tests\integration\UserService.IntegrationTests\TestUtilities\AuthenticationHelper.cs(337,0): at UserService.IntegrationTests.TestUtilities.AuthenticationHelper.GetTenantAwareJwtAsync(HttpClient client, ApplicationDbContext dbContext, String email, Nullable`1 preferredTenantId)
[xUnit.net 00:00:01.35]         C:\Users\mccre\dev\boiler\tests\integration\UserService.IntegrationTests\TestBase.cs(137,0): at UserService.IntegrationTests.TestBase.GetAuthTokenAsync(String email, Nullable`1 tenantId)
[xUnit.net 00:00:01.35]         C:\Users\mccre\dev\boiler\tests\integration\UserService.IntegrationTests\Controllers\UsersControllerTests.cs(382,0): at UserService.IntegrationTests.Controllers.UsersControllerTests.GetUser_CrossTenantAccess_ReturnsNotFound()
?? Ensuring clean database state...
[xUnit.net 00:00:01.35]         --- End of stack trace from previous location ---
? Database recreated with clean state
?? TestDataSeeder: Starting test data seeding
?? Creating tenants...
[xUnit.net 00:00:01.35]     UserService.IntegrationTests.Controllers.RolesControllerTests.GetRoleUsers_CrossTenantAttempt_ReturnsNotFound [FAIL]
[xUnit.net 00:00:01.35]       System.UnauthorizedAccessException : User admin@tenant2.com does not have access to tenant 1
[xUnit.net 00:00:01.35]       Stack Trace:
[xUnit.net 00:00:01.35]         C:\Users\mccre\dev\boiler\tests\integration\UserService.IntegrationTests\TestUtilities\AuthenticationHelper.cs(92,0): at UserService.IntegrationTests.TestUtilities.AuthenticationHelper.GetTenantTokenViaTwoPhaseFlow(HttpClient client, ApplicationDbContext dbContext, String email, Int32 preferredTenantId)
[xUnit.net 00:00:01.35]         C:\Users\mccre\dev\boiler\tests\integration\UserService.IntegrationTests\TestUtilities\AuthenticationHelper.cs(337,0): at UserService.IntegrationTests.TestUtilities.AuthenticationHelper.GetTenantAwareJwtAsync(HttpClient client, ApplicationDbContext dbContext, String email, Nullable`1 preferredTenantId)
[xUnit.net 00:00:01.35]         C:\Users\mccre\dev\boiler\tests\integration\UserService.IntegrationTests\TestBase.cs(137,0): at UserService.IntegrationTests.TestBase.GetAuthTokenAsync(String email, Nullable`1 tenantId)
[xUnit.net 00:00:01.35]         C:\Users\mccre\dev\boiler\tests\integration\UserService.IntegrationTests\Controllers\RolesControllerTests.cs(403,0): at UserService.IntegrationTests.Controllers.RolesControllerTests.GetRoleUsers_CrossTenantAttempt_ReturnsNotFound()
[xUnit.net 00:00:01.35]         --- End of stack trace from previous location ---
? Created 2 tenants
?? Creating permissions...
?? Creating 38 permissions from actual business requirements
   - billing.manage (Billing)
   - billing.process_payments (Billing)
   - billing.view (Billing)
   - billing.view_invoices (Billing)
   - permissions.create (Permissions)
   - permissions.delete (Permissions)
   - permissions.edit (Permissions)
   - permissions.manage (Permissions)
   - permissions.view (Permissions)
   - reports.create (Reports)
   - reports.export (Reports)
   - reports.schedule (Reports)
   - reports.view (Reports)
   - roles.assign_users (Roles)
   - roles.create (Roles)
   - roles.delete (Roles)
   - roles.edit (Roles)
   - roles.manage_permissions (Roles)
   - roles.view (Roles)
   - system.manage (System)
   - system.manage_backups (System)
   - system.manage_settings (System)
   - system.monitor (System)
   - system.view_logs (System)
   - system.view_metrics (System)
   - tenants.create (Tenants)
   - tenants.delete (Tenants)
   - tenants.edit (Tenants)
   - tenants.initialize (Tenants)
   - tenants.manage_settings (Tenants)
   - tenants.view (Tenants)
   - tenants.view_all (Tenants)
   - users.create (Users)
   - users.delete (Users)
   - users.edit (Users)
   - users.manage_roles (Users)
   - users.view (Users)
   - users.view_all (Users)
? Created 38 permissions
?? Creating roles...
?? CreateRoles DEBUG:
   - tenant1.Id = 1
   - tenant2.Id = 2
?? Roles to be created (8):
   1. SuperAdmin (TenantId: )
   2. Admin (TenantId: 1)
   3. User (TenantId: 1)
   4. Manager (TenantId: 1)
   5. Viewer (TenantId: 1)
   6. Editor (TenantId: 1)
   7. Admin (TenantId: 2)
   8. User (TenantId: 2)
? Created 8 roles
?? Verification - Created roles:
   - ID=8, Name='User', TenantId=2
   - ID=7, Name='Admin', TenantId=2
   - ID=6, Name='Editor', TenantId=1
   - ID=5, Name='Viewer', TenantId=1
   - ID=4, Name='Manager', TenantId=1
   - ID=3, Name='User', TenantId=1
   - ID=2, Name='Admin', TenantId=1
   - ID=1, Name='SuperAdmin', TenantId=
? Successfully created all 8 roles including 2 Tenant 2 roles
?? Creating role permissions...
?? Found 38 permissions and 8 roles
?? ALL LOADED ROLES:
   - ID=8, Name='User', TenantId=2
   - ID=7, Name='Admin', TenantId=2
   - ID=6, Name='Editor', TenantId=1
   - ID=5, Name='Viewer', TenantId=1
   - ID=4, Name='Manager', TenantId=1
   - ID=3, Name='User', TenantId=1
   - ID=2, Name='Admin', TenantId=1
   - ID=1, Name='SuperAdmin', TenantId=
? Assigned 38 permissions to SuperAdmin
? Assigned 28 permissions to Tenant1 Admin
? Assigned 3 permissions to Tenant1 User
? Assigned 6 permissions to Tenant1 Manager
? Assigned 3 permissions to Viewer
?? TENANT 2 ADMIN DEBUG:
   - tenant2.Id = 2
   - All roles count: 8
   - Roles with TenantId = 2: 2
   - Admin roles: ID=7, TenantId=2, ID=2, TenantId=1
   - tenant2AdminRole found: True
   - tenant2AdminRole.Id = 7
?? DEBUG: Found 28 permissions for Tenant2 Admin
? Assigned 28 permissions to Tenant2 Admin (Expected: 23+)
? Assigned 3 permissions to Tenant2 User
? Created 109 role permissions using only actual business-defined permissions
?? Creating users...
?? Adding 7 users to main context
? All users created successfully
? Final user count: 7
? Verified required user exists: admin@tenant1.com (ID:  1)
? Verified required user exists: user@tenant1.com (ID:  2)
? Verified required user exists: admin@tenant2.com (ID:  6)
? Verified required user exists: user@tenant2.com (ID:  7)
?? All users created and verified successfully!
?? Creating user role assignments...
?? Found 7 users and 8 roles for assignment
?? Adding 8 user role assignments...
? Created 8 user role assignments
?? Creating legacy tenant users...
? Created 7 legacy tenant users
?? Verifying test data...
?? Temporarily disabling query filters for verification...
?? Final counts: Tenants=2, Users=7, Roles=8, Permissions=38, UserRoles=8, RolePermissions=109
[xUnit.net 00:00:01.37]     UserService.IntegrationTests.Controllers.TwoPhaseAuthTests.TwoPhaseFlow_ShouldSimulateCompleteAuthentication [FAIL]
? Verified user: admin@tenant1.com (ID: 1)
[xUnit.net 00:00:01.37]       Expected payload {["sub"] = 1, ["email"] = admin@tenant1.com, ["given_name"] = Admin, ["family_name"] = User1, ["jti"] = 5c192a36-f038-447c-8f0f-2e7a9be0d06c, ["iat"] = 1755974924, ["tenant_id"] = 1, ["tenant_name"] = Test Tenant 1, ["user_id"] = 1, ["role"] = ["Admin","Admin"], ["permission"] = ["users.view","users.edit","users.create","users.delete","users.view_all","users.manage_roles","roles.view","roles.create","roles.edit","roles.delete","roles.assign_users","roles.manage_permissions","tenants.view","tenants.create","tenants.edit","tenants.delete","tenants.initialize","tenants.view_all","tenants.manage_settings","reports.view","reports.create","reports.export","reports.schedule","permissions.view","permissions.create","permissions.edit","permissions.delete","permissions.manage"], ["nbf"] = 1755974924, ["exp"] = 1755978524, ["iss"] = AuthService, ["aud"] = StarterApp} to contain key "nameid" because Final token should contain user ID.
[xUnit.net 00:00:01.37]       Stack Trace:
[xUnit.net 00:00:01.37]            at FluentAssertions.Execution.XUnit2TestFramework.Throw(String message)
[xUnit.net 00:00:01.37]            at FluentAssertions.Execution.TestFrameworkProvider.Throw(String message)
? Verified user: user@tenant1.com (ID: 2)
[xUnit.net 00:00:01.37]            at FluentAssertions.Execution.DefaultAssertionStrategy.HandleFailure(String message)
[xUnit.net 00:00:01.37]            at FluentAssertions.Execution.AssertionScope.FailWith(Func`1 failReasonFunc)
[xUnit.net 00:00:01.37]            at FluentAssertions.Execution.AssertionScope.FailWith(Func`1 failReasonFunc)
[xUnit.net 00:00:01.37]            at FluentAssertions.Execution.AssertionScope.FailWith(String message, Object[] args)
[xUnit.net 00:00:01.37]            at FluentAssertions.Collections.GenericDictionaryAssertions`4.ContainKeys(IEnumerable`1 expected, String because, Object[] becauseArgs)
[xUnit.net 00:00:01.37]            at FluentAssertions.Collections.GenericDictionaryAssertions`4.ContainKey(TKey expected, String because, Object[] becauseArgs)
? Verified user: admin@tenant2.com (ID: 6)
[xUnit.net 00:00:01.37]         C:\Users\mccre\dev\boiler\tests\integration\UserService.IntegrationTests\Controllers\TwoPhaseAuthTests.cs(79,0): at UserService.IntegrationTests.Controllers.TwoPhaseAuthTests.TwoPhaseFlow_ShouldSimulateCompleteAuthentication()
[xUnit.net 00:00:01.37]         --- End of stack trace from previous location ---
?? Ensuring clean database state...
? admin@tenant1.com has 1 role assignments
? TestDataSeeder: Test data seeding completed successfully
? Database recreated with clean state
?? TestDataSeeder: Starting test data seeding
?? Creating tenants...
[13:48:44 INF] ?? Test Data Status: Tenants=2, Users=7, Roles=8, Permissions=38, UserRoles=8, RolePermissions=109 {"SourceContext": "UserService.IntegrationTests.TestBase"}
? Created 2 tenants
?? Creating permissions...
[13:48:44 INF] ?? Tenant IDs: Tenant1=1, Tenant2=2 {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF] ?? User IDs: Admin=1, User=2 {"SourceContext": "UserService.IntegrationTests.TestBase"}
?? Creating 38 permissions from actual business requirements
   - billing.manage (Billing)
   - billing.process_payments (Billing)
   - billing.view (Billing)
   - billing.view_invoices (Billing)
   - permissions.create (Permissions)
   - permissions.delete (Permissions)
   - permissions.edit (Permissions)
   - permissions.manage (Permissions)
   - permissions.view (Permissions)
   - reports.create (Reports)
   - reports.export (Reports)
   - reports.schedule (Reports)
   - reports.view (Reports)
   - roles.assign_users (Roles)
   - roles.create (Roles)
   - roles.delete (Roles)
   - roles.edit (Roles)
   - roles.manage_permissions (Roles)
   - roles.view (Roles)
   - system.manage (System)
   - system.manage_backups (System)
   - system.manage_settings (System)
   - system.monitor (System)
   - system.view_logs (System)
   - system.view_metrics (System)
   - tenants.create (Tenants)
   - tenants.delete (Tenants)
   - tenants.edit (Tenants)
   - tenants.initialize (Tenants)
   - tenants.manage_settings (Tenants)
   - tenants.view (Tenants)
   - tenants.view_all (Tenants)
   - users.create (Users)
   - users.delete (Users)
   - users.edit (Users)
   - users.manage_roles (Users)
   - users.view (Users)
   - users.view_all (Users)
[13:48:44 INF] ?? Admin user analysis: {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF]    - Email: admin@tenant1.com {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF]    - UserRoles count: 1 {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF]    - Active UserRoles: 1 {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF]    - Permissions: 28 [users.view, users.edit, users.create, users.delete, users.view_all, users.manage_roles, roles.view, roles.create, roles.edit, roles.delete, roles.assign_users, roles.manage_permissions, tenants.view, tenants.create, tenants.edit, tenants.delete, tenants.initialize, tenants.view_all, tenants.manage_settings, reports.view, reports.create, reports.export, reports.schedule, permissions.view, permissions.create, permissions.edit, permissions.delete, permissions.manage] {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF]    - Tenant: Test Tenant 1 {"SourceContext": "UserService.IntegrationTests.TestBase"}
?? MOCKING two-phase flow for user@tenant2.com  Tenant 1
? Phase 1 simulated: User user@tenant2.com authenticated (mocked)
? Created 38 permissions
?? Creating roles...
?? CreateRoles DEBUG:
   - tenant1.Id = 1
   - tenant2.Id = 2
?? Roles to be created (8):
   1. SuperAdmin (TenantId: )
   2. Admin (TenantId: 1)
   3. User (TenantId: 1)
   4. Manager (TenantId: 1)
   5. Viewer (TenantId: 1)
   6. Editor (TenantId: 1)
   7. Admin (TenantId: 2)
   8. User (TenantId: 2)
[xUnit.net 00:00:01.38]     UserService.IntegrationTests.Controllers.UsersControllerTests.GetUser_UserAccessingOtherUser_ReturnsForbidden [FAIL]
[xUnit.net 00:00:01.38]       System.UnauthorizedAccessException : User user@tenant2.com does not have access to tenant 1
[xUnit.net 00:00:01.38]       Stack Trace:
[xUnit.net 00:00:01.38]         C:\Users\mccre\dev\boiler\tests\integration\UserService.IntegrationTests\TestUtilities\AuthenticationHelper.cs(92,0): at UserService.IntegrationTests.TestUtilities.AuthenticationHelper.GetTenantTokenViaTwoPhaseFlow(HttpClient client, ApplicationDbContext dbContext, String email, Int32 preferredTenantId)
[xUnit.net 00:00:01.38]         C:\Users\mccre\dev\boiler\tests\integration\UserService.IntegrationTests\TestUtilities\AuthenticationHelper.cs(337,0): at UserService.IntegrationTests.TestUtilities.AuthenticationHelper.GetTenantAwareJwtAsync(HttpClient client, ApplicationDbContext dbContext, String email, Nullable`1 preferredTenantId)
[xUnit.net 00:00:01.38]         C:\Users\mccre\dev\boiler\tests\integration\UserService.IntegrationTests\TestBase.cs(142,0): at UserService.IntegrationTests.TestBase.GetUserTokenAsync(String email)
[xUnit.net 00:00:01.38]         C:\Users\mccre\dev\boiler\tests\integration\UserService.IntegrationTests\Controllers\UsersControllerTests.cs(269,0): at UserService.IntegrationTests.Controllers.UsersControllerTests.GetUser_UserAccessingOtherUser_ReturnsForbidden()
[xUnit.net 00:00:01.38]         --- End of stack trace from previous location ---
? Created 8 roles
?? Verification - Created roles:
   - ID=8, Name='User', TenantId=2
   - ID=7, Name='Admin', TenantId=2
   - ID=6, Name='Editor', TenantId=1
   - ID=5, Name='Viewer', TenantId=1
   - ID=4, Name='Manager', TenantId=1
   - ID=3, Name='User', TenantId=1
   - ID=2, Name='Admin', TenantId=1
   - ID=1, Name='SuperAdmin', TenantId=
? Successfully created all 8 roles including 2 Tenant 2 roles
?? Creating role permissions...
?? Found 38 permissions and 8 roles
?? ALL LOADED ROLES:
   - ID=8, Name='User', TenantId=2
   - ID=7, Name='Admin', TenantId=2
   - ID=6, Name='Editor', TenantId=1
   - ID=5, Name='Viewer', TenantId=1
   - ID=4, Name='Manager', TenantId=1
   - ID=3, Name='User', TenantId=1
   - ID=2, Name='Admin', TenantId=1
   - ID=1, Name='SuperAdmin', TenantId=
? Assigned 38 permissions to SuperAdmin
? Assigned 28 permissions to Tenant1 Admin
? Assigned 3 permissions to Tenant1 User
? Assigned 6 permissions to Tenant1 Manager
? Assigned 3 permissions to Viewer
?? TENANT 2 ADMIN DEBUG:
   - tenant2.Id = 2
   - All roles count: 8
   - Roles with TenantId = 2: 2
   - Admin roles: ID=7, TenantId=2, ID=2, TenantId=1
   - tenant2AdminRole found: True
   - tenant2AdminRole.Id = 7
?? DEBUG: Found 28 permissions for Tenant2 Admin
? Assigned 28 permissions to Tenant2 Admin (Expected: 23+)
? Assigned 3 permissions to Tenant2 User
? Created 109 role permissions using only actual business-defined permissions
?? Creating users...
?? Adding 7 users to main context
? All users created successfully
? Final user count: 7
? Verified required user exists: admin@tenant1.com (ID:  1)
? Verified required user exists: user@tenant1.com (ID:  2)
? Verified required user exists: admin@tenant2.com (ID:  6)
? Verified required user exists: user@tenant2.com (ID:  7)
?? All users created and verified successfully!
?? Creating user role assignments...
?? Found 7 users and 8 roles for assignment
?? Adding 8 user role assignments...
? Created 8 user role assignments
?? Creating legacy tenant users...
? Created 7 legacy tenant users
?? Verifying test data...
?? Temporarily disabling query filters for verification...
?? Final counts: Tenants=2, Users=7, Roles=8, Permissions=38, UserRoles=8, RolePermissions=109
? Verified user: admin@tenant1.com (ID: 1)
? Verified user: user@tenant1.com (ID: 2)
? Verified user: admin@tenant2.com (ID: 6)
? admin@tenant1.com has 1 role assignments
? TestDataSeeder: Test data seeding completed successfully
[13:48:44 INF] ?? Test Data Status: Tenants=2, Users=7, Roles=8, Permissions=38, UserRoles=8, RolePermissions=109 {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF] ?? Tenant IDs: Tenant1=1, Tenant2=2 {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF] ?? User IDs: Admin=1, User=2 {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF] ?? Admin user analysis: {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF]    - Email: admin@tenant1.com {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF]    - UserRoles count: 1 {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF]    - Active UserRoles: 1 {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF]    - Permissions: 28 [users.view, users.edit, users.create, users.delete, users.view_all, users.manage_roles, roles.view, roles.create, roles.edit, roles.delete, roles.assign_users, roles.manage_permissions, tenants.view, tenants.create, tenants.edit, tenants.delete, tenants.initialize, tenants.view_all, tenants.manage_settings, reports.view, reports.create, reports.export, reports.schedule, permissions.view, permissions.create, permissions.edit, permissions.delete, permissions.manage] {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF]    - Tenant: Test Tenant 1 {"SourceContext": "UserService.IntegrationTests.TestBase"}
?? MOCKING two-phase flow for admin@tenant1.com  Tenant 1
? Phase 1 simulated: User admin@tenant1.com authenticated (mocked)
? Phase 2 simulated: Tenant access verified for tenant 1
[xUnit.net 00:00:01.39]     UserService.IntegrationTests.Controllers.TwoPhaseAuthTests.JwtValidation_ShouldWork [FAIL]
[xUnit.net 00:00:01.39]       JWT should contain claim 'nameid'
[xUnit.net 00:00:01.39]       Stack Trace:
[xUnit.net 00:00:01.39]         C:\Users\mccre\dev\boiler\tests\integration\UserService.IntegrationTests\TestUtilities\AuthenticationHelper.cs(241,0): at UserService.IntegrationTests.TestUtilities.AuthenticationHelper.ValidateJwtClaims(String jwt, Dictionary`2 expectedClaims)
[xUnit.net 00:00:01.39]         C:\Users\mccre\dev\boiler\tests\integration\UserService.IntegrationTests\Controllers\TwoPhaseAuthTests.cs(156,0): at UserService.IntegrationTests.Controllers.TwoPhaseAuthTests.JwtValidation_ShouldWork()
[xUnit.net 00:00:01.39]         --- End of stack trace from previous location ---
=== UserService Startup Diagnostics ===
Environment: Testing
Application Name: UserService
Content Root: C:\Users\mccre\dev\boiler\src\services\UserService
Running in Container: 
[Startup] Monitoring:Enabled raw config value = 'False'
?? Registering base services...
? Base services registered
?? Configuring Swagger...
? Swagger configured
?? Registering common services...
? Common services registered
?? Configuring Redis...
?? Redis connection string resolved to: localhost:6379
?? Running in container: 
? Redis configured
?? Registering database services...
? Database services registered
?? Registering user services...
? User services registered
?? Registering Enhanced Security and Monitoring services...
? Enhanced Security and Monitoring services registered successfully
?? Registering Compliance and Alert services...
? Compliance and Alert services registered successfully
?? Registering Enhanced Health Checks...
? Enhanced Health Checks registered
?? Configuring authorization policies...
? Authorization policies configured
?? Configuring CORS...
? CORS configured
?? Registering additional services...
? Additional services registered
??? Building application...
? Application built successfully
?? Configuring middleware pipeline...
?? Configuring Enhanced Security middleware...
[13:48:44 INF] Configuring Enhanced Security middleware {}
[13:48:44 INF] ?? Enhanced security middleware DISABLED in testing environment {"SourceContext": "SecurityExtensions"}
? Enhanced Security middleware configured successfully
[13:48:44 INF] Enhanced Security middleware configured successfully {}
? Middleware pipeline configured
?? Mapping Enhanced Health Check endpoints...
? Enhanced Health Check endpoints mapped
[13:48:44 INF] Starting UserService with Phase 11 Enhanced Security & Monitoring {}
=== UserService Starting with Phase 11 Enhanced Security & Monitoring ===
?? Testing Redis connection...
[13:48:44 INF] Redis connection status: Connected {}
? Redis connection successful: 8/23/2025 6:48:44 PM
[13:48:44 INF] Redis connection test successful: 8/23/2025 6:48:44 PM {}
?? Seeding database...
? Database seeded
?? Seeding monitoring user...
[13:48:44 INF] Monitoring.Enabled = 'false' (evaluated false); skipping seeding. {"SourceContext": "MonitoringUserSeeder"}
? Monitoring user seeded (monitor@local / ChangeMe123!)
?? Starting application...
?? Enhanced Health Check endpoints available:
  - GET /health (comprehensive overview)
  - GET /health/critical (database + Redis status)
  - GET /health/enhanced (Phase 11 enhanced monitoring)
  - GET /health/performance (cache and performance metrics)
  - GET /health/system (overall system health score)
  - GET /health/ready (Kubernetes readiness)
  - GET /health/live (Kubernetes liveness)
?? Enhanced Security & Monitoring features:
  - Rate limiting with tenant awareness
  - Security event detection and logging
  - Performance metrics collection with Redis storage
  - Enhanced audit trail for all actions
  - Comprehensive health monitoring with performance scoring
  - Real-time system metrics and alerts
[13:48:44 INF] Enhanced Security & Monitoring (Phase 11) configured and operational {}
?? Ensuring clean database state...
? Database recreated with clean state
?? TestDataSeeder: Starting test data seeding
?? Creating tenants...
? Created 2 tenants
?? Creating permissions...
?? Creating 38 permissions from actual business requirements
   - billing.manage (Billing)
   - billing.process_payments (Billing)
   - billing.view (Billing)
   - billing.view_invoices (Billing)
   - permissions.create (Permissions)
   - permissions.delete (Permissions)
   - permissions.edit (Permissions)
   - permissions.manage (Permissions)
   - permissions.view (Permissions)
   - reports.create (Reports)
   - reports.export (Reports)
   - reports.schedule (Reports)
   - reports.view (Reports)
   - roles.assign_users (Roles)
   - roles.create (Roles)
   - roles.delete (Roles)
   - roles.edit (Roles)
   - roles.manage_permissions (Roles)
   - roles.view (Roles)
   - system.manage (System)
   - system.manage_backups (System)
   - system.manage_settings (System)
   - system.monitor (System)
   - system.view_logs (System)
   - system.view_metrics (System)
   - tenants.create (Tenants)
   - tenants.delete (Tenants)
   - tenants.edit (Tenants)
   - tenants.initialize (Tenants)
   - tenants.manage_settings (Tenants)
   - tenants.view (Tenants)
   - tenants.view_all (Tenants)
   - users.create (Users)
   - users.delete (Users)
   - users.edit (Users)
   - users.manage_roles (Users)
   - users.view (Users)
   - users.view_all (Users)
? Created 38 permissions
?? Creating roles...
?? CreateRoles DEBUG:
   - tenant1.Id = 1
   - tenant2.Id = 2
?? Roles to be created (8):
   1. SuperAdmin (TenantId: )
   2. Admin (TenantId: 1)
   3. User (TenantId: 1)
   4. Manager (TenantId: 1)
   5. Viewer (TenantId: 1)
   6. Editor (TenantId: 1)
   7. Admin (TenantId: 2)
   8. User (TenantId: 2)
? Created 8 roles
?? Verification - Created roles:
   - ID=8, Name='User', TenantId=2
   - ID=7, Name='Admin', TenantId=2
   - ID=6, Name='Editor', TenantId=1
   - ID=5, Name='Viewer', TenantId=1
   - ID=4, Name='Manager', TenantId=1
   - ID=3, Name='User', TenantId=1
   - ID=2, Name='Admin', TenantId=1
   - ID=1, Name='SuperAdmin', TenantId=
? Successfully created all 8 roles including 2 Tenant 2 roles
?? Creating role permissions...
?? Found 38 permissions and 8 roles
?? ALL LOADED ROLES:
   - ID=8, Name='User', TenantId=2
   - ID=7, Name='Admin', TenantId=2
   - ID=6, Name='Editor', TenantId=1
   - ID=5, Name='Viewer', TenantId=1
   - ID=4, Name='Manager', TenantId=1
   - ID=3, Name='User', TenantId=1
   - ID=2, Name='Admin', TenantId=1
   - ID=1, Name='SuperAdmin', TenantId=
? Assigned 38 permissions to SuperAdmin
? Assigned 28 permissions to Tenant1 Admin
? Assigned 3 permissions to Tenant1 User
? Assigned 6 permissions to Tenant1 Manager
? Assigned 3 permissions to Viewer
?? TENANT 2 ADMIN DEBUG:
   - tenant2.Id = 2
   - All roles count: 8
   - Roles with TenantId = 2: 2
   - Admin roles: ID=7, TenantId=2, ID=2, TenantId=1
   - tenant2AdminRole found: True
   - tenant2AdminRole.Id = 7
?? DEBUG: Found 28 permissions for Tenant2 Admin
? Assigned 28 permissions to Tenant2 Admin (Expected: 23+)
? Assigned 3 permissions to Tenant2 User
? Created 109 role permissions using only actual business-defined permissions
?? Creating users...
?? Adding 7 users to main context
? All users created successfully
? Final user count: 7
? Verified required user exists: admin@tenant1.com (ID:  1)
? Verified required user exists: user@tenant1.com (ID:  2)
? Verified required user exists: admin@tenant2.com (ID:  6)
? Verified required user exists: user@tenant2.com (ID:  7)
?? All users created and verified successfully!
?? Creating user role assignments...
?? Found 7 users and 8 roles for assignment
?? Adding 8 user role assignments...
? Created 8 user role assignments
?? Creating legacy tenant users...
? Created 7 legacy tenant users
?? Verifying test data...
?? Temporarily disabling query filters for verification...
?? Final counts: Tenants=2, Users=7, Roles=8, Permissions=38, UserRoles=8, RolePermissions=109
? Verified user: admin@tenant1.com (ID: 1)
? Verified user: user@tenant1.com (ID: 2)
? Verified user: admin@tenant2.com (ID: 6)
? admin@tenant1.com has 1 role assignments
? TestDataSeeder: Test data seeding completed successfully
[13:48:44 INF] ?? Test Data Status: Tenants=2, Users=7, Roles=8, Permissions=38, UserRoles=8, RolePermissions=109 {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF] ?? Tenant IDs: Tenant1=1, Tenant2=2 {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF] ?? User IDs: Admin=1, User=2 {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF] ?? Admin user analysis: {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF]    - Email: admin@tenant1.com {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF]    - UserRoles count: 1 {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF]    - Active UserRoles: 1 {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF]    - Permissions: 28 [users.view, users.edit, users.create, users.delete, users.view_all, users.manage_roles, roles.view, roles.create, roles.edit, roles.delete, roles.assign_users, roles.manage_permissions, tenants.view, tenants.create, tenants.edit, tenants.delete, tenants.initialize, tenants.view_all, tenants.manage_settings, reports.view, reports.create, reports.export, reports.schedule, permissions.view, permissions.create, permissions.edit, permissions.delete, permissions.manage] {"SourceContext": "UserService.IntegrationTests.TestBase"}
[13:48:44 INF]    - Tenant: Test Tenant 1 {"SourceContext": "UserService.IntegrationTests.TestBase"}
[xUnit.net 00:00:01.47]     UserService.IntegrationTests.Infrastructure.TestSetupVerificationTests.TestSetup_ShouldCreateAllRequiredTestData [FAIL]
[xUnit.net 00:00:01.48]       Expected permissions to contain 36 item(s), but found 38: 
[xUnit.net 00:00:01.48]       DTOs.Entities.Permission
[xUnit.net 00:00:01.48]           {
[xUnit.net 00:00:01.48]               Category = "Billing", 
[xUnit.net 00:00:01.48]               CreatedAt = <2025-08-23 18:48:44.4441593>, 
[xUnit.net 00:00:01.48]               Description = "Process payments billing", 
[xUnit.net 00:00:01.48]               Id = 2, 
[xUnit.net 00:00:01.48]               IsActive = True, 
[xUnit.net 00:00:01.48]               Name = "billing.process_payments", 
[xUnit.net 00:00:01.48]               {
[xUnit.net 00:00:01.48]               RolePermissions = DTOs.Entities.RolePermission
[xUnit.net 00:00:01.48]                   {
[xUnit.net 00:00:01.48]                       CreatedAt = <2025-08-23 18:48:44.4477772>, 
[xUnit.net 00:00:01.48]                       GrantedAt = <2025-08-23 18:48:44.4457222>, 
[xUnit.net 00:00:01.48]                       GrantedBy = "System", 
[xUnit.net 00:00:01.48]                       Id = 1, 
[xUnit.net 00:00:01.48]                       Permission = {Cyclic reference to type DTOs.Entities.Permission detected}, 
[xUnit.net 00:00:01.48]                       PermissionId = 2, 
[xUnit.net 00:00:01.48]                       Role = DTOs.Entities.Role
[xUnit.net 00:00:01.48]                       {
[xUnit.net 00:00:01.48]                           CreatedAt = <2025-08-23 18:48:44.445140>, 
[xUnit.net 00:00:01.48]                           Description = "System super admin", 
[xUnit.net 00:00:01.48]                           Id = 1, 
[xUnit.net 00:00:01.48]                           IsActive = True, 
[xUnit.net 00:00:01.48]                           IsDefault = False, 
[xUnit.net 00:00:01.48]                           IsSystemRole = True, 
[xUnit.net 00:00:01.48]                           Name = "SuperAdmin", 
[xUnit.net 00:00:01.48]                           {
[xUnit.net 00:00:01.48]                           RolePermissions = {Cyclic reference to type DTOs.Entities.RolePermission detected}, 
[xUnit.net 00:00:01.48]                           Maximum recursion depth of 5 was reached.  Increase MaxDepth on AssertionScope or AssertionOptions to get more details.
[xUnit.net 00:00:01.48]       , 
[xUnit.net 00:00:01.48]                                                   Maximum recursion depth of 5 was reached.  Increase MaxDepth on AssertionScope or AssertionOptions to get more details.
[xUnit.net 00:00:01.48]       , 
[xUnit.net 00:00:01.48]                                                   Maximum recursion depth of 5 was reached.  Increase MaxDepth on AssertionScope or AssertionOptions to get more details.
[xUnit.net 00:00:01.48]       , 
[xUnit.net 00:00:01.48]                                                   Maximum recursion depth of 5 was reached.  Increase MaxDepth on AssertionScope or AssertionOptions to get more details.
[xUnit.net 00:00:01.48]       , 
[xUnit.net 00:00:01.48]                                                   Maximum recursion depth of 5 was reached.  Increase MaxDepth on AssertionScope or AssertionOptions to get more details.
[xUnit.net 00:00:01.48]       , 
[xUnit.net 00:00:01.48]                                                   Maximum recursion depth of 5 was reached.  Increase MaxDepth on AssertionScope or AssertionOptions to get more details.
[xUnit.net 00:00:01.48]       , 
[xUnit.net 00:00:01.48]                                                   Maximum recursion depth of 5 was reached.  Increase MaxDepth on AssertionScope or AssertionOptions to get more details.
[xUnit.net 00:00:01.48]       , 
[xUnit.net 00:00:01.48]                                                   Maximum recursion depth of 5 was reached.  Increase MaxDepth on AssertionScope or AssertionOptions to get more details.
[xUnit.net 00:00:01.48]       , 
[xUnit.net 00:00:01.48]                                                   Maximum recursion depth of 5 was reached.  Increase MaxDepth on AssertionScope or AssertionOptions to get more details.
[xUnit.net 00:00:01.48]       , 
[xUnit.net 00:00:01.48]                                                   Maximum recursion depth of 5 was reached.  Increase MaxDepth on AssertionScope or AssertionOptions to get more details.
[xUnit.net 00:00:01.48]       , 
[xUnit.net 00:00:01.48]                                                   Maximum recursion depth of 5 was reached.  Increase MaxDepth on AssertionScope or AssertionOptions to get more details.
[xUnit.net 00:00:01.48]       , 
[xUnit.net 00:00:01.48]                                                   Maximum recursion depth of 5 was reached.  Increase MaxDepth on AssertionScope or AssertionOptions to get more details.
[xUnit.net 00:00:01.48]       , 
[xUnit.net 00:00:01.48]                                                   Maximum recursion depth of 5 was reached.  Increase MaxDepth on AssertionScope or AssertionOptions to get more details.
[xUnit.net 00:00:01.48]       , 
[xUnit.net 00:00:01.48]                                                   Maximum recursion depth of 5 was reached.  Increase MaxDepth on AssertionScope or AssertionOptions to get more details.
[xUnit.net 00:00:01.48]       , 
[xUnit.net 00:00:01.48]                                                   Maximum recursion depth of 5 was reached.  Increase MaxDepth on AssertionScope or AssertionOptions to get more details.
[xUnit.net 00:00:01.48]       , 
[xUnit.net 00:00:01.48]                                                   Maximum recursion depth of 5 was reached.  Increase MaxDepth on AssertionScope or AssertionOptions to get more details.
[xUnit.net 00:00:01.48]       , 
[xUnit.net 00:00:01.48]                                                   Maximum recursion depth of 5 was reached.  Increase MaxDepth on AssertionScope or AssertionOptions to get more details.
[xUnit.net 00:00:01.48]       , 
[xUnit.net 00:00:01.48]                                                   Maximum recursion depth of 5 was reached.  Increase MaxDepth on AssertionScope or AssertionOptions to get more details.
[xUnit.net 00:00:01.48]       , 
[xUnit.net 00:00:01.48]                                                   Maximum recursion depth of 5 was reached.  Increase MaxDepth on AssertionScope or AssertionOptions to get more details.
[xUnit.net 00:00:01.48]       , 
[xUnit.net 00:00:01.48]                                                   Maximum recursion depth of 5 was reached.  Increase MaxDepth on AssertionScope or AssertionOptions to get more details.
[xUnit.net 00:00:01.48]       , 
[xUnit.net 00:00:01.48]                                                   Maximum recursion depth of 5 was reached.  Increase MaxDepth on AssertionScope or AssertionOptions to get more details.
[xUnit.net 00:00:01.48]       , 
[xUnit.net 00:00:01.48]                                                   Maximum recursion depth of 5 was reached.  Increase MaxDepth on AssertionScope or AssertionOptions to get more details.
[xUnit.net 00:00:01.48]       , 
[xUnit.net 00:00:01.48]                                                   Maximum recursion depth of 5 was reached.  Increase MaxDepth on AssertionScope or AssertionOptions to get more details.
[xUnit.net 00:00:01.48]       , 
[xUnit.net 00:00:01.48]                                                   Maximum recursion depth of 5 was reached.  Increase MaxDepth on AssertionScope or AssertionOptions to get more details.
[xUnit.net 00:00:01.48]       , 
[xUnit.net 00:00:01.48]                                                   Maximum recursion depth of 5 was reached.  Increase MaxDepth on AssertionScope or AssertionOptions to get more details.
[xUnit.net 00:00:01.48]       , 
[xUnit.net 00:00:01.48]                                                   Maximum recursion depth of 5 was reached.  Increase MaxDepth on AssertionScope or AssertionOptions to get more details.
[xUnit.net 00:00:01.48]       , 
[xUnit.net 00:00:01.48]                                                   Maximum recursion depth of 5 was reached.  Increase MaxDepth on AssertionScope or AssertionOptions to get more details.
[xUnit.net 00:00:01.48]       , 
[xUnit.net 00:00:01.48]                                                   Maximum recursion depth of 5 was reached.  Increase MaxDepth on AssertionScope or AssertionOptions to get more details.
[xUnit.net 00:00:01.48]       , 
[xUnit.net 00:00:01.48]                                                   Maximum recursion depth of 5 was reached.  Increase MaxDepth on AssertionScope or AssertionOptions to get more details.
[xUnit.net 00:00:01.48]       , 
[xUnit.net 00:00:01.48]                                                   Maximum recursion depth of 5 was reached.  Increase MaxDepth on AssertionScope or AssertionOptions to get more details.
[xUnit.net 00:00:01.48]       , 
[xUnit.net 00:00:01.48]                                                   Maximum recursion depth of 5 was reached.  Increase MaxDepth on AssertionScope or AssertionOptions to get more details.
[xUnit.net 00:00:01.48]                           ,                     …6 more…
[xUnit.net 00:00:01.48]                           }, 
[xUnit.net 00:00:01.48]                           Tenant = <null>, 
[xUnit.net 00:00:01.48]                           TenantId = <null>, 
[xUnit.net 00:00:01.48]                           UpdatedAt = <2025-08-23 18:48:44.445140>, 
[xUnit.net 00:00:01.48]                           UserRoles = {empty}
[xUnit.net 00:00:01.48]                       }, 
[xUnit.net 00:00:01.48]                       RoleId = 1, 
[xUnit.net 00:00:01.48]                       UpdatedAt = <2025-08-23 18:48:44.4477772>
[xUnit.net 00:00:01.48]                   }
[xUnit.net 00:00:01.48]               }, 
[xUnit.net 00:00:01.48]               UpdatedAt = <2025-08-23 18:48:44.4441593>
[xUnit.net 00:00:01.48]           }DTOs.Entities.Permission
[xUnit.net 00:00:01.48]           {
[xUnit.net 00:00:01.48]               Category = "Billing", 
[xUnit.net 00:00:01.48]               CreatedAt = <2025-08-23 18:48:44.4441593>, 
[xUnit.net 00:00:01.48]               Description = "Manage billing", 
[xUnit.net 00:00:01.48]               Id = 1, 
[xUnit.net 00:00:01.48]               IsActive = True, 
[xUnit.net 00:00:01.48]               Name = "billing.manage", 
[xUnit.net 00:00:01.48]               RolePermissions = DTOs.Entities.RolePermission
[xUnit.net 00:00:01.48]                   {
[xUnit.net 00:00:01.48]                       CreatedAt = <2025-08-23 18:48:44.4477772>, 
[xUnit.net 00:00:01.48]                       GrantedAt = <2025-08-23 18:48:44.4457228>, 
[xUnit.net 00:00:01.48]                       GrantedBy = "System", 
[xUnit.net 00:00:01.48]                       Id = 2, 
[xUnit.net 00:00:01.48]                       Permission = {Cyclic reference to type DTOs.Entities.Permission detected}, 
[xUnit.net 00:00:01.48]                       PermissionId = 1, 
[xUnit.net 00:00:01.48]                       Role = DTOs.Entities.Role
[xUnit.net 00:00:01.48]                       {
[xUnit.net 00:00:01.48]                           CreatedAt = <2025-08-23 18:48:44.445140>, 
[xUnit.net 00:00:01.48]                           Description = "System super admin", 
[xUnit.net 00:00:01.48]                           Id = 1, 
[xUnit.net 00:00:01.48]                           IsActive = True, 
[xUnit.net 00:00:01.48]                           IsDefault = False, 
[xUnit.net 00:00:01.48]                           IsSystemRole = True, 
[xUnit.net 00:00:01.48]                           Name = "SuperAdmin", 
[xUnit.net 00:00:01.48]                           RolePermissions = 
[xUnit.net 00:00:01.48]                           Maximum recursion depth of 5 was reached.  Increase MaxDepth on AssertionScope or AssertionOptions to get more details.
[xUnit.net 00:00:01.48]       ,                     {Cyclic reference to type DTOs.Entities.RolePermission detected}
[xUnit.net 00:00:01.48]       
[xUnit.net 00:00:01.48]       (Output has exceeded the maximum of 100 lines. Increase FormattingOptions.MaxLines on AssertionScope or AssertionOptions to include more lines.)
[xUnit.net 00:00:01.48]       .
[xUnit.net 00:00:01.48]       Stack Trace:
[xUnit.net 00:00:01.48]            at FluentAssertions.Execution.XUnit2TestFramework.Throw(String message)
[xUnit.net 00:00:01.48]            at FluentAssertions.Execution.TestFrameworkProvider.Throw(String message)
[xUnit.net 00:00:01.48]            at FluentAssertions.Execution.DefaultAssertionStrategy.HandleFailure(String message)
[xUnit.net 00:00:01.48]            at FluentAssertions.Execution.AssertionScope.FailWith(Func`1 failReasonFunc)
[xUnit.net 00:00:01.48]            at FluentAssertions.Execution.AssertionScope.FailWith(Func`1 failReasonFunc)
[xUnit.net 00:00:01.48]            at FluentAssertions.Execution.AssertionScope.FailWith(String message, Object[] args)
[xUnit.net 00:00:01.48]            at FluentAssertions.Collections.GenericCollectionAssertions`3.HaveCount(Int32 expected, String because, Object[] becauseArgs)
[xUnit.net 00:00:01.48]         C:\Users\mccre\dev\boiler\tests\integration\UserService.IntegrationTests\Infrastructure\TestSetupVerificationTests.cs(37,0): at UserService.IntegrationTests.Infrastructure.TestSetupVerificationTests.TestSetup_ShouldCreateAllRequiredTestData()
[xUnit.net 00:00:01.48]         --- End of stack trace from previous location ---
=== UserService Startup Diagnostics ===
Environment: Testing
Application Name: UserService
Content Root: C:\Users\mccre\dev\boiler\src\services\UserService
Running in Container: 
[Startup] Monitoring:Enabled raw config value = 'False'
?? Registering base services...
? Base services registered
?? Configuring Swagger...
? Swagger configured
?? Registering common services...
? Common services registered
?? Configuring Redis...
?? Redis connection string resolved to: localhost:6379
?? Running in container: 
? Redis configured
?? Registering database services...
? Database services registered
?? Registering user services...
? User services registered
?? Registering Enhanced Security and Monitoring services...
? Enhanced Security and Monitoring services registered successfully
?? Registering Compliance and Alert services...
? Compliance and Alert services registered successfully
?? Registering Enhanced Health Checks...
? Enhanced Health Checks registered
?? Configuring authorization policies...
? Authorization policies configured
?? Configuring CORS...
? CORS configured
?? Registering additional services...
? Additional services registered
??? Building application...
? Application built successfully
?? Configuring middleware pipeline...
?? Configuring Enhanced Security middleware...
[13:48:44 INF] Configuring Enhanced Security middleware {}
[13:48:44 INF] ?? Enhanced security middleware DISABLED in testing environment {"SourceContext": "SecurityExtensions"}
? Enhanced Security middleware configured successfully
[13:48:44 INF] Enhanced Security middleware configured successfully {}
? Middleware pipeline configured
?? Mapping Enhanced Health Check endpoints...
? Enhanced Health Check endpoints mapped
[13:48:44 INF] Starting UserService with Phase 11 Enhanced Security & Monitoring {}
=== UserService Starting with Phase 11 Enhanced Security & Monitoring ===
?? Testing Redis connection...
[13:48:44 INF] Redis connection status: Connected {}
? Redis connection successful: 8/23/2025 6:48:44 PM
[13:48:44 INF] Redis connection test successful: 8/23/2025 6:48:44 PM {}
?? Seeding database...
? Database seeded
?? Seeding monitoring user...
[13:48:44 INF] Monitoring.Enabled = 'false' (evaluated false); skipping seeding. {"SourceContext": "MonitoringUserSeeder"}
? Monitoring user seeded (monitor@local / ChangeMe123!)
?? Starting application...
?? Enhanced Health Check endpoints available:
  - GET /health (comprehensive overview)
  - GET /health/critical (database + Redis status)
  - GET /health/enhanced (Phase 11 enhanced monitoring)
  - GET /health/performance (cache and performance metrics)
  - GET /health/system (overall system health score)
  - GET /health/ready (Kubernetes readiness)
  - GET /health/live (Kubernetes liveness)
?? Enhanced Security & Monitoring features:
  - Rate limiting with tenant awareness
  - Security event detection and logging
  - Performance metrics collection with Redis storage
  - Enhanced audit trail for all actions
  - Comprehensive health monitoring with performance scoring
  - Real-time system metrics and alerts
[13:48:44 INF] Enhanced Security & Monitoring (Phase 11) configured and operational {}
[xUnit.net 00:00:01.52]   Finished:    UserService.IntegrationTests
[xUnit.net 00:00:00.00] xUnit.net VSTest Adapter v2.5.3.1+6b60a9e56a (64-bit .NET 9.0.7)
[xUnit.net 00:00:00.04]   Starting:    UserService.PerformanceTests
=== UserService Startup Diagnostics ===
Environment: Performance
Application Name: UserService
Content Root: C:\Users\mccre\dev\boiler\src\services\UserService
Running in Container: 
[Startup] Monitoring:Enabled raw config value = 'False'
?? Registering base services...
? Base services registered
?? Configuring Swagger...
? Swagger configured
?? Registering common services...
? Common services registered
?? Configuring Redis...
?? Redis connection string resolved to: 
?? Running in container: 
? Redis configured
?? Registering database services...
? Database services registered
?? Registering user services...
? User services registered
?? Registering Enhanced Security and Monitoring services...
? Enhanced Security and Monitoring services registered successfully
?? Registering Compliance and Alert services...
? Compliance and Alert services registered successfully
?? Registering Enhanced Health Checks...
? Enhanced Health Checks registered
?? Configuring authorization policies...
? Authorization policies configured
?? Configuring CORS...
? CORS configured
?? Registering additional services...
? Additional services registered
??? Building application...
? Application built successfully
?? Configuring middleware pipeline...
?? Configuring Enhanced Security middleware...
[13:48:44 INF] Configuring Enhanced Security middleware {}
[13:48:45 INF] ?? Enhanced security middleware DISABLED via configuration {"SourceContext": "SecurityExtensions"}
? Enhanced Security middleware configured successfully
[13:48:45 INF] Enhanced Security middleware configured successfully {}
? Middleware pipeline configured
?? Mapping Enhanced Health Check endpoints...
? Enhanced Health Check endpoints mapped
[13:48:45 INF] Starting UserService with Phase 11 Enhanced Security & Monitoring {}
=== UserService Starting with Phase 11 Enhanced Security & Monitoring ===
?? Testing Redis connection...
??  Redis connection test error: No service for type 'StackExchange.Redis.IConnectionMultiplexer' has been registered.
[13:48:45 WRN] Redis connection test failed with unexpected error {}
System.InvalidOperationException: No service for type 'StackExchange.Redis.IConnectionMultiplexer' has been registered.
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at Program.<Main>$(String[] args) in C:\Users\mccre\dev\boiler\src\services\UserService\Program.cs:line 557
?? Seeding database...
? Database seeded
?? Seeding monitoring user...
[13:48:45 INF] Monitoring.Enabled = 'False' (evaluated false); skipping seeding. {"SourceContext": "MonitoringUserSeeder"}
? Monitoring user seeded (monitor@local / ChangeMe123!)
?? Starting application...
?? Enhanced Health Check endpoints available:
  - GET /health (comprehensive overview)
  - GET /health/critical (database + Redis status)
  - GET /health/enhanced (Phase 11 enhanced monitoring)
  - GET /health/performance (cache and performance metrics)
  - GET /health/system (overall system health score)
  - GET /health/ready (Kubernetes readiness)
  - GET /health/live (Kubernetes liveness)
?? Enhanced Security & Monitoring features:
  - Rate limiting with tenant awareness
  - Security event detection and logging
  - Performance metrics collection with Redis storage
  - Enhanced audit trail for all actions
  - Comprehensive health monitoring with performance scoring
  - Real-time system metrics and alerts
[13:48:45 INF] Enhanced Security & Monitoring (Phase 11) configured and operational {}
[13:48:45 INF] ?? Starting minimal performance data seeding... {"SourceContext": "UserService.PerformanceTests.BasicPerformanceTests"}
[13:48:45 INF] ? Minimal performance data seeding completed {"SourceContext": "UserService.PerformanceTests.BasicPerformanceTests"}
[13:48:46 WRN] Failed to determine the https port for redirect. {"EventId": {"Id": 3, "Name": "FailedToDeterminePort"}, "SourceContext": "Microsoft.AspNetCore.HttpsPolicy.HttpsRedirectionMiddleware", "RequestId": "0HNF2EMOB0TES", "RequestPath": "/api/roles"}
[13:48:46 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TES", "RequestPath": "/api/roles"}
[13:48:46 INF] HTTP GET /api/roles responded 404 in 83.3375 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[xUnit.net 00:00:01.38]     UserService.PerformanceTests.BasicPerformanceTests.RoleOperations_ShouldMeetPerformanceTarget [FAIL]
[xUnit.net 00:00:01.38]       Expected warmupResponse.IsSuccessStatusCode to be true because Warm-up request should succeed, but found False.
[xUnit.net 00:00:01.38]       Stack Trace:
[13:48:46 INF] ?? Starting minimal performance data seeding... {"SourceContext": "UserService.PerformanceTests.BasicPerformanceTests"}
[xUnit.net 00:00:01.38]            at FluentAssertions.Execution.XUnit2TestFramework.Throw(String message)
[xUnit.net 00:00:01.38]            at FluentAssertions.Execution.TestFrameworkProvider.Throw(String message)
[xUnit.net 00:00:01.38]            at FluentAssertions.Execution.DefaultAssertionStrategy.HandleFailure(String message)
[xUnit.net 00:00:01.38]            at FluentAssertions.Execution.AssertionScope.FailWith(Func`1 failReasonFunc)
[xUnit.net 00:00:01.38]            at FluentAssertions.Execution.AssertionScope.FailWith(Func`1 failReasonFunc)
[xUnit.net 00:00:01.38]            at FluentAssertions.Execution.AssertionScope.FailWith(String message, Object[] args)
[xUnit.net 00:00:01.38]            at FluentAssertions.Primitives.BooleanAssertions`1.BeTrue(String because, Object[] becauseArgs)
[xUnit.net 00:00:01.38]         C:\Users\mccre\dev\boiler\tests\performance\UserService.PerformanceTests\BasicPerformanceTests.cs(184,0): at UserService.PerformanceTests.BasicPerformanceTests.RoleOperations_ShouldMeetPerformanceTarget()
[xUnit.net 00:00:01.38]         --- End of stack trace from previous location ---
[xUnit.net 00:00:01.38]       Output:
[xUnit.net 00:00:01.38]         🔥 Warming up database...
[13:48:46 INF] ? Minimal performance data seeding completed {"SourceContext": "UserService.PerformanceTests.BasicPerformanceTests"}
[13:48:46 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TET", "RequestPath": "/api/users"}
[13:48:46 INF] HTTP GET /api/users responded 404 in 160.5809 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:46 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TEV", "RequestPath": "/api/users"}
[13:48:46 INF] HTTP GET /api/users responded 404 in 163.9240 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:46 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TEU", "RequestPath": "/api/users"}
[13:48:46 INF] HTTP GET /api/users responded 404 in 166.7475 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:46 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TF0", "RequestPath": "/api/users"}
[13:48:46 INF] HTTP GET /api/users responded 404 in 174.8462 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:46 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TF2", "RequestPath": "/api/users"}
[13:48:46 INF] HTTP GET /api/users responded 404 in 177.8089 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:46 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TF1", "RequestPath": "/api/users"}
[13:48:46 INF] HTTP GET /api/users responded 404 in 180.8474 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[xUnit.net 00:00:01.84]     UserService.PerformanceTests.BasicPerformanceTests.MultiTenantIsolation_ShouldMaintainPerformance [FAIL]
[xUnit.net 00:00:01.84]       Expected results to contain only items satisfying the inspector:
[xUnit.net 00:00:01.84]       	At index 0:
[xUnit.net 00:00:01.84]       		Expected result to be true because All requests should complete successfully, but found False
[xUnit.net 00:00:01.84]       	At index 1:
[xUnit.net 00:00:01.84]       		Expected result to be true because All requests should complete successfully, but found False
[xUnit.net 00:00:01.84]       	At index 2:
[xUnit.net 00:00:01.84]       		Expected result to be true because All requests should complete successfully, but found False
[xUnit.net 00:00:01.84]       	At index 3:
[xUnit.net 00:00:01.84]       		Expected result to be true because All requests should complete successfully, but found False
[xUnit.net 00:00:01.84]       	At index 4:
[xUnit.net 00:00:01.84]       		Expected result to be true because All requests should complete successfully, but found False
[xUnit.net 00:00:01.84]       	At index 5:
[xUnit.net 00:00:01.84]       		Expected result to be true because All requests should complete successfully, but found False
[xUnit.net 00:00:01.84]       Stack Trace:
[xUnit.net 00:00:01.84]            at FluentAssertions.Execution.XUnit2TestFramework.Throw(String message)
[xUnit.net 00:00:01.84]            at FluentAssertions.Execution.TestFrameworkProvider.Throw(String message)
[xUnit.net 00:00:01.84]            at FluentAssertions.Execution.DefaultAssertionStrategy.HandleFailure(String message)
[xUnit.net 00:00:01.84]            at FluentAssertions.Execution.AssertionScope.FailWith(Func`1 failReasonFunc)
[xUnit.net 00:00:01.84]            at FluentAssertions.Execution.AssertionScope.FailWithPreFormatted(String formattedFailReason)
[xUnit.net 00:00:01.84]            at FluentAssertions.Collections.GenericCollectionAssertions`3.AllSatisfy(Action`1 expected, String because, Object[] becauseArgs)
[xUnit.net 00:00:01.84]         C:\Users\mccre\dev\boiler\tests\performance\UserService.PerformanceTests\BasicPerformanceTests.cs(284,0): at UserService.PerformanceTests.BasicPerformanceTests.MultiTenantIsolation_ShouldMaintainPerformance()
[xUnit.net 00:00:01.84]         --- End of stack trace from previous location ---
[13:48:46 INF] ?? Starting minimal performance data seeding... {"SourceContext": "UserService.PerformanceTests.BasicPerformanceTests"}
[13:48:46 INF] ? Minimal performance data seeding completed {"SourceContext": "UserService.PerformanceTests.BasicPerformanceTests"}
[13:48:46 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TF3", "RequestPath": "/api/users/profile"}
[13:48:46 INF] HTTP GET /api/users/profile responded 404 in 52.7636 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:46 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TF4", "RequestPath": "/api/users/profile"}
[13:48:46 INF] HTTP GET /api/users/profile responded 404 in 65.2496 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[xUnit.net 00:00:02.22]     UserService.PerformanceTests.BasicPerformanceTests.JwtTokenValidation_ShouldBeEfficient [FAIL]
[xUnit.net 00:00:02.22]       Expected response.IsSuccessStatusCode to be true because JWT validation should succeed, but found False.
[xUnit.net 00:00:02.22]       Stack Trace:
[xUnit.net 00:00:02.22]            at FluentAssertions.Execution.XUnit2TestFramework.Throw(String message)
[xUnit.net 00:00:02.22]            at FluentAssertions.Execution.TestFrameworkProvider.Throw(String message)
[xUnit.net 00:00:02.22]            at FluentAssertions.Execution.DefaultAssertionStrategy.HandleFailure(String message)
[xUnit.net 00:00:02.22]            at FluentAssertions.Execution.AssertionScope.FailWith(Func`1 failReasonFunc)
[xUnit.net 00:00:02.22]            at FluentAssertions.Execution.AssertionScope.FailWith(Func`1 failReasonFunc)
[xUnit.net 00:00:02.22]            at FluentAssertions.Execution.AssertionScope.FailWith(String message, Object[] args)
[xUnit.net 00:00:02.22]            at FluentAssertions.Primitives.BooleanAssertions`1.BeTrue(String because, Object[] becauseArgs)
[xUnit.net 00:00:02.22]         C:\Users\mccre\dev\boiler\tests\performance\UserService.PerformanceTests\BasicPerformanceTests.cs(146,0): at UserService.PerformanceTests.BasicPerformanceTests.JwtTokenValidation_ShouldBeEfficient()
[xUnit.net 00:00:02.22]         --- End of stack trace from previous location ---
[xUnit.net 00:00:02.22]       Output:
[xUnit.net 00:00:02.22]         🔥 Warming up JWT validation...
[xUnit.net 00:00:02.22]            JWT warm-up completed: NotFound
[xUnit.net 00:00:02.22]         ❌ JWT validation failed with NotFound
[xUnit.net 00:00:02.22]            Error content: {"error":"TENANT_NOT_FOUND","message":"The requested tenant was not found or is inactive.","statusCode":404}
[13:48:47 INF] ?? Starting minimal performance data seeding... {"SourceContext": "UserService.PerformanceTests.BasicPerformanceTests"}
[13:48:47 INF] ? Minimal performance data seeding completed {"SourceContext": "UserService.PerformanceTests.BasicPerformanceTests"}
[13:48:47 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TF5", "RequestPath": "/api/users"}
[13:48:47 INF] HTTP GET /api/users responded 404 in 51.1173 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:47 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TF6", "RequestPath": "/api/users"}
[13:48:47 INF] HTTP GET /api/users responded 404 in 51.5897 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[xUnit.net 00:00:02.60]     UserService.PerformanceTests.BasicPerformanceTests.UserOperations_ShouldMeetPerformanceTarget [FAIL]
[xUnit.net 00:00:02.60]       Expected response.IsSuccessStatusCode to be true because Request 0 failed with NotFound, but found False.
[xUnit.net 00:00:02.60]       Stack Trace:
[xUnit.net 00:00:02.60]            at FluentAssertions.Execution.XUnit2TestFramework.Throw(String message)
[xUnit.net 00:00:02.60]            at FluentAssertions.Execution.TestFrameworkProvider.Throw(String message)
[xUnit.net 00:00:02.60]            at FluentAssertions.Execution.DefaultAssertionStrategy.HandleFailure(String message)
[xUnit.net 00:00:02.60]            at FluentAssertions.Execution.AssertionScope.FailWith(Func`1 failReasonFunc)
[xUnit.net 00:00:02.60]            at FluentAssertions.Execution.AssertionScope.FailWith(Func`1 failReasonFunc)
[xUnit.net 00:00:02.60]            at FluentAssertions.Execution.AssertionScope.FailWith(String message, Object[] args)
[xUnit.net 00:00:02.60]            at FluentAssertions.Primitives.BooleanAssertions`1.BeTrue(String because, Object[] becauseArgs)
[xUnit.net 00:00:02.60]         C:\Users\mccre\dev\boiler\tests\performance\UserService.PerformanceTests\BasicPerformanceTests.cs(81,0): at UserService.PerformanceTests.BasicPerformanceTests.UserOperations_ShouldMeetPerformanceTarget()
[xUnit.net 00:00:02.60]         --- End of stack trace from previous location ---
[xUnit.net 00:00:02.60]       Output:
[xUnit.net 00:00:02.60]         🔥 Warming up application...
[xUnit.net 00:00:02.60]            Warm-up request: 51ms
[xUnit.net 00:00:02.60]         ❌ Request 0 failed with NotFound
[xUnit.net 00:00:02.60]            Error content: {"error":"TENANT_NOT_FOUND","message":"The requested tenant was not found or is inactive.","statusCode":404}
=== UserService Startup Diagnostics ===
Environment: Performance
Application Name: UserService
Content Root: C:\Users\mccre\dev\boiler\src\services\UserService
Running in Container: 
[Startup] Monitoring:Enabled raw config value = 'False'
[13:48:47 INF] Monitoring:Enabled = False {}
?? Registering base services...
? Base services registered
?? Configuring Swagger...
? Swagger configured
?? Registering common services...
? Common services registered
?? Configuring Redis...
?? Redis connection string resolved to: 
?? Running in container: 
? Redis configured
?? Registering database services...
? Database services registered
?? Registering user services...
? User services registered
?? Registering Enhanced Security and Monitoring services...
[13:48:47 INF] Registering Enhanced Security and Monitoring services {}
? Enhanced Security and Monitoring services registered successfully
[13:48:47 INF] Enhanced Security and Monitoring services registered successfully {}
?? Registering Compliance and Alert services...
[13:48:47 INF] Registering Compliance and Alert services {}
? Compliance and Alert services registered successfully
[13:48:47 INF] Compliance and Alert services registered successfully {}
?? Registering Enhanced Health Checks...
? Enhanced Health Checks registered
?? Configuring authorization policies...
? Authorization policies configured
?? Configuring CORS...
? CORS configured
?? Registering additional services...
? Additional services registered
??? Building application...
? Application built successfully
?? Configuring middleware pipeline...
?? Configuring Enhanced Security middleware...
[13:48:47 INF] Configuring Enhanced Security middleware {}
[13:48:47 INF] ?? Enhanced security middleware DISABLED via configuration {"SourceContext": "SecurityExtensions"}
? Enhanced Security middleware configured successfully
[13:48:47 INF] Enhanced Security middleware configured successfully {}
? Middleware pipeline configured
?? Mapping Enhanced Health Check endpoints...
? Enhanced Health Check endpoints mapped
[13:48:47 INF] Starting UserService with Phase 11 Enhanced Security & Monitoring {}
=== UserService Starting with Phase 11 Enhanced Security & Monitoring ===
?? Testing Redis connection...
??  Redis connection test error: No service for type 'StackExchange.Redis.IConnectionMultiplexer' has been registered.
[13:48:47 WRN] Redis connection test failed with unexpected error {}
System.InvalidOperationException: No service for type 'StackExchange.Redis.IConnectionMultiplexer' has been registered.
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at Program.<Main>$(String[] args) in C:\Users\mccre\dev\boiler\src\services\UserService\Program.cs:line 557
?? Seeding database...
? Database seeded
?? Seeding monitoring user...
[13:48:47 INF] Monitoring.Enabled = 'False' (evaluated false); skipping seeding. {"SourceContext": "MonitoringUserSeeder"}
? Monitoring user seeded (monitor@local / ChangeMe123!)
?? Starting application...
?? Enhanced Health Check endpoints available:
  - GET /health (comprehensive overview)
  - GET /health/critical (database + Redis status)
  - GET /health/enhanced (Phase 11 enhanced monitoring)
  - GET /health/performance (cache and performance metrics)
  - GET /health/system (overall system health score)
  - GET /health/ready (Kubernetes readiness)
  - GET /health/live (Kubernetes liveness)
?? Enhanced Security & Monitoring features:
  - Rate limiting with tenant awareness
  - Security event detection and logging
  - Performance metrics collection with Redis storage
  - Enhanced audit trail for all actions
  - Comprehensive health monitoring with performance scoring
  - Real-time system metrics and alerts
[13:48:47 INF] Enhanced Security & Monitoring (Phase 11) configured and operational {}
[13:48:47 WRN] Failed to determine the https port for redirect. {"EventId": {"Id": 3, "Name": "FailedToDeterminePort"}, "SourceContext": "Microsoft.AspNetCore.HttpsPolicy.HttpsRedirectionMiddleware", "RequestId": "0HNF2EMOB0TF7", "RequestPath": "/api/roles"}
[13:48:47 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TFB", "RequestPath": "/api/roles"}
[13:48:47 INF] HTTP GET /api/roles responded 404 in 110.0886 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:47 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TFG", "RequestPath": "/api/roles"}
[13:48:47 INF] HTTP GET /api/roles responded 404 in 119.8914 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:47 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TFI", "RequestPath": "/api/roles"}
[13:48:47 INF] HTTP GET /api/roles responded 404 in 130.5633 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:47 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TFH", "RequestPath": "/api/roles"}
[13:48:47 INF] HTTP GET /api/roles responded 404 in 147.3824 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:47 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TFA", "RequestPath": "/api/roles"}
[13:48:47 INF] HTTP GET /api/roles responded 404 in 155.2365 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:47 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TFF", "RequestPath": "/api/roles"}
[13:48:47 INF] HTTP GET /api/roles responded 404 in 180.6755 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:48 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TFJ", "RequestPath": "/api/roles"}
[13:48:48 INF] HTTP GET /api/roles responded 404 in 203.7037 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:48 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TF7", "RequestPath": "/api/roles"}
[13:48:48 INF] HTTP GET /api/roles responded 404 in 214.0641 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:48 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TFC", "RequestPath": "/api/roles"}
[13:48:48 INF] HTTP GET /api/roles responded 404 in 223.2224 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:48 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TF8", "RequestPath": "/api/roles"}
[13:48:48 INF] HTTP GET /api/roles responded 404 in 228.3505 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:48 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TFE", "RequestPath": "/api/roles"}
[13:48:48 INF] HTTP GET /api/roles responded 404 in 236.5844 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:48 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TF9", "RequestPath": "/api/roles"}
[13:48:48 INF] HTTP GET /api/roles responded 404 in 245.7717 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:48 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TFD", "RequestPath": "/api/roles"}
[13:48:48 INF] HTTP GET /api/roles responded 404 in 139.1446 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:48 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TFL", "RequestPath": "/api/roles"}
[13:48:48 INF] HTTP GET /api/roles responded 404 in 122.3152 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:48 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TFK", "RequestPath": "/api/roles"}
[13:48:48 INF] HTTP GET /api/roles responded 404 in 141.3791 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:48 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TFN", "RequestPath": "/api/roles"}
[13:48:48 INF] HTTP GET /api/roles responded 404 in 110.4992 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:48 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TFM", "RequestPath": "/api/roles"}
[13:48:48 INF] HTTP GET /api/roles responded 404 in 132.3395 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:48 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TFO", "RequestPath": "/api/roles"}
[13:48:48 INF] HTTP GET /api/roles responded 404 in 101.8891 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:48 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TFP", "RequestPath": "/api/roles"}
[13:48:48 INF] HTTP GET /api/roles responded 404 in 88.1299 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:48 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TFQ", "RequestPath": "/api/roles"}
[13:48:48 INF] HTTP GET /api/roles responded 404 in 77.7501 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[xUnit.net 00:00:03.33]     UserService.PerformanceTests.ConcurrentLoadTests.DatabaseConnectionPool_ShouldHandleConcurrency [FAIL]
[xUnit.net 00:00:03.33]       All database connection attempts failed - likely JWT configuration issue
[xUnit.net 00:00:03.33]       Stack Trace:
[xUnit.net 00:00:03.33]         C:\Users\mccre\dev\boiler\tests\performance\UserService.PerformanceTests\ConcurrentLoadTests.cs(180,0): at UserService.PerformanceTests.ConcurrentLoadTests.DatabaseConnectionPool_ShouldHandleConcurrency()
[xUnit.net 00:00:03.33]         --- End of stack trace from previous location ---
[xUnit.net 00:00:03.33]       Output:
[xUnit.net 00:00:03.33]         📊 Database Connection Pool Test:
[xUnit.net 00:00:03.33]            Concurrent Connections: 20
[xUnit.net 00:00:03.33]            Successful: 0
[xUnit.net 00:00:03.33]            Success Rate: 0.00%
[xUnit.net 00:00:03.33]         ❌ All database connection attempts failed - check JWT authentication
[13:48:48 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TFT", "RequestPath": "/api/users"}
[13:48:48 INF] HTTP GET /api/users responded 404 in 86.9875 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:48 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TFU", "RequestPath": "/api/users"}
[13:48:48 INF] HTTP GET /api/users responded 404 in 80.8333 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:48 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TFV", "RequestPath": "/api/users"}
[13:48:48 INF] HTTP GET /api/users responded 404 in 82.5146 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:48 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TFS", "RequestPath": "/api/users"}
[13:48:48 INF] HTTP GET /api/users responded 404 in 103.4229 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:48 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TFR", "RequestPath": "/api/users"}
[13:48:48 INF] HTTP GET /api/users responded 404 in 106.9441 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:48 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TG1", "RequestPath": "/api/users"}
[13:48:48 INF] HTTP GET /api/users responded 404 in 84.7555 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:48 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TG0", "RequestPath": "/api/users"}
[13:48:48 INF] HTTP GET /api/users responded 404 in 88.6013 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:48 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TG2", "RequestPath": "/api/users"}
[13:48:48 INF] HTTP GET /api/users responded 404 in 93.6238 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:48 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TG4", "RequestPath": "/api/users"}
[13:48:48 INF] HTTP GET /api/users responded 404 in 92.3114 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:48 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TG3", "RequestPath": "/api/users"}
[13:48:48 INF] HTTP GET /api/users responded 404 in 97.4489 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:48 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TG6", "RequestPath": "/api/users"}
[13:48:48 INF] HTTP GET /api/users responded 404 in 94.8203 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:48 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TG5", "RequestPath": "/api/users"}
[13:48:48 INF] HTTP GET /api/users responded 404 in 105.4926 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:48 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TG7", "RequestPath": "/api/users"}
[13:48:48 INF] HTTP GET /api/users responded 404 in 107.8116 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:48 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TG9", "RequestPath": "/api/users"}
[13:48:48 INF] HTTP GET /api/users responded 404 in 102.2513 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:48 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TG8", "RequestPath": "/api/users"}
[13:48:48 INF] HTTP GET /api/users responded 404 in 126.1399 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:48 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TGA", "RequestPath": "/api/users"}
[13:48:48 INF] HTTP GET /api/users responded 404 in 116.9701 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:48 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TGB", "RequestPath": "/api/users"}
[13:48:48 INF] HTTP GET /api/users responded 404 in 101.8405 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:48 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TGD", "RequestPath": "/api/users"}
[13:48:48 INF] HTTP GET /api/users responded 404 in 93.1772 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:48 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TGC", "RequestPath": "/api/users"}
[13:48:48 INF] HTTP GET /api/users responded 404 in 103.5076 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:48 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TGE", "RequestPath": "/api/users"}
[13:48:48 INF] HTTP GET /api/users responded 404 in 115.8327 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:48 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TGF", "RequestPath": "/api/users"}
[13:48:48 INF] HTTP GET /api/users responded 404 in 99.5610 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:48 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TGG", "RequestPath": "/api/users"}
[13:48:48 INF] HTTP GET /api/users responded 404 in 101.8069 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:48 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TGH", "RequestPath": "/api/users"}
[13:48:48 INF] HTTP GET /api/users responded 404 in 86.4850 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:48 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TGI", "RequestPath": "/api/users"}
[13:48:48 INF] HTTP GET /api/users responded 404 in 101.2351 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:48 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TGM", "RequestPath": "/api/users"}
[13:48:48 INF] HTTP GET /api/users responded 404 in 89.2322 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:48 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TGJ", "RequestPath": "/api/users"}
[13:48:48 INF] HTTP GET /api/users responded 404 in 100.6740 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:48 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TGL", "RequestPath": "/api/users"}
[13:48:48 INF] HTTP GET /api/users responded 404 in 107.9213 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:48 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TGN", "RequestPath": "/api/users"}
[13:48:48 INF] HTTP GET /api/users responded 404 in 90.9769 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:48 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TGK", "RequestPath": "/api/users"}
[13:48:48 INF] HTTP GET /api/users responded 404 in 120.2535 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:48 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TGO", "RequestPath": "/api/users"}
[13:48:48 INF] HTTP GET /api/users responded 404 in 98.9951 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:48 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TGQ", "RequestPath": "/api/users"}
[13:48:48 INF] HTTP GET /api/users responded 404 in 99.7258 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:48 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TGP", "RequestPath": "/api/users"}
[13:48:48 INF] HTTP GET /api/users responded 404 in 106.6668 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:48 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TGR", "RequestPath": "/api/users"}
[13:48:48 INF] HTTP GET /api/users responded 404 in 99.9498 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:48 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TGU", "RequestPath": "/api/users"}
[13:48:48 INF] HTTP GET /api/users responded 404 in 86.5341 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:48 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TGT", "RequestPath": "/api/users"}
[13:48:48 INF] HTTP GET /api/users responded 404 in 98.3042 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:48 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TGS", "RequestPath": "/api/users"}
[13:48:48 INF] HTTP GET /api/users responded 404 in 110.0015 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:48 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TGV", "RequestPath": "/api/users"}
[13:48:48 INF] HTTP GET /api/users responded 404 in 100.2626 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:48 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TH0", "RequestPath": "/api/users"}
[13:48:48 INF] HTTP GET /api/users responded 404 in 90.9285 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:48 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TH1", "RequestPath": "/api/users"}
[13:48:48 INF] HTTP GET /api/users responded 404 in 88.6914 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:48 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TH2", "RequestPath": "/api/users"}
[13:48:48 INF] HTTP GET /api/users responded 404 in 88.4687 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:48 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TH4", "RequestPath": "/api/users"}
[13:48:48 INF] HTTP GET /api/users responded 404 in 86.6027 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:48 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TH8", "RequestPath": "/api/users"}
[13:48:48 INF] HTTP GET /api/users responded 404 in 98.9191 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:48 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TH6", "RequestPath": "/api/users"}
[13:48:48 INF] HTTP GET /api/users responded 404 in 113.1586 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:48 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TH5", "RequestPath": "/api/users"}
[13:48:48 INF] HTTP GET /api/users responded 404 in 128.8866 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:48 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TH3", "RequestPath": "/api/users"}
[13:48:48 INF] HTTP GET /api/users responded 404 in 148.9821 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:48 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TH7", "RequestPath": "/api/users"}
[13:48:48 INF] HTTP GET /api/users responded 404 in 120.3219 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:48 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0THA", "RequestPath": "/api/users"}
[13:48:48 INF] HTTP GET /api/users responded 404 in 91.6259 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:48 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0TH9", "RequestPath": "/api/users"}
[13:48:48 INF] HTTP GET /api/users responded 404 in 121.7109 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:48 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0THB", "RequestPath": "/api/users"}
[13:48:48 INF] HTTP GET /api/users responded 404 in 98.2337 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[13:48:48 WRN] Tenant 1 not found or inactive {"SourceContext": "Common.Middleware.TenantMiddleware", "RequestId": "0HNF2EMOB0THC", "RequestPath": "/api/users"}
[13:48:48 INF] HTTP GET /api/users responded 404 in 74.6644 ms {"SourceContext": "Serilog.AspNetCore.RequestLoggingMiddleware"}
[xUnit.net 00:00:04.23]     UserService.PerformanceTests.ConcurrentLoadTests.ConcurrentUserRequests_ShouldMaintainPerformance [FAIL]
[xUnit.net 00:00:04.23]       No successful requests out of 50 attempts. Check JWT configuration and API availability.
[xUnit.net 00:00:04.23]       Stack Trace:
[xUnit.net 00:00:04.23]         C:\Users\mccre\dev\boiler\tests\performance\UserService.PerformanceTests\ConcurrentLoadTests.cs(95,0): at UserService.PerformanceTests.ConcurrentLoadTests.ConcurrentUserRequests_ShouldMaintainPerformance()
[xUnit.net 00:00:04.23]         --- End of stack trace from previous location ---
[xUnit.net 00:00:04.23]       Output:
[xUnit.net 00:00:04.23]         ❌ No successful requests out of 50 total requests
[xUnit.net 00:00:04.23]            This indicates a configuration or authentication issue
[xUnit.net 00:00:04.23]            All 50 requests failed - likely JWT authentication issue
[xUnit.net 00:00:04.35]   Finished:    UserService.PerformanceTests
========== Test run finished: 16 Tests (0 Passed, 16 Failed, 0 Skipped) run in 4.4 sec ==========
